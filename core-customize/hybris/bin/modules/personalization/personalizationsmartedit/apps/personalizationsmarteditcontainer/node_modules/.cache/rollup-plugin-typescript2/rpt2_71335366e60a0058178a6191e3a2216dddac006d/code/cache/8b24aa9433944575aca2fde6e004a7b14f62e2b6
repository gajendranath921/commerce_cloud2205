{"code":"import { __awaiter, __decorate, __metadata } from \"tslib\";\r\nimport { PersonalizationsmarteditContextUtils, PersonalizationsmarteditUtils } from 'personalizationcommons';\r\nimport { IModalService, LogService, SeDowngradeService } from 'smarteditcommons';\r\nimport { PersonalizationsmarteditContextService, PersonalizationsmarteditPreviewService, PersonalizationsmarteditRestService } from '../service';\r\nimport { CombinedViewConfigureComponent } from './combinedViewConfigure';\r\nlet /* @ngInject */ CombinedViewCommonsService = class /* @ngInject */ CombinedViewCommonsService {\r\n    constructor(personalizationsmarteditContextUtils, personalizationsmarteditContextService, personalizationsmarteditPreviewService, personalizationsmarteditUtils, personalizationsmarteditRestService, modalService, logService) {\r\n        this.personalizationsmarteditContextUtils = personalizationsmarteditContextUtils;\r\n        this.personalizationsmarteditContextService = personalizationsmarteditContextService;\r\n        this.personalizationsmarteditPreviewService = personalizationsmarteditPreviewService;\r\n        this.personalizationsmarteditUtils = personalizationsmarteditUtils;\r\n        this.personalizationsmarteditRestService = personalizationsmarteditRestService;\r\n        this.modalService = modalService;\r\n        this.logService = logService;\r\n    }\r\n    openManagerAction() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            try {\r\n                yield this.modalService\r\n                    .open({\r\n                    component: CombinedViewConfigureComponent,\r\n                    templateConfig: {\r\n                        title: 'personalization.modal.combinedview.title',\r\n                        isDismissButtonVisible: true\r\n                    },\r\n                    config: {\r\n                        focusTrapped: false,\r\n                        backdropClickCloseable: false\r\n                    }\r\n                })\r\n                    .afterClosed.toPromise();\r\n                this.personalizationsmarteditContextUtils.clearCombinedViewCustomizeContext(this.personalizationsmarteditContextService);\r\n                const combinedView = this.personalizationsmarteditContextService.getCombinedView();\r\n                combinedView.enabled =\r\n                    combinedView.selectedItems && combinedView.selectedItems.length > 0;\r\n                this.personalizationsmarteditContextService.setCombinedView(combinedView);\r\n                this.updatePreview(this.getVariationsForPreviewTicket());\r\n            }\r\n            catch (e) {\r\n                this.logService.debug('Combined View Items Select Modal dismissed', e);\r\n            }\r\n        });\r\n    }\r\n    updatePreview(previewTicketVariations) {\r\n        this.personalizationsmarteditPreviewService.updatePreviewTicketWithVariations(previewTicketVariations);\r\n        this.updateActionsOnSelectedVariations();\r\n    }\r\n    getVariationsForPreviewTicket() {\r\n        const previewTicketVariations = [];\r\n        const combinedView = this.personalizationsmarteditContextService.getCombinedView();\r\n        (combinedView.selectedItems || []).forEach((item) => {\r\n            previewTicketVariations.push({\r\n                customizationCode: item.customization.code,\r\n                variationCode: item.variation.code,\r\n                catalog: item.variation.catalog,\r\n                catalogVersion: item.variation.catalogVersion\r\n            });\r\n        });\r\n        return previewTicketVariations;\r\n    }\r\n    combinedViewEnabledEvent(isEnabled) {\r\n        const combinedView = this.personalizationsmarteditContextService.getCombinedView();\r\n        combinedView.enabled = isEnabled;\r\n        this.personalizationsmarteditContextService.setCombinedView(combinedView);\r\n        const customize = this.personalizationsmarteditContextService.getCustomize();\r\n        customize.selectedCustomization = null;\r\n        customize.selectedVariations = null;\r\n        customize.selectedComponents = null;\r\n        this.personalizationsmarteditContextService.setCustomize(customize);\r\n        if (isEnabled) {\r\n            this.updatePreview(this.getVariationsForPreviewTicket());\r\n        }\r\n        else {\r\n            this.updatePreview([]);\r\n        }\r\n    }\r\n    isItemFromCurrentCatalog(item) {\r\n        return this.personalizationsmarteditUtils.isItemFromCurrentCatalog(item, this.personalizationsmarteditContextService.getSeData());\r\n    }\r\n    updateActionsOnSelectedVariations() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const combinedView = this.personalizationsmarteditContextService.getCombinedView();\r\n            const promisesArray = (combinedView.selectedItems || []).map((item) => __awaiter(this, void 0, void 0, function* () {\r\n                const response = yield this.personalizationsmarteditRestService.getActions(item.customization.code, item.variation.code, item.variation);\r\n                item.variation.actions = response.actions;\r\n            }));\r\n            yield Promise.all(promisesArray);\r\n            this.personalizationsmarteditContextService.setCombinedView(combinedView);\r\n        });\r\n    }\r\n};\r\n/* @ngInject */ CombinedViewCommonsService = __decorate([\r\n    SeDowngradeService(),\r\n    __metadata(\"design:paramtypes\", [PersonalizationsmarteditContextUtils,\r\n        PersonalizationsmarteditContextService,\r\n        PersonalizationsmarteditPreviewService,\r\n        PersonalizationsmarteditUtils,\r\n        PersonalizationsmarteditRestService,\r\n        IModalService,\r\n        LogService])\r\n], /* @ngInject */ CombinedViewCommonsService);\r\nexport { /* @ngInject */ CombinedViewCommonsService };\r\n//# sourceMappingURL=CombinedViewCommonsService.js.map","references":["/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/personalization/personalizationsmartedit/apps/personalizationcommons/dist/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/personalization/personalizationsmartedit/apps/personalizationsmarteditcontainer/src/service/index.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/personalization/personalizationsmartedit/apps/personalizationsmarteditcontainer/src/combinedView/combinedViewConfigure/index.ts"],"map":"{\"version\":3,\"file\":\"CombinedViewCommonsService.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/combinedView/CombinedViewCommonsService.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/personalization/personalizationsmartedit/apps/personalizationsmarteditcontainer/node_modules/.cache/rollup-plugin-typescript2/placeholder/combinedView/CombinedViewCommonsService.d.ts","writeByteOrderMark":false,"text":"import { PersonalizationsmarteditContextUtils, PersonalizationsmarteditUtils } from 'personalizationcommons';\r\nimport { IModalService, LogService } from 'smarteditcommons';\r\nimport { PersonalizationsmarteditContextService, PersonalizationsmarteditPreviewService, PersonalizationsmarteditRestService } from '../service';\r\nexport declare class CombinedViewCommonsService {\r\n    protected personalizationsmarteditContextUtils: PersonalizationsmarteditContextUtils;\r\n    protected personalizationsmarteditContextService: PersonalizationsmarteditContextService;\r\n    protected personalizationsmarteditPreviewService: PersonalizationsmarteditPreviewService;\r\n    protected personalizationsmarteditUtils: PersonalizationsmarteditUtils;\r\n    protected personalizationsmarteditRestService: PersonalizationsmarteditRestService;\r\n    private modalService;\r\n    private logService;\r\n    constructor(personalizationsmarteditContextUtils: PersonalizationsmarteditContextUtils, personalizationsmarteditContextService: PersonalizationsmarteditContextService, personalizationsmarteditPreviewService: PersonalizationsmarteditPreviewService, personalizationsmarteditUtils: PersonalizationsmarteditUtils, personalizationsmarteditRestService: PersonalizationsmarteditRestService, modalService: IModalService, logService: LogService);\r\n    openManagerAction(): Promise<void>;\r\n    updatePreview(previewTicketVariations: any): void;\r\n    getVariationsForPreviewTicket(): any[];\r\n    combinedViewEnabledEvent(isEnabled: boolean): void;\r\n    isItemFromCurrentCatalog(item: any): boolean;\r\n    private updateActionsOnSelectedVariations;\r\n}\r\n"}}
