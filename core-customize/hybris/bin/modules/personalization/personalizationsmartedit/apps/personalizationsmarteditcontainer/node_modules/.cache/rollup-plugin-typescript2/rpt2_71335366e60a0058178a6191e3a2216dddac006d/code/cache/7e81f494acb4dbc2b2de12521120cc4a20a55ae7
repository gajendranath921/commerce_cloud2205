{"code":"import { __awaiter, __decorate, __metadata } from \"tslib\";\r\n/*\r\n * Copyright (c) 2022 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\n// TODO:: Below IPageService shall also move to smarteditcommons\r\nimport { IPageService, IPermissionService, ICatalogVersionPermissionService, SeDowngradeService } from 'smarteditcommons';\r\nimport { PersonalizationsmarteditContextService } from './PersonalizationsmarteditContextServiceOuter';\r\nimport { PersonalizationsmarteditRestService } from './PersonalizationsmarteditRestService';\r\nlet /* @ngInject */ PersonalizationsmarteditRulesAndPermissionsRegistrationService = class /* @ngInject */ PersonalizationsmarteditRulesAndPermissionsRegistrationService {\r\n    constructor(personalizationsmarteditContextService, personalizationsmarteditRestService, permissionService, catalogVersionPermissionService, pageService) {\r\n        this.personalizationsmarteditContextService = personalizationsmarteditContextService;\r\n        this.personalizationsmarteditRestService = personalizationsmarteditRestService;\r\n        this.permissionService = permissionService;\r\n        this.catalogVersionPermissionService = catalogVersionPermissionService;\r\n        this.pageService = pageService;\r\n    }\r\n    registerRules() {\r\n        this.permissionService.registerRule({\r\n            names: ['se.access.personalization'],\r\n            verify: () => __awaiter(this, void 0, void 0, function* () {\r\n                yield this.catalogVersionPermissionService.hasReadPermissionOnCurrent();\r\n                yield this.personalizationsmarteditContextService.refreshExperienceData();\r\n                try {\r\n                    yield this.personalizationsmarteditRestService.getCustomizations(this.getCustomizationFilter());\r\n                    return true;\r\n                }\r\n                catch (errorResp) {\r\n                    if (errorResp.status === 403) {\r\n                        // Forbidden status on GET /customizations - user doesn't have permission to personalization perspective\r\n                        return false;\r\n                    }\r\n                    else {\r\n                        // other errors will be handled with personalization perspective turned on\r\n                        return true;\r\n                    }\r\n                }\r\n            })\r\n        });\r\n        this.permissionService.registerRule({\r\n            names: ['se.access.personalization.page'],\r\n            verify: () => __awaiter(this, void 0, void 0, function* () {\r\n                const info = yield this.pageService.getCurrentPageInfo();\r\n                return info.typeCode !== 'EmailPage';\r\n            })\r\n        });\r\n        // Permissions\r\n        this.permissionService.registerPermission({\r\n            aliases: ['se.personalization.open'],\r\n            rules: ['se.access.personalization']\r\n        });\r\n        this.permissionService.registerPermission({\r\n            aliases: ['se.personalization.page'],\r\n            rules: ['se.access.personalization.page']\r\n        });\r\n    }\r\n    getCustomizationFilter() {\r\n        return {\r\n            currentPage: 0,\r\n            currentSize: 1\r\n        };\r\n    }\r\n};\r\n/* @ngInject */ PersonalizationsmarteditRulesAndPermissionsRegistrationService = __decorate([\r\n    SeDowngradeService(),\r\n    __metadata(\"design:paramtypes\", [PersonalizationsmarteditContextService,\r\n        PersonalizationsmarteditRestService,\r\n        IPermissionService,\r\n        ICatalogVersionPermissionService,\r\n        IPageService])\r\n], /* @ngInject */ PersonalizationsmarteditRulesAndPermissionsRegistrationService);\r\nexport { /* @ngInject */ PersonalizationsmarteditRulesAndPermissionsRegistrationService };\r\n//# sourceMappingURL=PersonalizationsmarteditRulesAndPermissionsRegistrationService.js.map","references":["/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/personalization/personalizationsmartedit/apps/personalizationsmarteditcontainer/src/service/PersonalizationsmarteditContextServiceOuter.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/personalization/personalizationsmartedit/apps/personalizationsmarteditcontainer/src/service/PersonalizationsmarteditRestService.ts"],"map":"{\"version\":3,\"file\":\"PersonalizationsmarteditRulesAndPermissionsRegistrationService.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/service/PersonalizationsmarteditRulesAndPermissionsRegistrationService.ts\"],\"names\":[],\"mappings\":\";AAAA;;GAEG;AACH,gEAAgE;AAChE,OAAO,EACH,YAAY,EACZ,kBAAkB,EAClB,gCAAgC,EAChC,kBAAkB,EACrB,MAAM,kBAAkB,CAAC;AAC1B,OAAO,EAAE,sCAAsC,EAAE,MAAM,+CAA+C,CAAC;AACvG,OAAO,EAAE,mCAAmC,EAAE,MAAM,uCAAuC,CAAC;AAG5F,qFAAA;IACI,YACY,sCAA8E,EAC9E,mCAAwE,EACxE,iBAAqC,EACrC,+BAAiE,EACjE,WAAyB;QAJzB,2CAAsC,GAAtC,sCAAsC,CAAwC;QAC9E,wCAAmC,GAAnC,mCAAmC,CAAqC;QACxE,sBAAiB,GAAjB,iBAAiB,CAAoB;QACrC,oCAA+B,GAA/B,+BAA+B,CAAkC;QACjE,gBAAW,GAAX,WAAW,CAAc;IAClC,CAAC;IAEG,aAAa;QAChB,IAAI,CAAC,iBAAiB,CAAC,YAAY,CAAC;YAChC,KAAK,EAAE,CAAC,2BAA2B,CAAC;YACpC,MAAM,EAAE,GAAS,EAAE;gBACf,MAAM,IAAI,CAAC,+BAA+B,CAAC,0BAA0B,EAAE,CAAC;gBACxE,MAAM,IAAI,CAAC,sCAAsC,CAAC,qBAAqB,EAAE,CAAC;gBAC1E,IAAI;oBACA,MAAM,IAAI,CAAC,mCAAmC,CAAC,iBAAiB,CAC5D,IAAI,CAAC,sBAAsB,EAAE,CAChC,CAAC;oBACF,OAAO,IAAI,CAAC;iBACf;gBAAC,OAAO,SAAS,EAAE;oBAChB,IAAI,SAAS,CAAC,MAAM,KAAK,GAAG,EAAE;wBAC1B,wGAAwG;wBACxG,OAAO,KAAK,CAAC;qBAChB;yBAAM;wBACH,0EAA0E;wBAC1E,OAAO,IAAI,CAAC;qBACf;iBACJ;YACL,CAAC,CAAA;SACJ,CAAC,CAAC;QAEH,IAAI,CAAC,iBAAiB,CAAC,YAAY,CAAC;YAChC,KAAK,EAAE,CAAC,gCAAgC,CAAC;YACzC,MAAM,EAAE,GAAS,EAAE;gBACf,MAAM,IAAI,GAAQ,MAAM,IAAI,CAAC,WAAW,CAAC,kBAAkB,EAAE,CAAC;gBAC9D,OAAO,IAAI,CAAC,QAAQ,KAAK,WAAW,CAAC;YACzC,CAAC,CAAA;SACJ,CAAC,CAAC;QAEH,cAAc;QACd,IAAI,CAAC,iBAAiB,CAAC,kBAAkB,CAAC;YACtC,OAAO,EAAE,CAAC,yBAAyB,CAAC;YACpC,KAAK,EAAE,CAAC,2BAA2B,CAAC;SACvC,CAAC,CAAC;QAEH,IAAI,CAAC,iBAAiB,CAAC,kBAAkB,CAAC;YACtC,OAAO,EAAE,CAAC,yBAAyB,CAAC;YACpC,KAAK,EAAE,CAAC,gCAAgC,CAAC;SAC5C,CAAC,CAAC;IACP,CAAC;IAEO,sBAAsB;QAC1B,OAAO;YACH,WAAW,EAAE,CAAC;YACd,WAAW,EAAE,CAAC;SACjB,CAAC;IACN,CAAC;CACJ,CAAA;AA1DD;IADC,kBAAkB,EAAE;qCAGmC,sCAAsC;QACzC,mCAAmC;QACrD,kBAAkB;QACJ,gCAAgC;QACpD,YAAY;kFAoDxC\"}","dts":{"name":"/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/personalization/personalizationsmartedit/apps/personalizationsmarteditcontainer/node_modules/.cache/rollup-plugin-typescript2/placeholder/service/PersonalizationsmarteditRulesAndPermissionsRegistrationService.d.ts","writeByteOrderMark":false,"text":"import { IPageService, IPermissionService, ICatalogVersionPermissionService } from 'smarteditcommons';\r\nimport { PersonalizationsmarteditContextService } from './PersonalizationsmarteditContextServiceOuter';\r\nimport { PersonalizationsmarteditRestService } from './PersonalizationsmarteditRestService';\r\nexport declare class PersonalizationsmarteditRulesAndPermissionsRegistrationService {\r\n    private personalizationsmarteditContextService;\r\n    private personalizationsmarteditRestService;\r\n    private permissionService;\r\n    private catalogVersionPermissionService;\r\n    private pageService;\r\n    constructor(personalizationsmarteditContextService: PersonalizationsmarteditContextService, personalizationsmarteditRestService: PersonalizationsmarteditRestService, permissionService: IPermissionService, catalogVersionPermissionService: ICatalogVersionPermissionService, pageService: IPageService);\r\n    registerRules(): void;\r\n    private getCustomizationFilter;\r\n}\r\n"}}
