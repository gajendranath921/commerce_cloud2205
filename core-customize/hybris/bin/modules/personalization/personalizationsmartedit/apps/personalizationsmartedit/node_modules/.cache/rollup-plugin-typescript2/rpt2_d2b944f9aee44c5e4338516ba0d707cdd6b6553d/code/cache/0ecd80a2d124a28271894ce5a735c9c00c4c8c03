{"code":"import { __awaiter, __decorate, __metadata, __param } from \"tslib\";\r\n/*\r\n * Copyright (c) 2022 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { Inject } from '@angular/core';\r\nimport { uniq, first } from 'lodash';\r\nimport { COMPONENT_CONTAINER_TYPE, CONTAINER_SOURCE_ID_ATTR } from 'personalizationcommons';\r\nimport { CONTAINER_ID_ATTRIBUTE, CONTAINER_TYPE_ATTRIBUTE, CONTENT_SLOT_TYPE, SeDowngradeService, TYPE_ATTRIBUTE, YJQUERY_TOKEN, IPageInfoService, IRestServiceFactory, EVENTS, CrossFrameEventService, ComponentHandlerService } from 'smarteditcommons';\r\nimport { PAGES_CONTENT_SLOT_RESOURCE_URI } from '../constants';\r\nlet /* @ngInject */ PersonalizationsmarteditComponentHandlerService = class /* @ngInject */ PersonalizationsmarteditComponentHandlerService {\r\n    constructor(restServiceFactory, crossFrameEventService, yjQuery, componentHandlerService, pageInfoService) {\r\n        this.crossFrameEventService = crossFrameEventService;\r\n        this.yjQuery = yjQuery;\r\n        this.componentHandlerService = componentHandlerService;\r\n        this.pageInfoService = pageInfoService;\r\n        this.resource = restServiceFactory.get(PAGES_CONTENT_SLOT_RESOURCE_URI);\r\n        this.crossFrameEventService.subscribe(EVENTS.PAGE_CHANGE, () => this.reloadPageContentSlots());\r\n    }\r\n    getParentContainerForComponent(component) {\r\n        const parent = component.closest(`[${CONTAINER_TYPE_ATTRIBUTE}=${COMPONENT_CONTAINER_TYPE}]`);\r\n        return parent;\r\n    }\r\n    getParentContainerIdForComponent(component) {\r\n        const parent = component.closest(`[${CONTAINER_TYPE_ATTRIBUTE}=${COMPONENT_CONTAINER_TYPE}]`);\r\n        return parent.attr(CONTAINER_ID_ATTRIBUTE);\r\n    }\r\n    getPageContentSlots() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this.pageContentSlots) {\r\n                yield this.reloadPageContentSlots();\r\n            }\r\n            return this.pageContentSlots;\r\n        });\r\n    }\r\n    getParentContainerSourceIdForComponent(component) {\r\n        const parent = component.closest(`[${CONTAINER_TYPE_ATTRIBUTE}=${COMPONENT_CONTAINER_TYPE}]`);\r\n        return parent.attr(CONTAINER_SOURCE_ID_ATTR);\r\n    }\r\n    getParentSlotForComponent(component) {\r\n        const parent = component.closest(`[${TYPE_ATTRIBUTE}=${CONTENT_SLOT_TYPE}]`);\r\n        return parent;\r\n    }\r\n    getParentSlotIdForComponent(component) {\r\n        return this.componentHandlerService.getParentSlotForComponent(component);\r\n    }\r\n    getOriginalComponent(componentId, componentType) {\r\n        return this.componentHandlerService.getOriginalComponent(componentId, componentType);\r\n    }\r\n    isExternalComponent(componentId, componentType) {\r\n        return this.componentHandlerService.isExternalComponent(componentId, componentType);\r\n    }\r\n    getCatalogVersionUuid(component) {\r\n        return this.componentHandlerService.getCatalogVersionUuid(component);\r\n    }\r\n    getAllSlotsSelector() {\r\n        return this.componentHandlerService.getAllSlotsSelector();\r\n    }\r\n    getFromSelector(selector) {\r\n        return this.yjQuery(selector);\r\n    }\r\n    getContainerSourceIdForContainerId(containerId) {\r\n        let containerSelector = this.getAllSlotsSelector();\r\n        containerSelector += ' [' + CONTAINER_ID_ATTRIBUTE + '=\"' + containerId + '\"]'; // space at beginning is important\r\n        const container = this.getFromSelector(containerSelector);\r\n        return container[0] ? container[0].getAttribute(CONTAINER_SOURCE_ID_ATTR) : '';\r\n    }\r\n    isSlotShared(slotId) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            yield this.getPageContentSlots();\r\n            const matchedSlotData = first(this.pageContentSlots.filter((pageContentSlot) => pageContentSlot.slotId === slotId));\r\n            return matchedSlotData && matchedSlotData.slotShared;\r\n        });\r\n    }\r\n    reloadPageContentSlots() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const pageId = yield this.pageInfoService.getPageUID();\r\n            const pageContent = yield this.resource.get({ pageId });\r\n            this.pageContentSlots = uniq(pageContent.pageContentSlotList || []);\r\n        });\r\n    }\r\n};\r\n/* @ngInject */ PersonalizationsmarteditComponentHandlerService = __decorate([\r\n    SeDowngradeService(),\r\n    __param(2, Inject(YJQUERY_TOKEN)),\r\n    __metadata(\"design:paramtypes\", [IRestServiceFactory,\r\n        CrossFrameEventService, Function, ComponentHandlerService,\r\n        IPageInfoService])\r\n], /* @ngInject */ PersonalizationsmarteditComponentHandlerService);\r\nexport { /* @ngInject */ PersonalizationsmarteditComponentHandlerService };\r\n//# sourceMappingURL=PersonalizationsmarteditComponentHandlerService.js.map","references":["/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular+core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@types+lodash@4.14.159/node_modules/@types/lodash/ts3.1/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/personalization/personalizationsmartedit/apps/personalizationcommons/dist/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/personalization/personalizationsmartedit/apps/personalizationsmartedit/src/constants.ts"],"map":"{\"version\":3,\"file\":\"PersonalizationsmarteditComponentHandlerService.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/service/PersonalizationsmarteditComponentHandlerService.ts\"],\"names\":[],\"mappings\":\";AAAA;;GAEG;AACH,OAAO,EAAE,MAAM,EAAE,MAAM,eAAe,CAAC;AACvC,OAAO,EAAE,IAAI,EAAE,KAAK,EAAE,MAAM,QAAQ,CAAC;AACrC,OAAO,EAAE,wBAAwB,EAAE,wBAAwB,EAAE,MAAM,wBAAwB,CAAC;AAC5F,OAAO,EACH,sBAAsB,EACtB,wBAAwB,EACxB,iBAAiB,EACjB,kBAAkB,EAClB,cAAc,EACd,aAAa,EACb,gBAAgB,EAEhB,mBAAmB,EACnB,MAAM,EACN,sBAAsB,EACtB,uBAAuB,EAC1B,MAAM,kBAAkB,CAAC;AAC1B,OAAO,EAAE,+BAA+B,EAAE,MAAM,cAAc,CAAC;AAa/D,sEAAA;IAGI,YACI,kBAAuC,EAC/B,sBAA8C,EACvB,OAAqB,EAC5C,uBAAgD,EAChD,eAAiC;QAHjC,2BAAsB,GAAtB,sBAAsB,CAAwB;QACvB,YAAO,GAAP,OAAO,CAAc;QAC5C,4BAAuB,GAAvB,uBAAuB,CAAyB;QAChD,oBAAe,GAAf,eAAe,CAAkB;QAEzC,IAAI,CAAC,QAAQ,GAAG,kBAAkB,CAAC,GAAG,CAAC,+BAA+B,CAAC,CAAC;QACxE,IAAI,CAAC,sBAAsB,CAAC,SAAS,CAAC,MAAM,CAAC,WAAW,EAAE,GAAG,EAAE,CAC3D,IAAI,CAAC,sBAAsB,EAAE,CAChC,CAAC;IACN,CAAC;IAEM,8BAA8B,CAAC,SAAuC;QACzE,MAAM,MAAM,GAAW,SAAS,CAAC,OAAO,CACpC,IAAI,wBAAwB,IAAI,wBAAwB,GAAG,CAC9D,CAAC;QACF,OAAO,MAAM,CAAC;IAClB,CAAC;IAEM,gCAAgC,CAAC,SAAuC;QAC3E,MAAM,MAAM,GAAG,SAAS,CAAC,OAAO,CAC5B,IAAI,wBAAwB,IAAI,wBAAwB,GAAG,CAC9D,CAAC;QACF,OAAO,MAAM,CAAC,IAAI,CAAC,sBAAsB,CAAC,CAAC;IAC/C,CAAC;IAEY,mBAAmB;;YAC5B,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE;gBACxB,MAAM,IAAI,CAAC,sBAAsB,EAAE,CAAC;aACvC;YACD,OAAO,IAAI,CAAC,gBAAgB,CAAC;QACjC,CAAC;KAAA;IAEM,sCAAsC,CAAC,SAAuC;QACjF,MAAM,MAAM,GAAG,SAAS,CAAC,OAAO,CAC5B,IAAI,wBAAwB,IAAI,wBAAwB,GAAG,CAC9D,CAAC;QACF,OAAO,MAAM,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;IACjD,CAAC;IAEM,yBAAyB,CAAC,SAAuC;QACpE,MAAM,MAAM,GAAW,SAAS,CAAC,OAAO,CAAC,IAAI,cAAc,IAAI,iBAAiB,GAAG,CAAC,CAAC;QACrF,OAAO,MAAM,CAAC;IAClB,CAAC;IAEM,2BAA2B,CAAC,SAA+B;QAC9D,OAAO,IAAI,CAAC,uBAAuB,CAAC,yBAAyB,CAAC,SAAS,CAAC,CAAC;IAC7E,CAAC;IAEM,oBAAoB,CAAC,WAAmB,EAAE,aAAqB;QAClE,OAAO,IAAI,CAAC,uBAAuB,CAAC,oBAAoB,CAAC,WAAW,EAAE,aAAa,CAAC,CAAC;IACzF,CAAC;IAEM,mBAAmB,CAAC,WAAmB,EAAE,aAAqB;QACjE,OAAO,IAAI,CAAC,uBAAuB,CAAC,mBAAmB,CAAC,WAAW,EAAE,aAAa,CAAC,CAAC;IACxF,CAAC;IAEM,qBAAqB,CAAC,SAA+B;QACxD,OAAO,IAAI,CAAC,uBAAuB,CAAC,qBAAqB,CAAC,SAAS,CAAC,CAAC;IACzE,CAAC;IAEM,mBAAmB;QACtB,OAAO,IAAI,CAAC,uBAAuB,CAAC,mBAAmB,EAAE,CAAC;IAC9D,CAAC;IAED,eAAe,CAAC,QAAuC;QACnD,OAAO,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;IAClC,CAAC;IAEM,kCAAkC,CAAC,WAAmB;QACzD,IAAI,iBAAiB,GAAW,IAAI,CAAC,mBAAmB,EAAE,CAAC;QAC3D,iBAAiB,IAAI,IAAI,GAAG,sBAAsB,GAAG,IAAI,GAAG,WAAW,GAAG,IAAI,CAAC,CAAC,kCAAkC;QAClH,MAAM,SAAS,GAAQ,IAAI,CAAC,eAAe,CAAC,iBAAiB,CAAC,CAAC;QAC/D,OAAO,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,wBAAwB,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;IACnF,CAAC;IAEY,YAAY,CAAC,MAAc;;YACpC,MAAM,IAAI,CAAC,mBAAmB,EAAE,CAAC;YAEjC,MAAM,eAAe,GAAG,KAAK,CACzB,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,eAAe,EAAE,EAAE,CAAC,eAAe,CAAC,MAAM,KAAK,MAAM,CAAC,CACvF,CAAC;YACF,OAAO,eAAe,IAAI,eAAe,CAAC,UAAU,CAAC;QACzD,CAAC;KAAA;IAEa,sBAAsB;;YAChC,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,UAAU,EAAE,CAAC;YACvD,MAAM,WAAW,GAAG,MAAM,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,MAAM,EAAE,CAAC,CAAC;YACxD,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,WAAW,CAAC,mBAAmB,IAAI,EAAE,CAAC,CAAC;QACxE,CAAC;KAAA;CACJ,CAAA;AA9FD;IADC,kBAAkB,EAAE;IAOZ,WAAA,MAAM,CAAC,aAAa,CAAC,CAAA;qCAFF,mBAAmB;QACP,sBAAsB,YAErB,uBAAuB;QAC/B,gBAAgB;mEAsFhD\"}","dts":{"name":"/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/personalization/personalizationsmartedit/apps/personalizationsmartedit/node_modules/.cache/rollup-plugin-typescript2/placeholder/service/PersonalizationsmarteditComponentHandlerService.d.ts","writeByteOrderMark":false,"text":"import { IPageInfoService, IRestServiceFactory, CrossFrameEventService, ComponentHandlerService } from 'smarteditcommons';\r\nexport interface IPageContentSlot {\r\n    pageId: string;\r\n    position: string;\r\n    slotId: string;\r\n    slotShared?: boolean;\r\n    slotStatus?: string;\r\n}\r\nexport interface IPageContentSlotsResponse {\r\n    pageContentSlotList: IPageContentSlot[];\r\n}\r\nexport declare class PersonalizationsmarteditComponentHandlerService {\r\n    private crossFrameEventService;\r\n    private yjQuery;\r\n    private componentHandlerService;\r\n    private pageInfoService;\r\n    private pageContentSlots;\r\n    private readonly resource;\r\n    constructor(restServiceFactory: IRestServiceFactory, crossFrameEventService: CrossFrameEventService, yjQuery: JQueryStatic, componentHandlerService: ComponentHandlerService, pageInfoService: IPageInfoService);\r\n    getParentContainerForComponent(component: JQuery<HTMLElement> | JQuery): JQuery;\r\n    getParentContainerIdForComponent(component: JQuery<HTMLElement> | JQuery): string;\r\n    getPageContentSlots(): Promise<IPageContentSlot[]>;\r\n    getParentContainerSourceIdForComponent(component: JQuery<HTMLElement> | JQuery): string;\r\n    getParentSlotForComponent(component: JQuery<HTMLElement> | JQuery): JQuery;\r\n    getParentSlotIdForComponent(component: HTMLElement | JQuery): string;\r\n    getOriginalComponent(componentId: string, componentType: string): JQuery;\r\n    isExternalComponent(componentId: string, componentType: string): boolean;\r\n    getCatalogVersionUuid(component: HTMLElement | JQuery): string;\r\n    getAllSlotsSelector(): string;\r\n    getFromSelector(selector: string | HTMLElement | JQuery): JQuery;\r\n    getContainerSourceIdForContainerId(containerId: string): string;\r\n    isSlotShared(slotId: string): Promise<boolean>;\r\n    private reloadPageContentSlots;\r\n}\r\n"}}
