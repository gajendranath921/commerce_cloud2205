/**
 * @fileoverview added by tsickle
 * Generated from: lib/time-picker/format/time-parser.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { TimeObject } from '../../time/time-object';
import * as i0 from "@angular/core";
/**
 * @return {?}
 */
export function TIME_FORMAT_FACTORY() {
    return new TimeFormatParserDefault();
}
/**
 * Abstract class which defines the behaviour of the time format and parser.
 * @abstract
 */
export class TimeFormatParser {
}
TimeFormatParser.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root',
                useFactory: TIME_FORMAT_FACTORY
            },] }
];
/** @nocollapse */ TimeFormatParser.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: TIME_FORMAT_FACTORY, token: TimeFormatParser, providedIn: "root" });
if (false) {
    /**
     * Should take in a string value and return a Time object.
     * @abstract
     * @param {?} value String to convert to a time object.
     * @param {?} displaySeconds boolean to define if string should display seconds.
     * @param {?} displayMinutes boolean to define if string should display minutes.
     * @param {?=} meridian boolean to define if string should be treated as a meridian.
     * @return {?}
     */
    TimeFormatParser.prototype.parse = function (value, displaySeconds, displayMinutes, meridian) { };
    /**
     * Should take in a time object and return a string representation.
     * @abstract
     * @param {?} time TimeObject to convert to a string.
     * @param {?} displaySeconds boolean to define if string should display seconds.
     * @param {?} displayMinutes boolean to define if string should display minutes.
     * @param {?=} meridian boolean to define if TimeObject should be treated as a meridian.
     * @return {?}
     */
    TimeFormatParser.prototype.format = function (time, displaySeconds, displayMinutes, meridian) { };
}
/**
 * Default implementation of the DateFormatParser service.
 */
export class TimeFormatParserDefault extends TimeFormatParser {
    /**
     * Takes in a string representation of a date and returns a Time object.
     * @param {?} value String to convert to a time object.
     * @param {?=} displaySeconds boolean to define if string should display seconds.
     * @param {?=} displayMinutes boolean to define if string should display minutes.
     * @param {?=} meridian boolean to define if string should be treated as a meridian.
     * @return {?}
     */
    parse(value, displaySeconds = true, displayMinutes = true, meridian) {
        /** @type {?} */
        const time = new TimeObject();
        /** @type {?} */
        let regexp;
        if (!meridian) {
            if (displaySeconds) {
                regexp = /^([0-1]?[0-9]|2[0-3]):([0-5][0-9]|[0-9]):([0-5][0-9]|[0-9])$/;
            }
            else if (displayMinutes) {
                regexp = /^([0-1]?[0-9]|2[0-3]):([0-5][0-9]|[0-9])$/;
            }
            else {
                regexp = /^([0-1]?[0-9]|2[0-3])$/;
            }
            if (regexp.test(value)) {
                /** @type {?} */
                const splitString = value.split(':');
                time.hour = parseInt(splitString[0], 10);
                time.minute = parseInt(splitString[1], 10);
                if (displaySeconds) {
                    time.second = parseInt(splitString[2], 10);
                }
                return time;
            }
            else {
                return null;
            }
        }
        else if (meridian) {
            if (displaySeconds) {
                regexp = /^([0-1]?[0-9]|2[0-3]):([0-5][0-9]|[0-9]):([0-5][0-9]|[0-9]) [APap][mM]$/;
            }
            else if (displayMinutes) {
                regexp = /^([0-1]?[0-9]|2[0-3]):([0-5][0-9]|[0-9]) [APap][mM]$/;
            }
            else {
                regexp = /^([0-1]?[0-9]|2[0-3]) [APap][mM]$/;
            }
            if (regexp.test(value)) {
                /** @type {?} */
                const period = value.split(' ')[1];
                /** @type {?} */
                const splitString = value.split(':');
                time.hour = parseInt(splitString[0], 10);
                if ((period === 'pm' || period === 'PM') && time.hour < 12) {
                    time.hour = time.hour + 12;
                }
                else if ((period === 'am' || period === 'AM') && time.hour === 12) {
                    time.hour = 0;
                }
                time.minute = parseInt(splitString[1], 10);
                if (displaySeconds) {
                    time.second = parseInt(splitString[2], 10);
                }
                return time;
            }
            else {
                return null;
            }
        }
    }
    /**
     * Takes in a time object and returns the string representation.
     * @param {?} time TimeObject to convert to a string.
     * @param {?=} displaySeconds boolean to define if string should display seconds.
     * @param {?=} displayMinutes boolean to define if string should display minutes.
     * @param {?=} meridian boolean to define if TimeObject should be treated as a meridian.
     * @return {?}
     */
    format(time, displaySeconds = true, displayMinutes = true, meridian) {
        /** @type {?} */
        let formattedHour;
        /** @type {?} */
        let formattedMinute;
        /** @type {?} */
        let formattedSecond;
        /** @type {?} */
        let formattedTime;
        /** @type {?} */
        let formattedMeridian;
        if (time.hour !== null) {
            if (meridian) {
                if (time.hour === 0) {
                    formattedHour = 12;
                    formattedMeridian = 'am';
                }
                else if (time.hour > 12) {
                    formattedHour = time.hour - 12;
                    formattedMeridian = 'pm';
                }
                else if (time.hour === 12) {
                    formattedHour = 12;
                    formattedMeridian = 'pm';
                }
                else {
                    formattedHour = time.hour;
                    formattedMeridian = 'am';
                }
            }
            else {
                formattedHour = time.hour;
            }
        }
        if (time.minute !== null && displayMinutes) {
            formattedMinute = time.minute < 10 ? '0' + time.minute : time.minute;
        }
        if (time.second !== null && displaySeconds) {
            formattedSecond = time.second < 10 ? '0' + time.second : time.second;
        }
        if (formattedHour || formattedHour === 0) {
            formattedTime = formattedHour;
            if (formattedMinute || formattedMinute === '00') {
                formattedTime = formattedTime + ':' + formattedMinute;
                if (formattedSecond || formattedSecond === '00') {
                    formattedTime = formattedTime + ':' + formattedSecond;
                }
            }
        }
        if (formattedMeridian && formattedTime) {
            formattedTime += ' ' + formattedMeridian;
        }
        return formattedTime;
    }
}
TimeFormatParserDefault.decorators = [
    { type: Injectable }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZS1wYXJzZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZnVuZGFtZW50YWwtbmd4L2NvcmUvIiwic291cmNlcyI6WyJsaWIvdGltZS1waWNrZXIvZm9ybWF0L3RpbWUtcGFyc2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7Ozs7O0FBRXBELE1BQU0sVUFBVSxtQkFBbUI7SUFDL0IsT0FBTyxJQUFJLHVCQUF1QixFQUFFLENBQUM7QUFDekMsQ0FBQzs7Ozs7QUFTRCxNQUFNLE9BQWdCLGdCQUFnQjs7O1lBSnJDLFVBQVUsU0FBQztnQkFDUixVQUFVLEVBQUUsTUFBTTtnQkFDbEIsVUFBVSxFQUFFLG1CQUFtQjthQUNsQzs7Ozs7Ozs7Ozs7OztJQVVHLGtHQUFnSDs7Ozs7Ozs7OztJQVNoSCxrR0FBZ0g7Ozs7O0FBT3BILE1BQU0sT0FBTyx1QkFBd0IsU0FBUSxnQkFBZ0I7Ozs7Ozs7OztJQVNsRCxLQUFLLENBQUMsS0FBYSxFQUFFLGlCQUEwQixJQUFJLEVBQUUsaUJBQTBCLElBQUksRUFBRSxRQUFrQjs7Y0FDcEcsSUFBSSxHQUFHLElBQUksVUFBVSxFQUFFOztZQUN6QixNQUFNO1FBQ1YsSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNYLElBQUksY0FBYyxFQUFFO2dCQUNoQixNQUFNLEdBQUcsOERBQThELENBQUM7YUFDM0U7aUJBQU0sSUFBSSxjQUFjLEVBQUU7Z0JBQ3ZCLE1BQU0sR0FBRywyQ0FBMkMsQ0FBQzthQUN4RDtpQkFBTTtnQkFDSCxNQUFNLEdBQUcsd0JBQXdCLENBQUM7YUFDckM7WUFDRCxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUU7O3NCQUNkLFdBQVcsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQztnQkFDcEMsSUFBSSxDQUFDLElB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cmUnO1xuaW1wb3J0IHsgVGltZU9iamVjdCB9IGZyb20gJy4uLy4uL3RpbWUvdGltZS1vYmplY3QnO1xuXG5leHBvcnQgZnVuY3Rpb24gVElNRV9GT1JNQVRfRkFDVE9SWSgpIHtcbiAgICByZXR1cm4gbmV3IFRpbWVGb3JtYXRQYXJzZXJEZWZhdWx0KCk7XG59XG5cbi8qKlxuICogQWJzdHJhY3QgY2xhc3Mgd2hpY2ggZGVmaW5lcyB0aGUgYmVoYXZpb3VyIG9mIHRoZSB0aW1lIGZvcm1hdCBhbmQgcGFyc2VyLlxuICovXG5ASW5qZWN0YWJsZSh7XG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnLFxuICAgIHVzZUZhY3Rvcnk6IFRJTUVfRk9STUFUX0ZBQ1RPUllcbn0pXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgVGltZUZvcm1hdFBhcnNlciB7XG5cbiAgICAvKipcbiAgICAgKiBTaG91bGQgdGFrZSBpbiBhIHN0cmluZyB2YWx1ZSBhbmQgcmV0dXJuIGEgVGltZSBvYmplY3QuXG4gICAgICogQHBhcmFtIHZhbHVlIFN0cmluZyB0byBjb252ZXJ0IHRvIGEgdGltZSBvYmplY3QuXG4gICAgICogQHBhcmFtIG1lcmlkaWFuIGJvb2xlYW4gdG8gZGVmaW5lIGlmIHN0cmluZyBzaG91bGQgYmUgdHJlYXRlZCBhcyBhIG1lcmlkaWFuLlxuICAgICAqIEBwYXJhbSBkaXNwbGF5U2Vjb25kcyBib29sZWFuIHRvIGRlZmluZSBpZiBzdHJpbmcgc2hvdWxkIGRpc3BsYXkgc2Vjb25kcy5cbiAgICAgKiBAcGFyYW0gZGlzcGxheU1pbnV0ZXMgYm9vbGVhbiB0byBkZWZpbmUgaWYgc3RyaW5nIHNob3VsZCBkaXNwbGF5IG1pbnV0ZXMuXG4gICAgICovXG4gICAgYWJzdHJhY3QgcGFyc2UodmFsdWU6IHN0cmluZywgZGlzcGxheVNlY29uZHM6IGJvb2xlYW4sIGRpc3BsYXlNaW51dGVzOiBib29sZWFuLCBtZXJpZGlhbj86IGJvb2xlYW4pOiBUaW1lT2JqZWN0O1xuXG4gICAgLyoqXG4gICAgICogU2hvdWxkIHRha2UgaW4gYSB0aW1lIG9iamVjdCBhbmQgcmV0dXJuIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uLlxuICAgICAqIEBwYXJhbSB0aW1lIFRpbWVPYmplY3QgdG8gY29udmVydCB0byBhIHN0cmluZy5cbiAgICAgKiBAcGFyYW0gbWVyaWRpYW4gYm9vbGVhbiB0byBkZWZpbmUgaWYgVGltZU9iamVjdCBzaG91bGQgYmUgdHJlYXRlZCBhcyBhIG1lcmlkaWFuLlxuICAgICAqIEBwYXJhbSBkaXNwbGF5U2Vjb25kcyBib29sZWFuIHRvIGRlZmluZSBpZiBzdHJpbmcgc2hvdWxkIGRpc3BsYXkgc2Vjb25kcy5cbiAgICAgKiBAcGFyYW0gZGlzcGxheU1pbnV0ZXMgYm9vbGVhbiB0byBkZWZpbmUgaWYgc3RyaW5nIHNob3VsZCBkaXNwbGF5IG1pbnV0ZXMuXG4gICAgICovXG4gICAgYWJzdHJhY3QgZm9ybWF0KHRpbWU6IFRpbWVPYmplY3QsIGRpc3BsYXlTZWNvbmRzOiBib29sZWFuLCBkaXNwbGF5TWludXRlczogYm9vbGVhbiwgbWVyaWRpYW4/OiBib29sZWFuKTogc3RyaW5nO1xufVxuXG4vKipcbiAqIERlZmF1bHQgaW1wbGVtZW50YXRpb24gb2YgdGhlIERhdGVGb3JtYXRQYXJzZXIgc2VydmljZS5cbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFRpbWVGb3JtYXRQYXJzZXJEZWZhdWx0IGV4dGVuZHMgVGltZUZvcm1hdFBhcnNlciB7XG5cbiAgICAvKipcbiAgICAgKiBUYWtlcyBpbiBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiBhIGRhdGUgYW5kIHJldHVybnMgYSBUaW1lIG9iamVjdC5cbiAgICAgKiBAcGFyYW0gdmFsdWUgU3RyaW5nIHRvIGNvbnZlcnQgdG8gYSB0aW1lIG9iamVjdC5cbiAgICAgKiBAcGFyYW0gbWVyaWRpYW4gYm9vbGVhbiB0byBkZWZpbmUgaWYgc3RyaW5nIHNob3VsZCBiZSB0cmVhdGVkIGFzIGEgbWVyaWRpYW4uXG4gICAgICogQHBhcmFtIGRpc3BsYXlTZWNvbmRzIGJvb2xlYW4gdG8gZGVmaW5lIGlmIHN0cmluZyBzaG91bGQgZGlzcGxheSBzZWNvbmRzLlxuICAgICAqIEBwYXJhbSBkaXNwbGF5TWludXRlcyBib29sZWFuIHRvIGRlZmluZSBpZiBzdHJpbmcgc2hvdWxkIGRpc3BsYXkgbWludXRlcy5cbiAgICAgKi9cbiAgICBwdWJsaWMgcGFyc2UodmFsdWU6IHN0cmluZywgZGlzcGxheVNlY29uZHM6IGJvb2xlYW4gPSB0cnVlLCBkaXNwbGF5TWludXRlczogYm9vbGVhbiA9IHRydWUsIG1lcmlkaWFuPzogYm9vbGVhbik6IFRpbWVPYmplY3Qge1xuICAgICAgICBjb25zdCB0aW1lID0gbmV3IFRpbWVPYmplY3QoKTtcbiAgICAgICAgbGV0IHJlZ2V4cDtcbiAgICAgICAgaWYgKCFtZXJpZGlhbikge1xuICAgICAgICAgICAgaWYgKGRpc3BsYXlTZWNvbmRzKSB7XG4gICAgICAgICAgICAgICAgcmVnZXhwID0gL14oWzAtMV0/WzAtOV18MlswLTNdKTooWzAtNV1bMC05XXxbMC05XSk6KFswLTVdWzAtOV18WzAtOV0pJC87XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGRpc3BsYXlNaW51dGVzKSB7XG4gICAgICAgICAgICAgICAgcmVnZXhwID0gL14oWzAtMV0/WzAtOV18MlswLTNdKTooWzAtNV1bMC05XXxbMC05XSkkLztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVnZXhwID0gL14oWzAtMV0/WzAtOV18MlswLTNdKSQvO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHJlZ2V4cC50ZXN0KHZhbHVlKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNwbGl0U3RyaW5nID0gdmFsdWUuc3BsaXQoJzonKTtcbiAgICAgICAgICAgICAgICB0aW1lLmhvdXIgPSBwYXJzZUludChzcGxpdFN0cmluZ1swXSwgMTApO1xuICAgICAgICAgICAgICAgIHRpbWUubWludXRlID0gcGFyc2VJbnQoc3BsaXRTdHJpbmdbMV0sIDEwKTtcbiAgICAgICAgICAgICAgICBpZiAoZGlzcGxheVNlY29uZHMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGltZS5zZWNvbmQgPSBwYXJzZUludChzcGxpdFN0cmluZ1syXSwgMTApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdGltZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAobWVyaWRpYW4pIHtcbiAgICAgICAgICAgIGlmIChkaXNwbGF5U2Vjb25kcykge1xuICAgICAgICAgICAgICAgIHJlZ2V4cCA9IC9eKFswLTFdP1swLTldfDJbMC0zXSk6KFswLTVdWzAtOV18WzAtOV0pOihbMC01XVswLTldfFswLTldKSBbQVBhcF1bbU1dJC87XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGRpc3BsYXlNaW51dGVzKSB7XG4gICAgICAgICAgICAgICAgcmVnZXhwID0gL14oWzAtMV0/WzAtOV18MlswLTNdKTooWzAtNV1bMC05XXxbMC05XSkgW0FQYXBdW21NXSQvO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZWdleHAgPSAvXihbMC0xXT9bMC05XXwyWzAtM10pIFtBUGFwXVttTV0kLztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyZWdleHAudGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBwZXJpb2QgPSB2YWx1ZS5zcGxpdCgnICcpWzFdO1xuXG4gICAgICAgICAgICAgICAgY29uc3Qgc3BsaXRTdHJpbmcgPSB2YWx1ZS5zcGxpdCgnOicpO1xuICAgICAgICAgICAgICAgIHRpbWUuaG91ciA9IHBhcnNlSW50KHNwbGl0U3RyaW5nWzBdLCAxMCk7XG4gICAgICAgICAgICAgICAgaWYgKCggcGVyaW9kID09PSAncG0nIHx8IHBlcmlvZCA9PT0gJ1BNJyApICYmIHRpbWUuaG91ciA8IDEyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRpbWUuaG91ciA9IHRpbWUuaG91ciArIDEyO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIChwZXJpb2QgPT09ICdhbScgfHwgcGVyaW9kID09PSAnQU0nKSAmJiB0aW1lLmhvdXIgPT09IDEyICkge1xuICAgICAgICAgICAgICAgICAgICB0aW1lLmhvdXIgPSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aW1lLm1pbnV0ZSA9IHBhcnNlSW50KHNwbGl0U3RyaW5nWzFdLCAxMCk7XG4gICAgICAgICAgICAgICAgaWYgKGRpc3BsYXlTZWNvbmRzKSB7XG4gICAgICAgICAgICAgICAgICAgIHRpbWUuc2Vjb25kID0gcGFyc2VJbnQoc3BsaXRTdHJpbmdbMl0sIDEwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRpbWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVGFrZXMgaW4gYSB0aW1lIG9iamVjdCBhbmQgcmV0dXJucyB0aGUgc3RyaW5nIHJlcHJlc2VudGF0aW9uLlxuICAgICAqIEBwYXJhbSB0aW1lIFRpbWVPYmplY3QgdG8gY29udmVydCB0byBhIHN0cmluZy5cbiAgICAgKiBAcGFyYW0gbWVyaWRpYW4gYm9vbGVhbiB0byBkZWZpbmUgaWYgVGltZU9iamVjdCBzaG91bGQgYmUgdHJlYXRlZCBhcyBhIG1lcmlkaWFuLlxuICAgICAqIEBwYXJhbSBkaXNwbGF5U2Vjb25kcyBib29sZWFuIHRvIGRlZmluZSBpZiBzdHJpbmcgc2hvdWxkIGRpc3BsYXkgc2Vjb25kcy5cbiAgICAgKiBAcGFyYW0gZGlzcGxheU1pbnV0ZXMgYm9vbGVhbiB0byBkZWZpbmUgaWYgc3RyaW5nIHNob3VsZCBkaXNwbGF5IG1pbnV0ZXMuXG4gICAgICovXG4gICAgcHVibGljIGZvcm1hdCh0aW1lOiBUaW1lT2JqZWN0LCBkaXNwbGF5U2Vjb25kczogYm9vbGVhbiA9IHRydWUsIGRpc3BsYXlNaW51dGVzOiBib29sZWFuID0gdHJ1ZSwgbWVyaWRpYW4/OiBib29sZWFuKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IGZvcm1hdHRlZEhvdXIsIGZvcm1hdHRlZE1pbnV0ZSwgZm9ybWF0dGVkU2Vjb25kO1xuICAgICAgICBsZXQgZm9ybWF0dGVkVGltZTtcbiAgICAgICAgbGV0IGZvcm1hdHRlZE1lcmlkaWFuO1xuICAgICAgICBpZiAodGltZS5ob3VyICE9PSBudWxsKSB7XG4gICAgICAgICAgICBpZiAobWVyaWRpYW4pIHtcbiAgICAgICAgICAgICAgICBpZiAodGltZS5ob3VyID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlZEhvdXIgPSAxMjtcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0dGVkTWVyaWRpYW4gPSAnYW0nO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGltZS5ob3VyID4gMTIpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0dGVkSG91ciA9IHRpbWUuaG91ciAtIDEyO1xuICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZWRNZXJpZGlhbiA9ICdwbSc7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aW1lLmhvdXIgPT09IDEyKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlZEhvdXIgPSAxMjtcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0dGVkTWVyaWRpYW4gPSAncG0nO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlZEhvdXIgPSB0aW1lLmhvdXI7XG4gICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlZE1lcmlkaWFuID0gJ2FtJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvcm1hdHRlZEhvdXIgPSB0aW1lLmhvdXI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRpbWUubWludXRlICE9PSBudWxsICYmIGRpc3BsYXlNaW51dGVzKSB7XG4gICAgICAgICAgICBmb3JtYXR0ZWRNaW51dGUgPSB0aW1lLm1pbnV0ZSA8IDEwID8gJzAnICsgdGltZS5taW51dGUgOiB0aW1lLm1pbnV0ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aW1lLnNlY29uZCAhPT0gbnVsbCAmJiBkaXNwbGF5U2Vjb25kcykge1xuICAgICAgICAgICAgZm9ybWF0dGVkU2Vjb25kID0gdGltZS5zZWNvbmQgPCAxMCA/ICcwJyArIHRpbWUuc2Vjb25kIDogdGltZS5zZWNvbmQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZvcm1hdHRlZEhvdXIgfHwgZm9ybWF0dGVkSG91ciA9PT0gMCkge1xuICAgICAgICAgICAgZm9ybWF0dGVkVGltZSA9IGZvcm1hdHRlZEhvdXI7XG4gICAgICAgICAgICBpZiAoZm9ybWF0dGVkTWludXRlIHx8IGZvcm1hdHRlZE1pbnV0ZSA9PT0gJzAwJykge1xuICAgICAgICAgICAgICAgIGZvcm1hdHRlZFRpbWUgPSBmb3JtYXR0ZWRUaW1lICsgJzonICsgZm9ybWF0dGVkTWludXRlO1xuICAgICAgICAgICAgICAgIGlmIChmb3JtYXR0ZWRTZWNvbmQgfHwgZm9ybWF0dGVkU2Vjb25kID09PSAnMDAnKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlZFRpbWUgPSBmb3JtYXR0ZWRUaW1lICsgJzonICsgZm9ybWF0dGVkU2Vjb25kO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoZm9ybWF0dGVkTWVyaWRpYW4gJiYgZm9ybWF0dGVkVGltZSkge1xuICAgICAgICAgICAgZm9ybWF0dGVkVGltZSArPSAnICcgKyBmb3JtYXR0ZWRNZXJpZGlhblxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZvcm1hdHRlZFRpbWU7XG4gICAgfVxufVxuIl19