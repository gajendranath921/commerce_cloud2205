/**
 * @fileoverview added by tsickle
 * Generated from: lib/modal/modal-service/modal.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, Inject } from '@angular/core';
import { ModalComponent } from '../modal.component';
import { ModalBackdrop } from '../modal-utils/modal-backdrop';
import { ModalContainer } from '../modal-utils/modal-container';
import { ModalConfig } from '../modal-utils/modal-config';
import { DynamicComponentService } from '../../utils/dynamic-component/dynamic-component.service';
import { ModalRef } from '../modal-utils/modal-ref';
/**
 * Service used to dynamically generate a modal.
 */
var ModalService = /** @class */ (function () {
    /** @hidden */
    function ModalService(dynamicComponentService) {
        this.dynamicComponentService = dynamicComponentService;
        this.modals = [];
    }
    /**
     * Status of the modal service.
     * Returns true if there are open modals, false otherwise.
     */
    /**
     * Status of the modal service.
     * Returns true if there are open modals, false otherwise.
     * @return {?}
     */
    ModalService.prototype.hasOpenModals = /**
     * Status of the modal service.
     * Returns true if there are open modals, false otherwise.
     * @return {?}
     */
    function () {
        return this.modals && this.modals.length > 0;
    };
    /**
     * Dismisses all currently open modals.
     */
    /**
     * Dismisses all currently open modals.
     * @return {?}
     */
    ModalService.prototype.dismissAll = /**
     * Dismisses all currently open modals.
     * @return {?}
     */
    function () {
        var _this = this;
        this.modals.forEach((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            _this.destroyModalComponent(item.modalRef);
        }));
    };
    /**
     * Opens a modal component with a content of type TemplateRef or a component type.
     * @param contentType Content of the modal component.
     * @param modalConfig Configuration of the modal component.
     */
    /**
     * Opens a modal component with a content of type TemplateRef or a component type.
     * @param {?} contentType Content of the modal component.
     * @param {?=} modalConfig Configuration of the modal component.
     * @return {?}
     */
    ModalService.prototype.open = /**
     * Opens a modal component with a content of type TemplateRef or a component type.
     * @param {?} contentType Content of the modal component.
     * @param {?=} modalConfig Configuration of the modal component.
     * @return {?}
     */
    function (contentType, modalConfig) {
        var _this = this;
        if (modalConfig === void 0) { modalConfig = new ModalConfig(); }
        // Get default values from model
        modalConfig = Object.assign(new ModalConfig(), modalConfig);
        // Instantiate modal ref service
        /** @type {?} */
        var service = new ModalRef();
        service.data = modalConfig.data;
        // Create Container
        /** @type {?} */
        var container = this.dynamicComponentService.createDynamicComponent(contentType, ModalContainer, modalConfig);
        // Define Container to put backdrop and component to container
        modalConfig.container = container.location.nativeElement;
        // Create Backdrop
        /** @type {?} */
        var backdrop;
        if (modalConfig.hasBackdrop) {
            backdrop = this.dynamicComponentService.createDynamicComponent(contentType, ModalBackdrop, modalConfig, [service]);
        }
        // Create Component
        /** @type {?} */
        var component = this.dynamicComponentService.createDynamicComponent(contentType, ModalComponent, modalConfig, [service]);
        // Sizing
        this.setModalSize(component, modalConfig);
        // Positioning
        this.setModalPosition(component, modalConfig.position);
        this.modals.push({
            modalRef: component,
            containerRef: container,
            backdropRef: backdrop
        });
        /** @type {?} */
        var defaultBehaviourOnClose = (/**
         * @return {?}
         */
        function () {
            _this.destroyModalComponent(component);
            refSub.unsubscribe();
        });
        /** @type {?} */
        var refSub = service.afterClosed
            .subscribe(defaultBehaviourOnClose, defaultBehaviourOnClose);
        return service;
    };
    /**
     * @private
     * @param {?} modal
     * @return {?}
     */
    ModalService.prototype.destroyModalComponent = /**
     * @private
     * @param {?} modal
     * @return {?}
     */
    function (modal) {
        /** @type {?} */
        var arrayRef = this.modals.find((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item.modalRef === modal; }));
        /** @type {?} */
        var indexOf = this.modals.indexOf(arrayRef);
        this.dynamicComponentService.destroyComponent(arrayRef.modalRef);
        this.dynamicComponentService.destroyComponent(arrayRef.containerRef);
        arrayRef.containerRef.destroy();
        arrayRef.modalRef.destroy();
        if (arrayRef.backdropRef) {
            this.dynamicComponentService.destroyComponent(arrayRef.backdropRef);
            arrayRef.backdropRef.destroy();
        }
        this.modals[indexOf] = null;
        this.modals = this.modals.filter((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item !== null && item !== undefined; }));
    };
    /**
     * @private
     * @param {?} componentRef
     * @param {?} configObj
     * @return {?}
     */
    ModalService.prototype.setModalSize = /**
     * @private
     * @param {?} componentRef
     * @param {?} configObj
     * @return {?}
     */
    function (componentRef, configObj) {
        componentRef.location.nativeElement.style.minWidth = configObj.minWidth;
        componentRef.location.nativeElement.style.minHeight = configObj.minHeight;
        componentRef.location.nativeElement.style.maxWidth = configObj.maxWidth;
        componentRef.location.nativeElement.style.maxHeight = configObj.maxHeight;
        componentRef.location.nativeElement.style.width = configObj.width;
        componentRef.location.nativeElement.style.height = configObj.height;
    };
    /**
     * @private
     * @param {?} componentRef
     * @param {?} position
     * @return {?}
     */
    ModalService.prototype.setModalPosition = /**
     * @private
     * @param {?} componentRef
     * @param {?} position
     * @return {?}
     */
    function (componentRef, position) {
        if (position) {
            componentRef.location.nativeElement.style.top = position.top;
            componentRef.location.nativeElement.style.bottom = position.bottom;
            componentRef.location.nativeElement.style.right = position.right;
            componentRef.location.nativeElement.style.left = position.left;
        }
    };
    ModalService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    ModalService.ctorParameters = function () { return [
        { type: DynamicComponentService, decorators: [{ type: Inject, args: [DynamicComponentService,] }] }
    ]; };
    return ModalService;
}());
export { ModalService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    ModalService.prototype.modals;
    /**
     * @type {?}
     * @private
     */
    ModalService.prototype.dynamicComponentService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kYWwuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmdW5kYW1lbnRhbC1uZ3gvY29yZS8iLCJzb3VyY2VzIjpbImxpYi9tb2RhbC9tb2RhbC1zZXJ2aWNlL21vZGFsLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQ0gsVUFBVSxFQUdHLE1BQU0sRUFDdEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUM5RCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDaEUsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBRTFELE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLHlEQUF5RCxDQUFDO0FBQ2xHLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQzs7OztBQUtwRDtJQVFJLGNBQWM7SUFDZCxzQkFDNkMsdUJBQWdEO1FBQWhELDRCQUF1QixHQUF2Qix1QkFBdUIsQ0FBeUI7UUFSckYsV0FBTSxHQUlSLEVBQUUsQ0FBQztJQUtOLENBQUM7SUFFSjs7O09BR0c7Ozs7OztJQUNJLG9DQUFhOzs7OztJQUFwQjtRQUNJLE9BQU8sSUFBSSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFDakQsQ0FBQztJQUVEOztPQUVHOzs7OztJQUNJLGlDQUFVOzs7O0lBQWpCO1FBQUEsaUJBSUM7UUFIRyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU87Ozs7UUFBQyxVQUFBLElBQUk7WUFDcEIsS0FBSSxDQUFDLHFCQUFxQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUM5QyxDQUFDLEVBQUMsQ0FBQztJQUNQLENBQUM7SUFFRDs7OztPQUlHOzs7Ozs7O0lB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QUM7WUFDakUsWUFBWSxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLElBQUksR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDO1NBQ2xFO0lBQ0wsQ0FBQzs7Z0JBNUhKLFVBQVU7Ozs7Z0JBTkYsdUJBQXVCLHVCQWdCdkIsTUFBTSxTQUFDLHVCQUF1Qjs7SUFtSHZDLG1CQUFDO0NBQUEsQUE3SEQsSUE2SEM7U0E1SFksWUFBWTs7Ozs7O0lBQ3JCLDhCQUlTOzs7OztJQUlMLCtDQUF5RiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gICAgSW5qZWN0YWJsZSxcbiAgICBDb21wb25lbnRSZWYsXG4gICAgVHlwZSxcbiAgICBUZW1wbGF0ZVJlZiwgSW5qZWN0XG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTW9kYWxDb21wb25lbnQgfSBmcm9tICcuLi9tb2RhbC5jb21wb25lbnQnO1xuaW1wb3J0IHsgTW9kYWxCYWNrZHJvcCB9IGZyb20gJy4uL21vZGFsLXV0aWxzL21vZGFsLWJhY2tkcm9wJztcbmltcG9ydCB7IE1vZGFsQ29udGFpbmVyIH0gZnJvbSAnLi4vbW9kYWwtdXRpbHMvbW9kYWwtY29udGFpbmVyJztcbmltcG9ydCB7IE1vZGFsQ29uZmlnIH0gZnJvbSAnLi4vbW9kYWwtdXRpbHMvbW9kYWwtY29uZmlnJztcbmltcG9ydCB7IE1vZGFsUG9zaXRpb24gfSBmcm9tICcuLi9tb2RhbC11dGlscy9tb2RhbC1wb3NpdGlvbic7XG5pbXBvcnQgeyBEeW5hbWljQ29tcG9uZW50U2VydmljZSB9IGZyb20gJy4uLy4uL3V0aWxzL2R5bmFtaWMtY29tcG9uZW50L2R5bmFtaWMtY29tcG9uZW50LnNlcnZpY2UnO1xuaW1wb3J0IHsgTW9kYWxSZWYgfSBmcm9tICcuLi9tb2RhbC11dGlscy9tb2RhbC1yZWYnO1xuXG4vKipcbiAqIFNlcnZpY2UgdXNlZCB0byBkeW5hbWljYWxseSBnZW5lcmF0ZSBhIG1vZGFsLlxuICovXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgTW9kYWxTZXJ2aWNlIHtcbiAgICBwcml2YXRlIG1vZGFsczoge1xuICAgICAgICBtb2RhbFJlZjogQ29tcG9uZW50UmVmPE1vZGFsQ29tcG9uZW50PixcbiAgICAgICAgYmFja2Ryb3BSZWY/OiBDb21wb25lbnRSZWY8TW9kYWxCYWNrZHJvcD4sXG4gICAgICAgIGNvbnRhaW5lclJlZj86IENvbXBvbmVudFJlZjxNb2RhbENvbnRhaW5lcj5cbiAgICB9W10gPSBbXTtcblxuICAgIC8qKiBAaGlkZGVuICovXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIEBJbmplY3QoRHluYW1pY0NvbXBvbmVudFNlcnZpY2UpIHByaXZhdGUgZHluYW1pY0NvbXBvbmVudFNlcnZpY2U6IER5bmFtaWNDb21wb25lbnRTZXJ2aWNlXG4gICAgKSB7fVxuXG4gICAgLyoqXG4gICAgICogU3RhdHVzIG9mIHRoZSBtb2RhbCBzZXJ2aWNlLlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGVyZSBhcmUgb3BlbiBtb2RhbHMsIGZhbHNlIG90aGVyd2lzZS5cbiAgICAgKi9cbiAgICBwdWJsaWMgaGFzT3Blbk1vZGFscygpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubW9kYWxzICYmIHRoaXMubW9kYWxzLmxlbmd0aCA+IDA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGlzbWlzc2VzIGFsbCBjdXJyZW50bHkgb3BlbiBtb2RhbHMuXG4gICAgICovXG4gICAgcHVibGljIGRpc21pc3NBbGwoKTogdm9pZCB7XG4gICAgICAgIHRoaXMubW9kYWxzLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRlc3Ryb3lNb2RhbENvbXBvbmVudChpdGVtLm1vZGFsUmVmKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogT3BlbnMgYSBtb2RhbCBjb21wb25lbnQgd2l0aCBhIGNvbnRlbnQgb2YgdHlwZSBUZW1wbGF0ZVJlZiBvciBhIGNvbXBvbmVudCB0eXBlLlxuICAgICAqIEBwYXJhbSBjb250ZW50VHlwZSBDb250ZW50IG9mIHRoZSBtb2RhbCBjb21wb25lbnQuXG4gICAgICogQHBhcmFtIG1vZGFsQ29uZmlnIENvbmZpZ3VyYXRpb24gb2YgdGhlIG1vZGFsIGNvbXBvbmVudC5cbiAgICAgKi9cbiAgICBwdWJsaWMgb3Blbihjb250ZW50VHlwZTogVHlwZTxhbnk+IHwgVGVtcGxhdGVSZWY8YW55PiwgbW9kYWxDb25maWc6IE1vZGFsQ29uZmlnID0gbmV3IE1vZGFsQ29uZmlnKCkpOiBNb2RhbFJlZiB7XG5cbiAgICAgICAgLy8gR2V0IGRlZmF1bHQgdmFsdWVzIGZyb20gbW9kZWxcbiAgICAgICAgbW9kYWxDb25maWcgPSBPYmplY3QuYXNzaWduKG5ldyBNb2RhbENvbmZpZygpLCBtb2RhbENvbmZpZyk7XG5cbiAgICAgICAgLy8gSW5zdGFudGlhdGUgbW9kYWwgcmVmIHNlcnZpY2VcbiAgICAgICAgY29uc3Qgc2VydmljZTogTW9kYWxSZWYgPSBuZXcgTW9kYWxSZWYoKTtcbiAgICAgICAgc2VydmljZS5kYXRhID0gbW9kYWxDb25maWcuZGF0YTtcblxuICAgICAgICAvLyBDcmVhdGUgQ29udGFpbmVyXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lcjogQ29tcG9uZW50UmVmPE1vZGFsQ29udGFpbmVyPiA9IHRoaXMuZHluYW1pY0NvbXBvbmVudFNlcnZpY2UuY3JlYXRlRHluYW1pY0NvbXBvbmVudFxuICAgICAgICAgICAgPCBNb2RhbENvbnRhaW5lciA+IChjb250ZW50VHlwZSwgTW9kYWxDb250YWluZXIsIG1vZGFsQ29uZmlnKVxuICAgICAgICA7XG5cbiAgICAgICAgLy8gRGVmaW5lIENvbnRhaW5lciB0byBwdXQgYmFja2Ryb3AgYW5kIGNvbXBvbmVudCB0byBjb250YWluZXJcbiAgICAgICAgbW9kYWxDb25maWcuY29udGFpbmVyID0gY29udGFpbmVyLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnQ7XG5cbiAgICAgICAgLy8gQ3JlYXRlIEJhY2tkcm9wXG4gICAgICAgIGxldCBiYWNrZHJvcDogQ29tcG9uZW50UmVmPE1vZGFsQmFja2Ryb3A+O1xuICAgICAgICBpZiAobW9kYWxDb25maWcuaGFzQmFja2Ryb3ApIHtcbiAgICAgICAgICAgIGJhY2tkcm9wID0gdGhpcy5keW5hbWljQ29tcG9uZW50U2VydmljZS5jcmVhdGVEeW5hbWljQ29tcG9uZW50PE1vZGFsQmFja2Ryb3A+XG4gICAgICAgICAgICAgICAgKGNvbnRlbnRUeXBlLCBNb2RhbEJhY2tkcm9wLCBtb2RhbENvbmZpZywgW3NlcnZpY2VdKVxuICAgICAgICAgICAgO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ3JlYXRlIENvbXBvbmVudFxuICAgICAgICBjb25zdCBjb21wb25lbnQgPSB0aGlzLmR5bmFtaWNDb21wb25lbnRTZXJ2aWNlLmNyZWF0ZUR5bmFtaWNDb21wb25lbnRcbiAgICAgICAgICAgIDwgTW9kYWxDb21wb25lbnQgPiAoY29udGVudFR5cGUsIE1vZGFsQ29tcG9uZW50LCBtb2RhbENvbmZpZywgW3NlcnZpY2VdKVxuICAgICAgICA7XG5cbiAgICAgICAgLy8gU2l6aW5nXG4gICAgICAgIHRoaXMuc2V0TW9kYWxTaXplKGNvbXBvbmVudCwgbW9kYWxDb25maWcpO1xuXG4gICAgICAgIC8vIFBvc2l0aW9uaW5nXG4gICAgICAgIHRoaXMuc2V0TW9kYWxQb3NpdGlvbihjb21wb25lbnQsIG1vZGFsQ29uZmlnLnBvc2l0aW9uKTtcblxuICAgICAgICB0aGlzLm1vZGFscy5wdXNoKHtcbiAgICAgICAgICAgIG1vZGFsUmVmOiBjb21wb25lbnQsXG4gICAgICAgICAgICBjb250YWluZXJSZWY6IGNvbnRhaW5lcixcbiAgICAgICAgICAgIGJhY2tkcm9wUmVmOiBiYWNrZHJvcFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBkZWZhdWx0QmVoYXZpb3VyT25DbG9zZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGVzdHJveU1vZGFsQ29tcG9uZW50KGNvbXBvbmVudCk7XG4gICAgICAgICAgICByZWZTdWIudW5zdWJzY3JpYmUoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCByZWZTdWIgPSBzZXJ2aWNlLmFmdGVyQ2xvc2VkXG4gICAgICAgICAgICAuc3Vic2NyaWJlKGRlZmF1bHRCZWhhdmlvdXJPbkNsb3NlLCBkZWZhdWx0QmVoYXZpb3VyT25DbG9zZSlcbiAgICAgICAgO1xuXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuICAgIH1cblxuICAgIHByaXZhdGUgZGVzdHJveU1vZGFsQ29tcG9uZW50KG1vZGFsOiBDb21wb25lbnRSZWY8TW9kYWxDb21wb25lbnQ+KTogdm9pZCB7XG5cbiAgICAgICAgY29uc3QgYXJyYXlSZWYgPSB0aGlzLm1vZGFscy5maW5kKChpdGVtKSA9PiBpdGVtLm1vZGFsUmVmID09PSBtb2RhbCk7XG4gICAgICAgIGNvbnN0IGluZGV4T2YgPSB0aGlzLm1vZGFscy5pbmRleE9mKGFycmF5UmVmKTtcbiAgICAgICAgdGhpcy5keW5hbWljQ29tcG9uZW50U2VydmljZS5kZXN0cm95Q29tcG9uZW50KGFycmF5UmVmLm1vZGFsUmVmKTtcbiAgICAgICAgdGhpcy5keW5hbWljQ29tcG9uZW50U2VydmljZS5kZXN0cm95Q29tcG9uZW50KGFycmF5UmVmLmNvbnRhaW5lclJlZik7XG4gICAgICAgIGFycmF5UmVmLmNvbnRhaW5lclJlZi5kZXN0cm95KCk7XG4gICAgICAgIGFycmF5UmVmLm1vZGFsUmVmLmRlc3Ryb3koKTtcblxuICAgICAgICBpZiAoYXJyYXlSZWYuYmFja2Ryb3BSZWYpIHtcbiAgICAgICAgICAgIHRoaXMuZHluYW1pY0NvbXBvbmVudFNlcnZpY2UuZGVzdHJveUNvbXBvbmVudChhcnJheVJlZi5iYWNrZHJvcFJlZik7XG4gICAgICAgICAgICBhcnJheVJlZi5iYWNrZHJvcFJlZi5kZXN0cm95KCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm1vZGFsc1tpbmRleE9mXSA9IG51bGw7XG4gICAgICAgIHRoaXMubW9kYWxzID0gdGhpcy5tb2RhbHMuZmlsdGVyKGl0ZW0gPT4gaXRlbSAhPT0gbnVsbCAmJiBpdGVtICE9PSB1bmRlZmluZWQpO1xuXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXRNb2RhbFNpemUoY29tcG9uZW50UmVmOiBDb21wb25lbnRSZWY8TW9kYWxDb21wb25lbnQ+LCBjb25maWdPYmo6IE1vZGFsQ29uZmlnKTogdm9pZCB7XG4gICAgICAgIGNvbXBvbmVudFJlZi5sb2NhdGlvbi5uYXRpdmVFbGVtZW50LnN0eWxlLm1pbldpZHRoID0gY29uZmlnT2JqLm1pbldpZHRoO1xuICAgICAgICBjb21wb25lbnRSZWYubG9jYXRpb24ubmF0aXZlRWxlbWVudC5zdHlsZS5taW5IZWlnaHQgPSBjb25maWdPYmoubWluSGVpZ2h0O1xuICAgICAgICBjb21wb25lbnRSZWYubG9jYXRpb24ubmF0aXZlRWxlbWVudC5zdHlsZS5tYXhXaWR0aCA9IGNvbmZpZ09iai5tYXhXaWR0aDtcbiAgICAgICAgY29tcG9uZW50UmVmLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnQuc3R5bGUubWF4SGVpZ2h0ID0gY29uZmlnT2JqLm1heEhlaWdodDtcbiAgICAgICAgY29tcG9uZW50UmVmLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnQuc3R5bGUud2lkdGggPSBjb25maWdPYmoud2lkdGg7XG4gICAgICAgIGNvbXBvbmVudFJlZi5sb2NhdGlvbi5uYXRpdmVFbGVtZW50LnN0eWxlLmhlaWdodCA9IGNvbmZpZ09iai5oZWlnaHQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXRNb2RhbFBvc2l0aW9uKGNvbXBvbmVudFJlZjogQ29tcG9uZW50UmVmPE1vZGFsQ29tcG9uZW50PiwgcG9zaXRpb246IE1vZGFsUG9zaXRpb24pOiB2b2lkIHtcbiAgICAgICAgaWYgKHBvc2l0aW9uKSB7XG4gICAgICAgICAgICBjb21wb25lbnRSZWYubG9jYXRpb24ubmF0aXZlRWxlbWVudC5zdHlsZS50b3AgPSBwb3NpdGlvbi50b3A7XG4gICAgICAgICAgICBjb21wb25lbnRSZWYubG9jYXRpb24ubmF0aXZlRWxlbWVudC5zdHlsZS5ib3R0b20gPSBwb3NpdGlvbi5ib3R0b207XG4gICAgICAgICAgICBjb21wb25lbnRSZWYubG9jYXRpb24ubmF0aXZlRWxlbWVudC5zdHlsZS5yaWdodCA9IHBvc2l0aW9uLnJpZ2h0O1xuICAgICAgICAgICAgY29tcG9uZW50UmVmLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnQuc3R5bGUubGVmdCA9IHBvc2l0aW9uLmxlZnQ7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=