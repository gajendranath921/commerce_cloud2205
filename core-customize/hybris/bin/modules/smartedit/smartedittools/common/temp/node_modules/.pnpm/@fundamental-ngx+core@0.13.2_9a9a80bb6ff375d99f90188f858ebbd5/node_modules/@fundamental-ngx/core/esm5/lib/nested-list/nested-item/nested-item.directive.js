/**
 * @fileoverview added by tsickle
 * Generated from: lib/nested-list/nested-item/nested-item.directive.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ContentChild, Directive, ElementRef, EventEmitter, forwardRef, HostBinding, Input, Output } from '@angular/core';
import { NestedLinkDirective } from '../nested-link/nested-link.directive';
import { NestedListKeyboardService } from '../nested-list-keyboard.service';
import { NestedListPopoverComponent } from '../nested-list-popover/nested-list-popover.component';
import { NestedListDirective } from '../nested-list/nested-list.directive';
import { PreparedNestedListComponent } from '../prepared-nested-list/prepared-nested-list.component';
var NestedItemDirective = /** @class */ (function () {
    /** @hidden */
    function NestedItemDirective(elementRef, keyboardService) {
        this.elementRef = elementRef;
        this.keyboardService = keyboardService;
        /**
         * @hidden
         */
        this.fdNestedListItemClass = true;
        /**
         * @hidden
         */
        this._expanded = false;
        /**
         * Event thrown, when expanded state is changed
         */
        this.expandedChange = new EventEmitter();
        /**
         * Event thrown, when any keyboard event is dispatched on this, or link element
         */
        this.keyboardTriggered = new EventEmitter();
    }
    Object.defineProperty(NestedItemDirective.prototype, "hasChildren", {
        /** Check if the item element has any child */
        get: /**
         * Check if the item element has any child
         * @return {?}
         */
        function () {
            return !!(this.nestedListItem || this.popoverItem || this.nestedListFromPreparedComponent);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NestedItemDirective.prototype, "allChildrenItems", {
        /** Get all of the children item elements */
        get: /**
         * Get all of the children item elements
         * @return {?}
         */
        function () {
            if (this.nestedListItem && this.nestedListItem.nestedItems) {
                /** Get elements from child list */
                return this.nestedListItem.nestedItems.toArray();
            }
            else if (this.nestedListFromPreparedComponent && this.nestedListFromPreparedComponent.nestedItems) {
                /** Get elements from child prepared list  component */
                return this.nestedListFromPreparedComponent.nestedItems.toArray();
            }
            else {
                return [];
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NestedItemDirective.prototype, "expanded", {
        /** @hidden */
        get: /**
         * @hidden
         * @return {?}
         */
        function () {
            return this._expanded;
        },
        /** Whether item should be expanded */
        set: /**
         * Whether item should be expanded
         * @param {?} expanded
         * @return {?}
         */
        function (expanded) {
            this.propagateOpenChange(expanded);
        },
        enumerable: true,
        configurable: true
    });
    /** @hidden */
    /**
     * @hidden
     * @return {?}
     */
    NestedItemDirective.prototype.ngAfterContentInit = /**
     * @hidden
     * @return {?}
     */
    function () {
        var _this = this;
        /** Propagate hasChildren property */
        if (this.hasChildren && this.linkItem) {
            this.linkItem.hasChildren = true;
            this.linkItem.changeDetRef.detectChanges();
        }
        if (this.linkItem) {
            /** Subscribe to mouse click event, thrown by link item */
            this.linkItem.clicked.subscribe((/**
             * @return {?}
             */
            function () { return _this.toggle(); }));
            /** Subscribe to keyboard event and throw it farther */
            this.linkItem.keyboardTriggered.subscribe((/**
             * @param {?} keyboardEvent
             * @return {?}
             */
            function (keyboardEvent) {
                return _this.keyboardTriggered.emit(keyboardEvent);
            }));
        }
        /** Pass this element to popover child item, to allow control `expanded` value */
        if (this.popoverItem) {
            this.popoverItem.parentItemElement = this;
        }
        /** Propagate initial open state to children */
        this.propagateOpenChange(this._expanded);
    };
    /** Method that expand the item and propagate it to children */
    /**
     * Method that expand the item and propagate it to children
     * @return {?}
     */
    NestedItemDirective.prototype.triggerOpen = /**
     * Method that expand the item and propagate it to children
     * @return {?}
     */
    function () {
        if (!this.expanded) {
            /** Propagate initial open state to children */
            this.propagateOpenChange(true);
        }
    };
    /** Method that close the item and propagate it to children */
    /**
     * Method that close the item and propagate it to children
     * @return {?}
     */
    NestedItemDirective.prototype.triggerClose = /**
     * Method that close the item and propagate it to children
     * @return {?}
     */
    function () {
        if (this.expanded) {
            /** Propagate initial open state to children */
            this.propagateOpenChange(false);
        }
    };
    /** Method that toggle the item and propagate it to children */
    /**
     * Method that toggle the item and propagate it to children
     * @return {?}
     */
    NestedItemDirective.prototype.toggle = /**
     * Method that toggle the item and propagate it to children
     * @return {?}
     */
    function () {
        /** Propagate initial open state to children */
        this.propagateOpenChange(!this._expanded);
    };
    /** Method that dispatches `click` event on link item*/
    /**
     * Method that dispatches `click` event on link item
     * @return {?}
     */
    NestedItemDirective.prototype.click = /**
     * Method that dispatches `click` event on link item
     * @return {?}
     */
    function () {
        if (this.linkItem) {
            this.linkItem.click();
        }
    };
    /** Method that focuses link item*/
    /**
     * Method that focuses link item
     * @return {?}
     */
    NestedItemDirective.prototype.focus = /**
     * Method that focuses link item
     * @return {?}
     */
    function () {
        if (this.linkItem) {
            this.linkItem.focus();
        }
    };
    /**
     * @hidden
     * Propagate open state to all of the children
     */
    /**
     * @hidden
     * Propagate open state to all of the children
     * @private
     * @param {?} open
     * @return {?}
     */
    NestedItemDirective.prototype.propagateOpenChange = /**
     * @hidden
     * Propagate open state to all of the children
     * @private
     * @param {?} open
     * @return {?}
     */
    function (open) {
        this._expanded = open;
        if (this.linkItem) {
            this.linkItem.expanded = open;
        }
        if (this.nestedListItem) {
            this.nestedListItem.hidden = !open;
        }
        if (this.nestedListFromPreparedComponent) {
            this.nestedListFromPreparedComponent.hidden = !open;
        }
        if (this.popoverItem) {
            this.popoverItem.open = open;
        }
        /** Trigger event to provide keyboard support to new list of opened item element. */
        this.keyboardService.refresh$.next();
        this.expandedChange.emit(open);
    };
    Object.defineProperty(NestedItemDirective.prototype, "nestedListFromPreparedComponent", {
        /**
         * @hidden
         */
        get: /**
         * @hidden
         * @private
         * @return {?}
         */
        function () {
            return this.preparedListComponent && this.preparedListComponent.nestedListDirective;
        },
        enumerable: true,
        configurable: true
    });
    NestedItemDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[fdNestedItem], [fd-nested-list-item]'
                },] }
    ];
    /** @nocollapse */
    NestedItemDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: NestedListKeyboardService }
    ]; };
    NestedItemDirective.propDecorators = {
        fdNestedListItemClass: [{ type: HostBinding, args: ['class.fd-nested-list__item',] }],
        linkItem: [{ type: ContentChild, args: [NestedLinkDirective, { static: false },] }],
        popoverItem: [{ type: ContentChild, args: [NestedListPopoverComponent, { static: false },] }],
        nestedListItem: [{ type: ContentChild, args: [forwardRef((/**
                     * @return {?}
                     */
                    function () { return NestedListDirective; })), { static: false },] }],
        preparedListComponent: [{ type: ContentChild, args: [forwardRef((/**
                     * @return {?}
                     */
                    function () { return PreparedNestedListComponent; })), { static: false },] }],
        expanded: [{ type: Input }],
        expandedChange: [{ type: Output }],
        keyboardTriggered: [{ type: Output }]
    };
    return NestedItemDirective;
}());
export { NestedItemDirective };
if (false) {
    /**
     * @hidden
     * @type {?}
     */
    NestedItemDirective.prototype.fdNestedListItemClass;
    /**
     * @hidden
     * Reference to the link directive, to allow manipulating the properties of this element.
     * @type {?}
     */
    NestedItemDirective.prototype.linkItem;
    /**
     * @hidden
     * @type {?}
     */
    NestedItemDirective.prototype.popoverItem;
    /**
     * @hidden
     * @type {?}
     */
    NestedItemDirective.prototype.nestedListItem;
    /**
     * @hidden
     * @type {?}
     */
    NestedItemDirective.prototype.preparedListComponent;
    /**
     * @hidden
     * @type {?}
     * @private
     */
    NestedItemDirective.prototype._expanded;
    /**
     * Event thrown, when expanded state is changed
     * @type {?}
     */
    NestedItemDirective.prototype.expandedChange;
    /**
     * Event thrown, when any keyboard event is dispatched on this, or link element
     * @type {?}
     */
    NestedItemDirective.prototype.keyboardTriggered;
    /**
     * @type {?}
     * @private
     */
    NestedItemDirective.prototype.elementRef;
    /**
     * @type {?}
     * @private
     */
    NestedItemDirective.prototype.keyboardService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmVzdGVkLWl0ZW0uZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGZ1bmRhbWVudGFsLW5neC9jb3JlLyIsInNvdXJjZXMiOlsibGliL25lc3RlZC1saXN0L25lc3RlZC1pdGVtL25lc3RlZC1pdGVtLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFFSCxZQUFZLEVBQ1osU0FBUyxFQUNULFVBQVUsRUFDVixZQUFZLEVBQ1osVUFBVSxFQUNWLFdBQVcsRUFDWCxLQUFLLEVBQ0wsTUFBTSxFQUNULE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBQzNFLE9BQU8sRUFBRSx5QkFBeUIsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBQzVFLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLHNEQUFzRCxDQUFDO0FBRWxHLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBQzNFLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLHdEQUF3RCxDQUFDO0FBRXJHO0lBZ0RJLGNBQWM7SUFDZCw2QkFDWSxVQUFzQixFQUN0QixlQUEwQztRQUQxQyxlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQ3RCLG9CQUFlLEdBQWYsZUFBZSxDQUEyQjs7OztRQTVDdEQsMEJBQXFCLEdBQVksSUFBSSxDQUFDOzs7O1FBMEQ5QixjQUFTLEdBQVksS0FBSyxDQUFDOzs7O1FBSTFCLG1CQUFjLEdBQTBCLElBQUksWUFBWSxFQUFXLENBQUM7Ozs7UUFJcEUsc0JBQWlCLEdBQWdDLElBQUksWUFBWSxFQUFpQixDQUFDO0lBckJ6RixDQUFDO0lBdkJKLHNCQUFXLDRDQUFXO1FBRHRCLDhDQUE4Qzs7Ozs7UUFDOUM7WUFDSSxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLElBQUksSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsK0JBQStCLENBQUMsQ0FBQztRQUMvRixDQUFDOzs7T0FBQTtJQUdELHNCQUFXLGlEQUFnQjtRQUQzQiw0Q0FBNEM7Ozs7O1FBQzVDO1lBQ0ksSUFBSSxJQUFJLENBQUMsY0FBYyxJQUFJLElBQUksQ0FBQyxjQUFjLENBQUMsV0FBVyxFQUFFO2dCQUN4RCxtQ0FBbUM7Z0JBQ25DLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxXQUFXLENBQUMsT0FBTyxFQUFFLENBQUM7YUFFcEQ7aUJBQU0sSUFBSSxJQUFJLENBQUMsK0JBQStCLElBQUksSUFBSSxDQUFDLCtCQUErQixDQUFDLFdBQVcsRUFBRTtnQkFDakcsdURBQXVEO2dCQUN2RCxPQUFPLElBQUksQ0FBQywrQkFBK0IsQ0FBQyxXQUFXLENBQUMsT0FBTyxFQUFFLENBQUM7YUFFckU7aUJBQU07Z0JBQ0gsT0FBTyxFQUFFLENBQUM7YUFDYjtRQUNMLENBQUM7OztPQUFBO0lBU0Qsc0JBQWEseUNBQVE7UUFJckIsY0FBYzs7Ozs7UUFDZDtZQUNJLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQztRQUMxQixDQUFDO1FBUkQsc0NBQXNDOzs7Ozs7UUFDdEMsVUFBc0IsUUFBaUI7WUFDbkMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3ZDLENBQUM7OztPQUFBO0lBa0JELGNBQWM7Ozs7O0lBQ2QsZ0RBQWtCOzs7O0lBQWxCO1FBQUEsaUJBeUJDO1FBdkJHLHFDQUFxQztRQUNyQyxJQUFJLElBQUksQ0FBQyxXQUFXLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNuQyxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUM7WUFDakMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsYUFBYSxFQUFFLENBQUM7U0FDOUM7UUFFRCxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDZiwwREFBMEQ7WUFDMUQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsU0FBUzs7O1lBQUMsY0FBTSxPQUFBLEtBQUksQ0FBQyxNQUFNLEVBQUUsRUFBYixDQUFhLEVBQUMsQ0FBQztZQUVyRCx1REFBdUQ7WUFDdkQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTOzs7O1lBQUMsVUFBQSxhQUFhO2dCQUNuRCxPQUFBLEtBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDO1lBQTFDLENBQTBDLEVBQzdDLENBQUM7U0FDTDtRQUVELGlGQUFpRjtRQUNqRixJQUFJLElBQUksQ0FBQyxXQUFXLEVBQUU7WUFDbEIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLENBQUM7U0FDN0M7UUFFRCwrQ0FBK0M7UUFDL0MsSUFBSSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBRUQsK0RBQStEOzs7OztJQUMvRCx5Q0FBVzs7OztJQUFYO1FBQ0ksSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDaEIsK0NBQStDO1lBQy9DLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNsQztJQUNMLENBQUM7SUFFRCw4REFBOEQ7Ozs7O0lBQzlELDBDQUFZOzs7O0lBQVo7UUFDSSxJQUFJLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDZiwrQ0FBK0M7WUFDL0MsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ25DO0lBQ0wsQ0FBQztJQUVELCtEQUErRDs7Ozs7SUFDL0Qsb0NBQU07Ozs7SUFBTjtRQUNJLCtDQUErQztRQUMvQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDOUMsQ0FBQztJQUVELHVEQUF1RDs7Ozs7SUFDdkQsbUNBQUs7Ozs7SUFBTDtRQUNJLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNmLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLENBQUM7U0FDekI7SUFDTCxDQUFDO0lBRUQsbUNBQW1DOzs7OztJQUNuQyxtQ0FBSzs7OztJQUFMO1FBQ0ksSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2YsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztTQUN6QjtJQUNMLENBQUM7SUFFRDs7O09BR0c7Ozs7Ozs7O0lBQ0ssaURBQW1COzs7Ozs7O0lBQTNCLFVBQTRCLElBQWE7UUFDckMsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7UUFFdEIsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2YsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1NBQ2pDO1FBRUQsSUFBSSxJQUFJLENBQUMsY0FBYyxFQUFFO1lBQ3JCLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxDQUFDO1NBQ3RDO1FBRUQsSUFBSSxJQUFJLENBQUMsK0JBQStCLEVBQUU7WUFDdEMsSUFBSSxDQUFDLCtCQUErQixDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksQ0FBQztTQUN2RDtRQUVELElBQUksSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUNsQixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7U0FDaEM7UUFFRCxvRkFBb0Y7UUFDcEYsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDckMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkMsQ0FBQztJQUtELHNCQUFZLGdFQUErQjtRQUgzQzs7V0FFRzs7Ozs7O1FBQ0g7WUFDSSxPQUFPLElBQUksQ0FBQyxxQkFBcUIsSUFBSSxJQUFJLENBQUMscUJBQXFCLENBQUMsbUJBQW1CLENBQUM7UUFDeEYsQ0FBQzs7O09BQUE7O2dCQTVLSixTQUFTLFNBQUM7b0JBQ1AsUUFBUSxFQUFFLHVDQUF1QztpQkFDcEQ7Ozs7Z0JBaEJHLFVBQVU7Z0JBUUwseUJBQXlCOzs7d0NBWTdCLFdBQVcsU0FBQyw0QkFBNEI7MkJBT3hDLFlBQVksU0FBQyxtQkFBbUIsRUFBRSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUU7OEJBSW5ELFlBQVksU0FBQywwQkFBMEIsRUFBRSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUU7aUNBSTFELFlBQVksU0FBQyxVQUFVOzs7b0JBQUMsY0FBTSxPQUFBLG1CQUFtQixFQUFuQixDQUFtQixFQUFDLEVBQUUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFO3dDQUlyRSxZQUFZLFNBQUMsVUFBVTs7O29CQUFDLGNBQU0sT0FBQSwyQkFBMkIsRUFBM0IsQ0FBMkIsRUFBQyxFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRTsyQkE4QjdFLEtBQUs7aUNBYUwsTUFBTTtvQ0FJTixNQUFNOztJQXNHWCwwQkFBQztDQUFBLEFBOUtELElBOEtDO1NBM0tZLG1CQUFtQjs7Ozs7O0lBRzVCLG9EQUNzQzs7Ozs7O0lBTXRDLHVDQUM4Qjs7Ozs7SUFHOUIsMENBQ3dDOzs7OztJQUd4Qyw2Q0FDb0M7Ozs7O0lBR3BDLG9EQUNtRDs7Ozs7O0lBdUNuRCx3Q0FBbUM7Ozs7O0lBR25DLDZDQUM2RTs7Ozs7SUFHN0UsZ0RBQzRGOzs7OztJQXZCeEYseUNBQThCOzs7OztJQUM5Qiw4Q0FBa0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICAgIEFmdGVyQ29udGVudEluaXQsXG4gICAgQ29udGVudENoaWxkLFxuICAgIERpcmVjdGl2ZSxcbiAgICBFbGVtZW50UmVmLFxuICAgIEV2ZW50RW1pdHRlcixcbiAgICBmb3J3YXJkUmVmLFxuICAgIEhvc3RCaW5kaW5nLFxuICAgIElucHV0LFxuICAgIE91dHB1dFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE5lc3RlZExpbmtEaXJlY3RpdmUgfSBmcm9tICcuLi9uZXN0ZWQtbGluay9uZXN0ZWQtbGluay5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgTmVzdGVkTGlzdEtleWJvYXJkU2VydmljZSB9IGZyb20gJy4uL25lc3RlZC1saXN0LWtleWJvYXJkLnNlcnZpY2UnO1xuaW1wb3J0IHsgTmVzdGVkTGlzdFBvcG92ZXJDb21wb25lbnQgfSBmcm9tICcuLi9uZXN0ZWQtbGlzdC1wb3BvdmVyL25lc3RlZC1saXN0LXBvcG92ZXIuY29tcG9uZW50JztcbmltcG9ydCB7IE5lc3RlZEl0ZW1JbnRlcmZhY2UgfSBmcm9tICcuL25lc3RlZC1pdGVtLmludGVyZmFjZSc7XG5pbXBvcnQgeyBOZXN0ZWRMaXN0RGlyZWN0aXZlIH0gZnJvbSAnLi4vbmVzdGVkLWxpc3QvbmVzdGVkLWxpc3QuZGlyZWN0aXZlJztcbmltcG9ydCB7IFByZXBhcmVkTmVzdGVkTGlzdENvbXBvbmVudCB9IGZyb20gJy4uL3ByZXBhcmVkLW5lc3RlZC1saXN0L3ByZXBhcmVkLW5lc3RlZC1saXN0LmNvbXBvbmVudCc7XG5cbkBEaXJlY3RpdmUoe1xuICAgIHNlbGVjdG9yOiAnW2ZkTmVzdGVkSXRlbV0sIFtmZC1uZXN0ZWQtbGlzdC1pdGVtXSdcbn0pXG5leHBvcnQgY2xhc3MgTmVzdGVkSXRlbURpcmVjdGl2ZSBpbXBsZW1lbnRzIEFmdGVyQ29udGVudEluaXQsIE5lc3RlZEl0ZW1JbnRlcmZhY2Uge1xuXG4gICAgLyoqIEBoaWRkZW4gKi9cbiAgICBASG9zdEJpbmRpbmcoJ2NsYXNzLmZkLW5lc3RlZC1saXN0X19pdGVtJylcbiAgICBmZE5lc3RlZExpc3RJdGVtQ2xhc3M6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqIFJlZmVyZW5jZSB0byB0aGUgbGluayBkaXJlY3RpdmUsIHRvIGFsbG93IG1hbmlwdWxhdGluZyB0aGUgcHJvcGVydGllcyBvZiB0aGlzIGVsZW1lbnQuXG4gICAgICovXG4gICAgQENvbnRlbnRDaGlsZChOZXN0ZWRMaW5rRGlyZWN0aXZlLCB7IHN0YXRpYzogZmFsc2UgfSlcbiAgICBsaW5rSXRlbTogTmVzdGVkTGlua0RpcmVjdGl2ZTtcblxuICAgIC8qKiBAaGlkZGVuICovXG4gICAgQENvbnRlbnRDaGlsZChOZXN0ZWRMaXN0UG9wb3ZlckNvbXBvbmVudCwgeyBzdGF0aWM6IGZhbHNlIH0pXG4gICAgcG9wb3Zlckl0ZW06IE5lc3RlZExpc3RQb3BvdmVyQ29tcG9uZW50O1xuXG4gICAgLyoqIEBoaWRkZW4gKi9cbiAgICBAQ29udGVudENoaWxkKGZvcndhcmRSZWYoKCkgPT4gTmVzdGVkTGlzdERpcmVjdGl2ZSksIHsgc3RhdGljOiBmYWxzZSB9KVxuICAgIG5lc3RlZExpc3RJdGVtOiBOZXN0ZWRMaXN0RGlyZWN0aXZlO1xuXG4gICAgLyoqIEBoaWRkZW4gKi9cbiAgICBAQ29udGVudENoaWxkKGZvcndhcmRSZWYoKCkgPT4gUHJlcGFyZWROZXN0ZWRMaXN0Q29tcG9uZW50KSwgeyBzdGF0aWM6IGZhbHNlIH0pXG4gICAgcHJlcGFyZWRMaXN0Q29tcG9uZW50OiBQcmVwYXJlZE5lc3RlZExpc3RDb21wb25lbnQ7XG5cbiAgICAvKiogQ2hlY2sgaWYgdGhlIGl0ZW0gZWxlbWVudCBoYXMgYW55IGNoaWxkICovXG4gICAgcHVibGljIGdldCBoYXNDaGlsZHJlbigpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICEhKHRoaXMubmVzdGVkTGlzdEl0ZW0gfHwgdGhpcy5wb3BvdmVySXRlbSB8fCB0aGlzLm5lc3RlZExpc3RGcm9tUHJlcGFyZWRDb21wb25lbnQpO1xuICAgIH1cblxuICAgIC8qKiBHZXQgYWxsIG9mIHRoZSBjaGlsZHJlbiBpdGVtIGVsZW1lbnRzICovXG4gICAgcHVibGljIGdldCBhbGxDaGlsZHJlbkl0ZW1zKCk6IE5lc3RlZEl0ZW1JbnRlcmZhY2VbXSB7XG4gICAgICAgIGlmICh0aGlzLm5lc3RlZExpc3RJdGVtICYmIHRoaXMubmVzdGVkTGlzdEl0ZW0ubmVzdGVkSXRlbXMpIHtcbiAgICAgICAgICAgIC8qKiBHZXQgZWxlbWVudHMgZnJvbSBjaGlsZCBsaXN0ICovXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5uZXN0ZWRMaXN0SXRlbS5uZXN0ZWRJdGVtcy50b0FycmF5KCk7XG5cbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLm5lc3RlZExpc3RGcm9tUHJlcGFyZWRDb21wb25lbnQgJiYgdGhpcy5uZXN0ZWRMaXN0RnJvbVByZXBhcmVkQ29tcG9uZW50Lm5lc3RlZEl0ZW1zKSB7XG4gICAgICAgICAgICAvKiogR2V0IGVsZW1lbnRzIGZyb20gY2hpbGQgcHJlcGFyZWQgbGlzdCAgY29tcG9uZW50ICovXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5uZXN0ZWRMaXN0RnJvbVByZXBhcmVkQ29tcG9uZW50Lm5lc3RlZEl0ZW1zLnRvQXJyYXkoKTtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIEBoaWRkZW4gKi9cbiAgICBjb25zdHJ1Y3RvciAoXG4gICAgICAgIHByaXZhdGUgZWxlbWVudFJlZjogRWxlbWVudFJlZixcbiAgICAgICAgcHJpdmF0ZSBrZXlib2FyZFNlcnZpY2U6IE5lc3RlZExpc3RLZXlib2FyZFNlcnZpY2VcbiAgICApIHt9XG5cbiAgICAvKiogV2hldGhlciBpdGVtIHNob3VsZCBiZSBleHBhbmRlZCAqL1xuICAgIEBJbnB1dCgpIHNldCBleHBhbmRlZChleHBhbmRlZDogYm9vbGVhbikge1xuICAgICAgICB0aGlzLnByb3BhZ2F0ZU9wZW5DaGFuZ2UoZXhwYW5kZWQpO1xuICAgIH1cblxuICAgIC8qKiBAaGlkZGVuICovXG4gICAgZ2V0IGV4cGFuZGVkKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5fZXhwYW5kZWQ7XG4gICAgfVxuXG4gICAgLyoqIEBoaWRkZW4gKi9cbiAgICBwcml2YXRlIF9leHBhbmRlZDogYm9vbGVhbiA9IGZhbHNlO1xuXG4gICAgLyoqIEV2ZW50IHRocm93biwgd2hlbiBleHBhbmRlZCBzdGF0ZSBpcyBjaGFuZ2VkICovXG4gICAgQE91dHB1dCgpXG4gICAgcmVhZG9ubHkgZXhwYW5kZWRDaGFuZ2U6IEV2ZW50RW1pdHRlcjxib29sZWFuPiA9IG5ldyBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4oKTtcblxuICAgIC8qKiBFdmVudCB0aHJvd24sIHdoZW4gYW55IGtleWJvYXJkIGV2ZW50IGlzIGRpc3BhdGNoZWQgb24gdGhpcywgb3IgbGluayBlbGVtZW50ICovXG4gICAgQE91dHB1dCgpXG4gICAgcmVhZG9ubHkga2V5Ym9hcmRUcmlnZ2VyZWQ6IEV2ZW50RW1pdHRlcjxLZXlib2FyZEV2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8S2V5Ym9hcmRFdmVudD4oKTtcblxuICAgIC8qKiBAaGlkZGVuICovXG4gICAgbmdBZnRlckNvbnRlbnRJbml0KCk6IHZvaWQge1xuXG4gICAgICAgIC8qKiBQcm9wYWdhdGUgaGFzQ2hpbGRyZW4gcHJvcGVydHkgKi9cbiAgICAgICAgaWYgKHRoaXMuaGFzQ2hpbGRyZW4gJiYgdGhpcy5saW5rSXRlbSkge1xuICAgICAgICAgICAgdGhpcy5saW5rSXRlbS5oYXNDaGlsZHJlbiA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmxpbmtJdGVtLmNoYW5nZURldFJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5saW5rSXRlbSkge1xuICAgICAgICAgICAgLyoqIFN1YnNjcmliZSB0byBtb3VzZSBjbGljayBldmVudCwgdGhyb3duIGJ5IGxpbmsgaXRlbSAqL1xuICAgICAgICAgICAgdGhpcy5saW5rSXRlbS5jbGlja2VkLnN1YnNjcmliZSgoKSA9PiB0aGlzLnRvZ2dsZSgpKTtcblxuICAgICAgICAgICAgLyoqIFN1YnNjcmliZSB0byBrZXlib2FyZCBldmVudCBhbmQgdGhyb3cgaXQgZmFydGhlciAqL1xuICAgICAgICAgICAgdGhpcy5saW5rSXRlbS5rZXlib2FyZFRyaWdnZXJlZC5zdWJzY3JpYmUoa2V5Ym9hcmRFdmVudCA9PlxuICAgICAgICAgICAgICAgIHRoaXMua2V5Ym9hcmRUcmlnZ2VyZWQuZW1pdChrZXlib2FyZEV2ZW50KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKiBQYXNzIHRoaXMgZWxlbWVudCB0byBwb3BvdmVyIGNoaWxkIGl0ZW0sIHRvIGFsbG93IGNvbnRyb2wgYGV4cGFuZGVkYCB2YWx1ZSAqL1xuICAgICAgICBpZiAodGhpcy5wb3BvdmVySXRlbSkge1xuICAgICAgICAgICAgdGhpcy5wb3BvdmVySXRlbS5wYXJlbnRJdGVtRWxlbWVudCA9IHRoaXM7XG4gICAgICAgIH1cblxuICAgICAgICAvKiogUHJvcGFnYXRlIGluaXRpYWwgb3BlbiBzdGF0ZSB0byBjaGlsZHJlbiAqL1xuICAgICAgICB0aGlzLnByb3BhZ2F0ZU9wZW5DaGFuZ2UodGhpcy5fZXhwYW5kZWQpO1xuICAgIH1cblxuICAgIC8qKiBNZXRob2QgdGhhdCBleHBhbmQgdGhlIGl0ZW0gYW5kIHByb3BhZ2F0ZSBpdCB0byBjaGlsZHJlbiAqL1xuICAgIHRyaWdnZXJPcGVuKCk6IHZvaWQge1xuICAgICAgICBpZiAoIXRoaXMuZXhwYW5kZWQpIHtcbiAgICAgICAgICAgIC8qKiBQcm9wYWdhdGUgaW5pdGlhbCBvcGVuIHN0YXRlIHRvIGNoaWxkcmVuICovXG4gICAgICAgICAgICB0aGlzLnByb3BhZ2F0ZU9wZW5DaGFuZ2UodHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogTWV0aG9kIHRoYXQgY2xvc2UgdGhlIGl0ZW0gYW5kIHByb3BhZ2F0ZSBpdCB0byBjaGlsZHJlbiAqL1xuICAgIHRyaWdnZXJDbG9zZSgpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuZXhwYW5kZWQpIHtcbiAgICAgICAgICAgIC8qKiBQcm9wYWdhdGUgaW5pdGlhbCBvcGVuIHN0YXRlIHRvIGNoaWxkcmVuICovXG4gICAgICAgICAgICB0aGlzLnByb3BhZ2F0ZU9wZW5DaGFuZ2UoZmFsc2UpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIE1ldGhvZCB0aGF0IHRvZ2dsZSB0aGUgaXRlbSBhbmQgcHJvcGFnYXRlIGl0IHRvIGNoaWxkcmVuICovXG4gICAgdG9nZ2xlKCk6IHZvaWQge1xuICAgICAgICAvKiogUHJvcGFnYXRlIGluaXRpYWwgb3BlbiBzdGF0ZSB0byBjaGlsZHJlbiAqL1xuICAgICAgICB0aGlzLnByb3BhZ2F0ZU9wZW5DaGFuZ2UoIXRoaXMuX2V4cGFuZGVkKTtcbiAgICB9XG5cbiAgICAvKiogTWV0aG9kIHRoYXQgZGlzcGF0Y2hlcyBgY2xpY2tgIGV2ZW50IG9uIGxpbmsgaXRlbSovXG4gICAgY2xpY2soKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmxpbmtJdGVtKSB7XG4gICAgICAgICAgICB0aGlzLmxpbmtJdGVtLmNsaWNrKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogTWV0aG9kIHRoYXQgZm9jdXNlcyBsaW5rIGl0ZW0qL1xuICAgIGZvY3VzKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5saW5rSXRlbSkge1xuICAgICAgICAgICAgdGhpcy5saW5rSXRlbS5mb2N1cygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqIFByb3BhZ2F0ZSBvcGVuIHN0YXRlIHRvIGFsbCBvZiB0aGUgY2hpbGRyZW5cbiAgICAgKi9cbiAgICBwcml2YXRlIHByb3BhZ2F0ZU9wZW5DaGFuZ2Uob3BlbjogYm9vbGVhbik6IHZvaWQge1xuICAgICAgICB0aGlzLl9leHBhbmRlZCA9IG9wZW47XG5cbiAgICAgICAgaWYgKHRoaXMubGlua0l0ZW0pIHtcbiAgICAgICAgICAgIHRoaXMubGlua0l0ZW0uZXhwYW5kZWQgPSBvcGVuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMubmVzdGVkTGlzdEl0ZW0pIHtcbiAgICAgICAgICAgIHRoaXMubmVzdGVkTGlzdEl0ZW0uaGlkZGVuID0gIW9wZW47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5uZXN0ZWRMaXN0RnJvbVByZXBhcmVkQ29tcG9uZW50KSB7XG4gICAgICAgICAgICB0aGlzLm5lc3RlZExpc3RGcm9tUHJlcGFyZWRDb21wb25lbnQuaGlkZGVuID0gIW9wZW47XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5wb3BvdmVySXRlbSkge1xuICAgICAgICAgICAgdGhpcy5wb3BvdmVySXRlbS5vcGVuID0gb3BlbjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKiBUcmlnZ2VyIGV2ZW50IHRvIHByb3ZpZGUga2V5Ym9hcmQgc3VwcG9ydCB0byBuZXcgbGlzdCBvZiBvcGVuZWQgaXRlbSBlbGVtZW50LiAqL1xuICAgICAgICB0aGlzLmtleWJvYXJkU2VydmljZS5yZWZyZXNoJC5uZXh0KCk7XG4gICAgICAgIHRoaXMuZXhwYW5kZWRDaGFuZ2UuZW1pdChvcGVuKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgcHJpdmF0ZSBnZXQgbmVzdGVkTGlzdEZyb21QcmVwYXJlZENvbXBvbmVudCgpOiBOZXN0ZWRMaXN0RGlyZWN0aXZlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucHJlcGFyZWRMaXN0Q29tcG9uZW50ICYmIHRoaXMucHJlcGFyZWRMaXN0Q29tcG9uZW50Lm5lc3RlZExpc3REaXJlY3RpdmU7XG4gICAgfVxuXG59XG4iXX0=