{"version":3,"file":"RushCommandSelector.js","sourceRoot":"","sources":["../src/RushCommandSelector.ts"],"names":[],"mappings":";AAAA,4FAA4F;AAC5F,2DAA2D;;;;;;;;;;;;;;;;;;;;;;;;;AAE3D,uDAAiC;AACjC,2CAA6B;AAK7B;;;;;;GAMG;AACH,MAAa,mBAAmB;IACvB,MAAM,CAAC,sBAAsB,CAAC,OAAe;QAClD,IAAI,mBAAmB,CAAC,eAAe,EAAE,KAAK,OAAO,EAAE;YACrD,mBAAmB,CAAC,cAAc,CAChC,yCAAyC,OAAO,6CAA6C,CAC9F,CAAC;SACH;IACH,CAAC;IAEM,MAAM,CAAC,OAAO,CACnB,eAAuB;IACvB,8DAA8D;IAC9D,eAAoB,EACpB,OAA+B;QAE/B,MAAM,IAAI,GAAwB,eAAe,CAAC,IAAI,CAAC;QAEvD,IAAI,CAAC,IAAI,EAAE;YACT,2EAA2E;YAC3E,mBAAmB,CAAC,cAAc,CAAC,8DAA8D,CAAC,CAAC;SACpG;QAED,IAAI,mBAAmB,CAAC,eAAe,EAAE,KAAK,OAAO,EAAE;YACrD,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;gBACrB,mBAAmB,CAAC,cAAc,CAChC,yCAAyC,IAAI,CAAC,OAAO,EAAE;oBACrD,6CAA6C,CAChD,CAAC;aACH;YACD,IAAI,CAAC,WAAW,CAAC,eAAe,EAAE,OAAO,CAAC,CAAC;SAC5C;aAAM;YACL,IAAI,CAAC,MAAM,CAAC,eAAe,EAAE,OAAO,CAAC,CAAC;SACvC;IACH,CAAC;IAEO,MAAM,CAAC,cAAc,CAAC,OAAe;QAC3C,OAAO,CAAC,GAAG,CAAC,cAAM,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC;QACjC,OAAO,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;IACzB,CAAC;IAEO,MAAM,CAAC,eAAe;QAC5B,IAAI,OAAO,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,EAAE;YAC5B,WAAW;YACX,iDAAiD;YACjD,mFAAmF;YACnF,MAAM,QAAQ,GAAW,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE,CAAC;YACtE,IAAI,QAAQ,KAAK,OAAO,EAAE;gBACxB,OAAO,OAAO,CAAC;aAChB;YACD,IAAI,QAAQ,KAAK,MAAM,EAAE;gBACvB,OAAO,MAAM,CAAC;aACf;SACF;QACD,OAAO,SAAS,CAAC;IACnB,CAAC;CACF;AAvDD,kDAuDC","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\n// See LICENSE in the project root for license information.\n\nimport colors from 'colors/safe';\nimport * as path from 'path';\nimport * as rushLib from '@microsoft/rush-lib';\n\ntype CommandName = 'rush' | 'rushx' | undefined;\n\n/**\n * Both \"rush\" and \"rushx\" share the same src/start.ts entry point.  This makes it\n * a little easier for them to share all the same startup checks and version selector\n * logic.  RushCommandSelector looks at argv to determine whether we're doing \"rush\"\n * or \"rushx\" behavior, and then invokes the appropriate entry point in the selected\n * @microsoft/rush-lib.\n */\nexport class RushCommandSelector {\n  public static failIfNotInvokedAsRush(version: string): void {\n    if (RushCommandSelector._getCommandName() === 'rushx') {\n      RushCommandSelector._failWithError(\n        `This repository is using Rush version ${version} which does not support the \"rushx\" command`\n      );\n    }\n  }\n\n  public static execute(\n    launcherVersion: string,\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    selectedRushLib: any,\n    options: rushLib.ILaunchOptions\n  ): void {\n    const Rush: typeof rushLib.Rush = selectedRushLib.Rush;\n\n    if (!Rush) {\n      // This should be impossible unless we somehow loaded an unexpected version\n      RushCommandSelector._failWithError(`Unable to find the \"Rush\" entry point in @microsoft/rush-lib`);\n    }\n\n    if (RushCommandSelector._getCommandName() === 'rushx') {\n      if (!Rush.launchRushX) {\n        RushCommandSelector._failWithError(\n          `This repository is using Rush version ${Rush.version}` +\n            ` which does not support the \"rushx\" command`\n        );\n      }\n      Rush.launchRushX(launcherVersion, options);\n    } else {\n      Rush.launch(launcherVersion, options);\n    }\n  }\n\n  private static _failWithError(message: string): never {\n    console.log(colors.red(message));\n    return process.exit(1);\n  }\n\n  private static _getCommandName(): CommandName {\n    if (process.argv.length >= 2) {\n      // Example:\n      // argv[0]: \"C:\\\\Program Files\\\\nodejs\\\\node.exe\"\n      // argv[1]: \"C:\\\\Program Files\\\\nodejs\\\\node_modules\\\\@microsoft\\\\rush\\\\bin\\\\rushx\"\n      const basename: string = path.basename(process.argv[1]).toUpperCase();\n      if (basename === 'RUSHX') {\n        return 'rushx';\n      }\n      if (basename === 'RUSH') {\n        return 'rush';\n      }\n    }\n    return undefined;\n  }\n}\n"]}