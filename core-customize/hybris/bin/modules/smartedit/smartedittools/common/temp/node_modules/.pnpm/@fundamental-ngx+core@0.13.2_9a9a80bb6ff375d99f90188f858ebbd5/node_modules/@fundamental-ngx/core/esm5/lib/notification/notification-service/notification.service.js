/**
 * @fileoverview added by tsickle
 * Generated from: lib/notification/notification-service/notification.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { NotificationComponent } from '../notification/notification.component';
import { NotificationContainer } from '../notification-utils/notification-container';
import { NotificationConfig } from '../notification-utils/notification-config';
import { NotificationRef } from '../notification-utils/notification-ref';
import { DynamicComponentService } from '../../utils/dynamic-component/dynamic-component.service';
import { NotificationGroupComponent } from '../notification-group/notification-group.component';
var NotificationService = /** @class */ (function () {
    function NotificationService(dynamicComponentService) {
        this.dynamicComponentService = dynamicComponentService;
        this.notifications = [];
    }
    /**
     * Opens an alert component with a content of type TemplateRef, Component Type or Configuration Object
     * @param content Content of the alert component, or NotificationDefault object.
     * @param notificationConfig Configuration of the notification component.
     * @param notificationGroup Configuration of the notification component.
     */
    /**
     * Opens an alert component with a content of type TemplateRef, Component Type or Configuration Object
     * @param {?} content Content of the alert component, or NotificationDefault object.
     * @param {?=} notificationConfig Configuration of the notification component.
     * @param {?=} notificationGroup Configuration of the notification component.
     * @return {?}
     */
    NotificationService.prototype.open = /**
     * Opens an alert component with a content of type TemplateRef, Component Type or Configuration Object
     * @param {?} content Content of the alert component, or NotificationDefault object.
     * @param {?=} notificationConfig Configuration of the notification component.
     * @param {?=} notificationGroup Configuration of the notification component.
     * @return {?}
     */
    function (content, notificationConfig, notificationGroup) {
        var _this = this;
        if (notificationConfig === void 0) { notificationConfig = new NotificationConfig(); }
        // Reassigning Object And Service
        /** @type {?} */
        var notificationService = new NotificationRef();
        notificationConfig = Object.assign(new NotificationConfig(), notificationConfig);
        notificationService.data = notificationConfig.data;
        if (notificationService.data) {
            notificationService.data.type = notificationConfig.type;
        }
        // Create Container if it doesn't exist
        if (!this.containerRef) {
            this.containerRef = this.dynamicComponentService.createDynamicComponent(content, NotificationContainer, notificationConfig);
        }
        // Pass Container reference to config
        notificationConfig.container = this.containerRef.location.nativeElement;
        /** @type {?} */
        var notificationComponentRef;
        if (notificationGroup) {
            // If there is group Pass group reference as a container
            notificationConfig.container = notificationGroup.location.nativeElement;
            // Create Notification Component
            notificationComponentRef = this.dynamicComponentService.createDynamicComponent(content, NotificationComponent, notificationConfig, [notificationService]);
            // Add To array
            this.notifications.push({
                notificationComponent: notificationComponentRef,
                notificationGroup: notificationGroup
            });
        }
        else {
            // Create Notification Component
            notificationComponentRef = this.dynamicComponentService.createDynamicComponent(content, NotificationComponent, notificationConfig, [notificationService]);
            // Add To array
            this.notifications.push({
                notificationComponent: notificationComponentRef,
            });
        }
        /** @type {?} */
        var defaultBehaviourOnClose = (/**
         * @return {?}
         */
        function () {
            _this.destroyNotificationComponent(notificationComponentRef);
            refSub.unsubscribe();
            refGroupSub.unsubscribe();
        });
        /** @type {?} */
        var defaultBehaviourOnGroupClose = (/**
         * @return {?}
         */
        function () {
            _this.destroyWholeGroup(notificationComponentRef);
            refGroupSub.unsubscribe();
            refSub.unsubscribe();
        });
        /** @type {?} */
        var refSub = notificationService.afterClosed
            .subscribe(defaultBehaviourOnClose, defaultBehaviourOnClose);
        /** @type {?} */
        var refGroupSub = notificationService.afterClosedGroup
            .subscribe(defaultBehaviourOnGroupClose, defaultBehaviourOnGroupClose);
        return notificationService;
    };
    /** Method to remove all of notifications from this service instance */
    /**
     * Method to remove all of notifications from this service instance
     * @return {?}
     */
    NotificationService.prototype.destroyAll = /**
     * Method to remove all of notifications from this service instance
     * @return {?}
     */
    function () {
        var _this = this;
        this.notifications.forEach((/**
         * @param {?} notification
         * @return {?}
         */
        function (notification) {
            _this.destroyNotificationComponent(notification.notificationComponent);
        }));
    };
    /** Method that informs if there is any notification opened in this service instance */
    /**
     * Method that informs if there is any notification opened in this service instance
     * @return {?}
     */
    NotificationService.prototype.isAnyOpened = /**
     * Method that informs if there is any notification opened in this service instance
     * @return {?}
     */
    function () {
        return this.notifications && this.notifications.length > 0;
    };
    /** Method to create Notification Group */
    /**
     * Method to create Notification Group
     * @param {?=} notificationConfig
     * @return {?}
     */
    NotificationService.prototype.createNotificationGroup = /**
     * Method to create Notification Group
     * @param {?=} notificationConfig
     * @return {?}
     */
    function (notificationConfig) {
        if (notificationConfig === void 0) { notificationConfig = new NotificationConfig(); }
        // Reassign Config Object
        notificationConfig = Object.assign(new NotificationConfig(), notificationConfig);
        if (!this.containerRef) {
            // Create Container Component
            this.containerRef = this.dynamicComponentService.createDynamicComponent(null, NotificationContainer, notificationConfig);
        }
        // Pass Container reference as a config container
        notificationConfig.container = this.containerRef.location.nativeElement;
        // Create and return notification Group component reference
        return this.dynamicComponentService.createDynamicComponent(null, NotificationGroupComponent, notificationConfig);
    };
    /**
     * @private
     * @param {?} notification
     * @return {?}
     */
    NotificationService.prototype.destroyWholeGroup = /**
     * @private
     * @param {?} notification
     * @return {?}
     */
    function (notification) {
        var _this = this;
        // Find Notification Group assigned to this Notification Component
        /** @type {?} */
        var arrayRef = this.notifications.find((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item.notificationComponent === notification; }));
        if (arrayRef.notificationGroup) {
            // Find Any other Components, that are in this group
            /** @type {?} */
            var arrayToDelete = this.notifications
                .filter((/**
             * @param {?} _notification
             * @return {?}
             */
            function (_notification) { return _notification.notificationGroup === arrayRef.notificationGroup; }));
            // Destroy every single component, that are in the group
            arrayToDelete.forEach((/**
             * @param {?} _notification
             * @return {?}
             */
            function (_notification) { return _this.destroyNotificationComponent(_notification.notificationComponent); }));
        }
    };
    /**
     * @private
     * @param {?} notification
     * @return {?}
     */
    NotificationService.prototype.destroyNotificationComponent = /**
     * @private
     * @param {?} notification
     * @return {?}
     */
    function (notification) {
        // Find Notification component in the array.
        /** @type {?} */
        var arrayRef = this.notifications.find((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item.notificationComponent === notification; }));
        /** @type {?} */
        var indexOf = this.notifications.indexOf(arrayRef);
        // Check the amount of component within the group
        /** @type {?} */
        var amountOfComponentsWithThisGroup = this.notifications.filter((/**
         * @param {?} item
         * @return {?}
         */
        function (item) {
            return item.notificationGroup && item.notificationGroup === arrayRef.notificationGroup;
        }));
        // If it's the only one component that is in the group, remove group component.
        if (amountOfComponentsWithThisGroup.length === 1) {
            this.dynamicComponentService.destroyComponent(arrayRef.notificationGroup);
        }
        // Destroy Component
        this.dynamicComponentService.destroyComponent(arrayRef.notificationComponent);
        // Remove it from Array
        this.notifications[indexOf] = null;
        this.notifications = this.notifications.filter((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return item !== null && item !== undefined; }));
        // If there is no other notification Components, just remove container.
        if (this.notifications.length === 0) {
            this.dynamicComponentService.destroyComponent(this.containerRef);
            this.containerRef = null;
        }
    };
    NotificationService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    NotificationService.ctorParameters = function () { return [
        { type: DynamicComponentService }
    ]; };
    return NotificationService;
}());
export { NotificationService };
if (false) {
    /** @type {?} */
    NotificationService.prototype.notifications;
    /** @type {?} */
    NotificationService.prototype.containerRef;
    /**
     * @type {?}
     * @private
     */
    NotificationService.prototype.dynamicComponentService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm90aWZpY2F0aW9uLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZnVuZGFtZW50YWwtbmd4L2NvcmUvIiwic291cmNlcyI6WyJsaWIvbm90aWZpY2F0aW9uL25vdGlmaWNhdGlvbi1zZXJ2aWNlL25vdGlmaWNhdGlvbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFnQixVQUFVLEVBQXFCLE1BQU0sZUFBZSxDQUFDO0FBQzVFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHdDQUF3QyxDQUFDO0FBQy9FLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDhDQUE4QyxDQUFDO0FBQ3JGLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLDJDQUEyQyxDQUFDO0FBQy9FLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUN6RSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSx5REFBeUQsQ0FBQztBQUNsRyxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxvREFBb0QsQ0FBQztBQUdoRztJQVVJLDZCQUNZLHVCQUFnRDtRQUFoRCw0QkFBdUIsR0FBdkIsdUJBQXVCLENBQXlCO1FBUnJELGtCQUFhLEdBR2QsRUFBRSxDQUFDO0lBTU4sQ0FBQztJQUVKOzs7OztPQUtHOzs7Ozs7OztJQUNJLGtDQUFJOzs7Ozs7O0lBQVgsVUFDSSxPQUEyRCxFQUMzRCxrQkFBaUUsRUFDakUsaUJBQTREO1FBSGhFLGlCQTZFQztRQTNFRyxtQ0FBQSxFQUFBLHlCQUE2QyxrQkFBa0IsRUFBRTs7O1lBSzNELG1CQUFtQixHQUFvQixJQUFJLGVBQWUsRUFBRTtRQUNsRSxrQkFBa0IsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksa0JBQWtCLEVBQUUsRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO1FBQ2pGLG1CQUFtQixDQUFDLElBQUksR0FBRyxrQkFBa0IsQ0FBQyxJQUFJLENBQUM7UUFDbkQsSUFBSSxt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QUM7U0FDNUI7SUFFTCxDQUFDOztnQkF0TEosVUFBVTs7OztnQkFKRix1QkFBdUI7O0lBMkxoQywwQkFBQztDQUFBLEFBdkxELElBdUxDO1NBdExZLG1CQUFtQjs7O0lBRTVCLDRDQUdTOztJQUNULDJDQUF5RDs7Ozs7SUFJckQsc0RBQXdEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50UmVmLCBJbmplY3RhYmxlLCBUZW1wbGF0ZVJlZiwgVHlwZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTm90aWZpY2F0aW9uQ29tcG9uZW50IH0gZnJvbSAnLi4vbm90aWZpY2F0aW9uL25vdGlmaWNhdGlvbi5jb21wb25lbnQnO1xuaW1wb3J0IHsgTm90aWZpY2F0aW9uQ29udGFpbmVyIH0gZnJvbSAnLi4vbm90aWZpY2F0aW9uLXV0aWxzL25vdGlmaWNhdGlvbi1jb250YWluZXInO1xuaW1wb3J0IHsgTm90aWZpY2F0aW9uQ29uZmlnIH0gZnJvbSAnLi4vbm90aWZpY2F0aW9uLXV0aWxzL25vdGlmaWNhdGlvbi1jb25maWcnO1xuaW1wb3J0IHsgTm90aWZpY2F0aW9uUmVmIH0gZnJvbSAnLi4vbm90aWZpY2F0aW9uLXV0aWxzL25vdGlmaWNhdGlvbi1yZWYnO1xuaW1wb3J0IHsgRHluYW1pY0NvbXBvbmVudFNlcnZpY2UgfSBmcm9tICcuLi8uLi91dGlscy9keW5hbWljLWNvbXBvbmVudC9keW5hbWljLWNvbXBvbmVudC5zZXJ2aWNlJztcbmltcG9ydCB7IE5vdGlmaWNhdGlvbkdyb3VwQ29tcG9uZW50IH0gZnJvbSAnLi4vbm90aWZpY2F0aW9uLWdyb3VwL25vdGlmaWNhdGlvbi1ncm91cC5jb21wb25lbnQnO1xuaW1wb3J0IHsgTm90aWZpY2F0aW9uRGVmYXVsdCB9IGZyb20gJy4uL25vdGlmaWNhdGlvbi11dGlscy9ub3RpZmljYXRpb24tZGVmYXVsdCc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBOb3RpZmljYXRpb25TZXJ2aWNlIHtcblxuICAgIHB1YmxpYyBub3RpZmljYXRpb25zOiB7XG4gICAgICAgIG5vdGlmaWNhdGlvbkNvbXBvbmVudDogQ29tcG9uZW50UmVmPE5vdGlmaWNhdGlvbkNvbXBvbmVudD4sXG4gICAgICAgIG5vdGlmaWNhdGlvbkdyb3VwPzogQ29tcG9uZW50UmVmPE5vdGlmaWNhdGlvbkdyb3VwQ29tcG9uZW50PlxuICAgIH1bXSA9IFtdO1xuICAgIHB1YmxpYyBjb250YWluZXJSZWY6IENvbXBvbmVudFJlZjxOb3RpZmljYXRpb25Db250YWluZXI+O1xuXG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSBkeW5hbWljQ29tcG9uZW50U2VydmljZTogRHluYW1pY0NvbXBvbmVudFNlcnZpY2VcbiAgICApIHt9XG5cbiAgICAvKipcbiAgICAgKiBPcGVucyBhbiBhbGVydCBjb21wb25lbnQgd2l0aCBhIGNvbnRlbnQgb2YgdHlwZSBUZW1wbGF0ZVJlZiwgQ29tcG9uZW50IFR5cGUgb3IgQ29uZmlndXJhdGlvbiBPYmplY3RcbiAgICAgKiBAcGFyYW0gY29udGVudCBDb250ZW50IG9mIHRoZSBhbGVydCBjb21wb25lbnQsIG9yIE5vdGlmaWNhdGlvbkRlZmF1bHQgb2JqZWN0LlxuICAgICAqIEBwYXJhbSBub3RpZmljYXRpb25Db25maWcgQ29uZmlndXJhdGlvbiBvZiB0aGUgbm90aWZpY2F0aW9uIGNvbXBvbmVudC5cbiAgICAgKiBAcGFyYW0gbm90aWZpY2F0aW9uR3JvdXAgQ29uZmlndXJhdGlvbiBvZiB0aGUgbm90aWZpY2F0aW9uIGNvbXBvbmVudC5cbiAgICAgKi9cbiAgICBwdWJsaWMgb3BlbihcbiAgICAgICAgY29udGVudDogVGVtcGxhdGVSZWY8YW55PiB8IFR5cGU8YW55PiB8IE5vdGlmaWNhdGlvbkRlZmF1bHQsXG4gICAgICAgIG5vdGlmaWNhdGlvbkNvbmZpZzogTm90aWZpY2F0aW9uQ29uZmlnID0gbmV3IE5vdGlmaWNhdGlvbkNvbmZpZygpLFxuICAgICAgICBub3RpZmljYXRpb25Hcm91cD86IENvbXBvbmVudFJlZjxOb3RpZmljYXRpb25Hcm91cENvbXBvbmVudD5cbiAgICApOiBOb3RpZmljYXRpb25SZWYge1xuXG4gICAgICAgIC8vIFJlYXNzaWduaW5nIE9iamVjdCBBbmQgU2VydmljZVxuICAgICAgICBjb25zdCBub3RpZmljYXRpb25TZXJ2aWNlOiBOb3RpZmljYXRpb25SZWYgPSBuZXcgTm90aWZpY2F0aW9uUmVmKCk7XG4gICAgICAgIG5vdGlmaWNhdGlvbkNvbmZpZyA9IE9iamVjdC5hc3NpZ24obmV3IE5vdGlmaWNhdGlvbkNvbmZpZygpLCBub3RpZmljYXRpb25Db25maWcpO1xuICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmRhdGEgPSBub3RpZmljYXRpb25Db25maWcuZGF0YTtcbiAgICAgICAgaWYgKG5vdGlmaWNhdGlvblNlcnZpY2UuZGF0YSkge1xuICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5kYXRhLnR5cGUgPSBub3RpZmljYXRpb25Db25maWcudHlwZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENyZWF0ZSBDb250YWluZXIgaWYgaXQgZG9lc24ndCBleGlzdFxuICAgICAgICBpZiAoIXRoaXMuY29udGFpbmVyUmVmKSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lclJlZiA9IHRoaXMuZHluYW1pY0NvbXBvbmVudFNlcnZpY2UuY3JlYXRlRHluYW1pY0NvbXBvbmVudChjb250ZW50LCBOb3RpZmljYXRpb25Db250YWluZXIsIG5vdGlmaWNhdGlvbkNvbmZpZyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBQYXNzIENvbnRhaW5lciByZWZlcmVuY2UgdG8gY29uZmlnXG4gICAgICAgIG5vdGlmaWNhdGlvbkNvbmZpZy5jb250YWluZXIgPSB0aGlzLmNvbnRhaW5lclJlZi5sb2NhdGlvbi5uYXRpdmVFbGVtZW50O1xuICAgICAgICBsZXQgbm90aWZpY2F0aW9uQ29tcG9uZW50UmVmOiBDb21wb25lbnRSZWY8Tm90aWZpY2F0aW9uQ29tcG9uZW50PjtcbiAgICAgICAgaWYgKG5vdGlmaWNhdGlvbkdyb3VwKSB7XG5cbiAgICAgICAgICAgIC8vIElmIHRoZXJlIGlzIGdyb3VwIFBhc3MgZ3JvdXAgcmVmZXJlbmNlIGFzIGEgY29udGFpbmVyXG4gICAgICAgICAgICBub3RpZmljYXRpb25Db25maWcuY29udGFpbmVyID0gbm90aWZpY2F0aW9uR3JvdXAubG9jYXRpb24ubmF0aXZlRWxlbWVudDtcblxuICAgICAgICAgICAgLy8gQ3JlYXRlIE5vdGlmaWNhdGlvbiBDb21wb25lbnRcbiAgICAgICAgICAgIG5vdGlmaWNhdGlvbkNvbXBvbmVudFJlZiA9IHRoaXMuZHluYW1pY0NvbXBvbmVudFNlcnZpY2UuY3JlYXRlRHluYW1pY0NvbXBvbmVudChcbiAgICAgICAgICAgICAgICBjb250ZW50LFxuICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbkNvbXBvbmVudCxcbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25Db25maWcsXG4gICAgICAgICAgICAgICAgW25vdGlmaWNhdGlvblNlcnZpY2VdXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAvLyBBZGQgVG8gYXJyYXlcbiAgICAgICAgICAgIHRoaXMubm90aWZpY2F0aW9ucy5wdXNoKHtcbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25Db21wb25lbnQ6IG5vdGlmaWNhdGlvbkNvbXBvbmVudFJlZixcbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25Hcm91cDogbm90aWZpY2F0aW9uR3JvdXBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAvLyBDcmVhdGUgTm90aWZpY2F0aW9uIENvbXBvbmVudFxuICAgICAgICAgICAgbm90aWZpY2F0aW9uQ29tcG9uZW50UmVmID0gdGhpcy5keW5hbWljQ29tcG9uZW50U2VydmljZS5jcmVhdGVEeW5hbWljQ29tcG9uZW50KFxuICAgICAgICAgICAgICAgIGNvbnRlbnQsXG4gICAgICAgICAgICAgICAgTm90aWZpY2F0aW9uQ29tcG9uZW50LFxuICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbkNvbmZpZyxcbiAgICAgICAgICAgICAgICBbbm90aWZpY2F0aW9uU2VydmljZV1cbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIC8vIEFkZCBUbyBhcnJheVxuICAgICAgICAgICAgdGhpcy5ub3RpZmljYXRpb25zLnB1c2goe1xuICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbkNvbXBvbmVudDogbm90aWZpY2F0aW9uQ29tcG9uZW50UmVmLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBkZWZhdWx0QmVoYXZpb3VyT25DbG9zZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGVzdHJveU5vdGlmaWNhdGlvbkNvbXBvbmVudChub3RpZmljYXRpb25Db21wb25lbnRSZWYpO1xuICAgICAgICAgICAgcmVmU3ViLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICByZWZHcm91cFN1Yi51bnN1YnNjcmliZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IGRlZmF1bHRCZWhhdmlvdXJPbkdyb3VwQ2xvc2UgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRlc3Ryb3lXaG9sZUdyb3VwKG5vdGlmaWNhdGlvbkNvbXBvbmVudFJlZik7XG4gICAgICAgICAgICByZWZHcm91cFN1Yi51bnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgcmVmU3ViLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVmU3ViID0gbm90aWZpY2F0aW9uU2VydmljZS5hZnRlckNsb3NlZFxuICAgICAgICAgICAgLnN1YnNjcmliZShkZWZhdWx0QmVoYXZpb3VyT25DbG9zZSwgZGVmYXVsdEJlaGF2aW91ck9uQ2xvc2UpXG4gICAgICAgIDtcblxuICAgICAgICBjb25zdCByZWZHcm91cFN1YiA9IG5vdGlmaWNhdGlvblNlcnZpY2UuYWZ0ZXJDbG9zZWRHcm91cFxuICAgICAgICAgICAgLnN1YnNjcmliZShkZWZhdWx0QmVoYXZpb3VyT25Hcm91cENsb3NlLCBkZWZhdWx0QmVoYXZpb3VyT25Hcm91cENsb3NlKVxuICAgICAgICA7XG5cbiAgICAgICAgcmV0dXJuIG5vdGlmaWNhdGlvblNlcnZpY2U7XG4gICAgfVxuXG4gICAgLyoqIE1ldGhvZCB0byByZW1vdmUgYWxsIG9mIG5vdGlmaWNhdGlvbnMgZnJvbSB0aGlzIHNlcnZpY2UgaW5zdGFuY2UgKi9cbiAgICBwdWJsaWMgZGVzdHJveUFsbCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5ub3RpZmljYXRpb25zLmZvckVhY2gobm90aWZpY2F0aW9uID0+IHtcbiAgICAgICAgICAgIHRoaXMuZGVzdHJveU5vdGlmaWNhdGlvbkNvbXBvbmVudChub3RpZmljYXRpb24ubm90aWZpY2F0aW9uQ29tcG9uZW50KTtcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKiogTWV0aG9kIHRoYXQgaW5mb3JtcyBpZiB0aGVyZSBpcyBhbnkgbm90aWZpY2F0aW9uIG9wZW5lZCBpbiB0aGlzIHNlcnZpY2UgaW5zdGFuY2UgKi9cbiAgICBwdWJsaWMgaXNBbnlPcGVuZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLm5vdGlmaWNhdGlvbnMgJiYgdGhpcy5ub3RpZmljYXRpb25zLmxlbmd0aCA+IDA7XG4gICAgfVxuXG4gICAgLyoqIE1ldGhvZCB0byBjcmVhdGUgTm90aWZpY2F0aW9uIEdyb3VwICovXG4gICAgcHVibGljIGNyZWF0ZU5vdGlmaWNhdGlvbkdyb3VwIChcbiAgICAgICAgbm90aWZpY2F0aW9uQ29uZmlnOiBOb3RpZmljYXRpb25Db25maWcgPSBuZXcgTm90aWZpY2F0aW9uQ29uZmlnKCksXG4gICAgKTogQ29tcG9uZW50UmVmPE5vdGlmaWNhdGlvbkdyb3VwQ29tcG9uZW50PiB7XG5cbiAgICAgICAgLy8gUmVhc3NpZ24gQ29uZmlnIE9iamVjdFxuICAgICAgICBub3RpZmljYXRpb25Db25maWcgPSBPYmplY3QuYXNzaWduKG5ldyBOb3RpZmljYXRpb25Db25maWcoKSwgbm90aWZpY2F0aW9uQ29uZmlnKTtcblxuICAgICAgICBpZiAoIXRoaXMuY29udGFpbmVyUmVmKSB7XG5cbiAgICAgICAgICAgIC8vIENyZWF0ZSBDb250YWluZXIgQ29tcG9uZW50XG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lclJlZiA9IHRoaXMuZHluYW1pY0NvbXBvbmVudFNlcnZpY2UuY3JlYXRlRHluYW1pY0NvbXBvbmVudChcbiAgICAgICAgICAgICAgICBudWxsLCBOb3RpZmljYXRpb25Db250YWluZXIsIG5vdGlmaWNhdGlvbkNvbmZpZ1xuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFBhc3MgQ29udGFpbmVyIHJlZmVyZW5jZSBhcyBhIGNvbmZpZyBjb250YWluZXJcbiAgICAgICAgbm90aWZpY2F0aW9uQ29uZmlnLmNvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyUmVmLmxvY2F0aW9uLm5hdGl2ZUVsZW1lbnQ7XG5cbiAgICAgICAgLy8gQ3JlYXRlIGFuZCByZXR1cm4gbm90aWZpY2F0aW9uIEdyb3VwIGNvbXBvbmVudCByZWZlcmVuY2VcbiAgICAgICAgcmV0dXJuIHRoaXMuZHluYW1pY0NvbXBvbmVudFNlcnZpY2UuY3JlYXRlRHluYW1pY0NvbXBvbmVudFxuICAgICAgICAgICAgPE5vdGlmaWNhdGlvbkdyb3VwQ29tcG9uZW50PihudWxsLCBOb3RpZmljYXRpb25Hcm91cENvbXBvbmVudCwgbm90aWZpY2F0aW9uQ29uZmlnKVxuICAgICAgICA7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkZXN0cm95V2hvbGVHcm91cChub3RpZmljYXRpb246IENvbXBvbmVudFJlZjxOb3RpZmljYXRpb25Db21wb25lbnQ+KTogdm9pZCB7XG5cbiAgICAgICAgLy8gRmluZCBOb3RpZmljYXRpb24gR3JvdXAgYXNzaWduZWQgdG8gdGhpcyBOb3RpZmljYXRpb24gQ29tcG9uZW50XG4gICAgICAgIGNvbnN0IGFycmF5UmVmID0gdGhpcy5ub3RpZmljYXRpb25zLmZpbmQoaXRlbSA9PiBpdGVtLm5vdGlmaWNhdGlvbkNvbXBvbmVudCA9PT0gbm90aWZpY2F0aW9uKTtcbiAgICAgICAgaWYgKGFycmF5UmVmLm5vdGlmaWNhdGlvbkdyb3VwKSB7XG5cbiAgICAgICAgICAgIC8vIEZpbmQgQW55IG90aGVyIENvbXBvbmVudHMsIHRoYXQgYXJlIGluIHRoaXMgZ3JvdXBcbiAgICAgICAgICAgIGNvbnN0IGFycmF5VG9EZWxldGUgPSB0aGlzLm5vdGlmaWNhdGlvbnNcbiAgICAgICAgICAgICAgICAuZmlsdGVyKF9ub3RpZmljYXRpb24gPT4gX25vdGlmaWNhdGlvbi5ub3RpZmljYXRpb25Hcm91cCA9PT0gYXJyYXlSZWYubm90aWZpY2F0aW9uR3JvdXApXG4gICAgICAgICAgICA7XG5cbiAgICAgICAgICAgIC8vIERlc3Ryb3kgZXZlcnkgc2luZ2xlIGNvbXBvbmVudCwgdGhhdCBhcmUgaW4gdGhlIGdyb3VwXG4gICAgICAgICAgICBhcnJheVRvRGVsZXRlLmZvckVhY2goX25vdGlmaWNhdGlvbiA9PiB0aGlzLmRlc3Ryb3lOb3RpZmljYXRpb25Db21wb25lbnQoX25vdGlmaWNhdGlvbi5ub3RpZmljYXRpb25Db21wb25lbnQpKTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBkZXN0cm95Tm90aWZpY2F0aW9uQ29tcG9uZW50KG5vdGlmaWNhdGlvbjogQ29tcG9uZW50UmVmPE5vdGlmaWNhdGlvbkNvbXBvbmVudD4pOiB2b2lkIHtcblxuICAgICAgICAvLyBGaW5kIE5vdGlmaWNhdGlvbiBjb21wb25lbnQgaW4gdGhlIGFycmF5LlxuICAgICAgICBjb25zdCBhcnJheVJlZiA9IHRoaXMubm90aWZpY2F0aW9ucy5maW5kKGl0ZW0gPT4gaXRlbS5ub3RpZmljYXRpb25Db21wb25lbnQgPT09IG5vdGlmaWNhdGlvbik7XG4gICAgICAgIGNvbnN0IGluZGV4T2YgPSB0aGlzLm5vdGlmaWNhdGlvbnMuaW5kZXhPZihhcnJheVJlZik7XG5cbiAgICAgICAgLy8gQ2hlY2sgdGhlIGFtb3VudCBvZiBjb21wb25lbnQgd2l0aGluIHRoZSBncm91cFxuICAgICAgICBjb25zdCBhbW91bnRPZkNvbXBvbmVudHNXaXRoVGhpc0dyb3VwID0gdGhpcy5ub3RpZmljYXRpb25zLmZpbHRlcihpdGVtID0+XG4gICAgICAgICAgICBpdGVtLm5vdGlmaWNhdGlvbkdyb3VwICYmIGl0ZW0ubm90aWZpY2F0aW9uR3JvdXAgPT09IGFycmF5UmVmLm5vdGlmaWNhdGlvbkdyb3VwXG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gSWYgaXQncyB0aGUgb25seSBvbmUgY29tcG9uZW50IHRoYXQgaXMgaW4gdGhlIGdyb3VwLCByZW1vdmUgZ3JvdXAgY29tcG9uZW50LlxuICAgICAgICBpZiAoYW1vdW50T2ZDb21wb25lbnRzV2l0aFRoaXNHcm91cC5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgIHRoaXMuZHluYW1pY0NvbXBvbmVudFNlcnZpY2UuZGVzdHJveUNvbXBvbmVudChhcnJheVJlZi5ub3RpZmljYXRpb25Hcm91cCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBEZXN0cm95IENvbXBvbmVudFxuICAgICAgICB0aGlzLmR5bmFtaWNDb21wb25lbnRTZXJ2aWNlLmRlc3Ryb3lDb21wb25lbnQoYXJyYXlSZWYubm90aWZpY2F0aW9uQ29tcG9uZW50KTtcblxuICAgICAgICAvLyBSZW1vdmUgaXQgZnJvbSBBcnJheVxuICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbnNbaW5kZXhPZl0gPSBudWxsO1xuICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbnMgPSB0aGlzLm5vdGlmaWNhdGlvbnMuZmlsdGVyKGl0ZW0gPT4gaXRlbSAhPT0gbnVsbCAmJiBpdGVtICE9PSB1bmRlZmluZWQpO1xuXG4gICAgICAgIC8vIElmIHRoZXJlIGlzIG5vIG90aGVyIG5vdGlmaWNhdGlvbiBDb21wb25lbnRzLCBqdXN0IHJlbW92ZSBjb250YWluZXIuXG4gICAgICAgIGlmICh0aGlzLm5vdGlmaWNhdGlvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmR5bmFtaWNDb21wb25lbnRTZXJ2aWNlLmRlc3Ryb3lDb21wb25lbnQodGhpcy5jb250YWluZXJSZWYpO1xuICAgICAgICAgICAgdGhpcy5jb250YWluZXJSZWYgPSBudWxsO1xuICAgICAgICB9XG5cbiAgICB9XG59XG4iXX0=