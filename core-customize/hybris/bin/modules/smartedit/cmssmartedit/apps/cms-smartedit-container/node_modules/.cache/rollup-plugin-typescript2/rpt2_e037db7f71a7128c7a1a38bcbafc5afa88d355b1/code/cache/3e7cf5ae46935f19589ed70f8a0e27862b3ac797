{"code":"import { __awaiter, __decorate, __metadata } from \"tslib\";\r\nimport { ChangeDetectionStrategy, ChangeDetectorRef, Component, Input } from '@angular/core';\r\nimport { DEFAULT_SYNCHRONIZATION_POLLING as SYNCHRONIZATION_POLLING } from 'cmscommons';\r\nimport { CrossFrameEventService, EVENTS, SeDowngradeComponent, SystemEventService, IPageService } from 'smarteditcommons';\r\nimport { WORKFLOW_REFRESH_EVENT } from '../../constants';\r\nwindow.__smartedit__.addDecoratorPayload(\"Component\", \"PageDisplayStatusComponent\", {\r\n    selector: 'se-page-display-status',\r\n    template: `<ng-container *ngIf=\"showLastSyncTime; else pageStatus\"><se-tooltip [triggers]=\"['click']\" [placement]=\"'left'\" [isChevronVisible]=\"true\"><ng-container se-tooltip-trigger *ngTemplateOutlet=\"pageStatus\"></ng-container><div se-tooltip-body class=\"popover-tooltip\"><ng-container *ngIf=\"hasBeenSynchedBefore(); else notPublished\"><span [translate]=\"'se.cms.page.displaystatus.lastpublished.date'\"></span> <span>&ngsp;{{ lastSynchedDate | date: 'M/d/yy h:mm a' }}</span></ng-container><ng-template #notPublished><span [translate]=\"'se.cms.page.displaystatus.not.published'\"></span></ng-template></div></se-tooltip></ng-container><ng-template #pageStatus><se-page-status [uuid]=\"page?.uuid\" [displayStatus]=\"page?.displayStatus\"></se-page-status></ng-template>`,\r\n    changeDetection: ChangeDetectionStrategy.OnPush\r\n});\r\nlet /* @ngInject */ PageDisplayStatusComponent = class /* @ngInject */ PageDisplayStatusComponent {\r\n    constructor(pageService, crossFrameEventService, systemEventService, cdr) {\r\n        this.pageService = pageService;\r\n        this.crossFrameEventService = crossFrameEventService;\r\n        this.systemEventService = systemEventService;\r\n        this.cdr = cdr;\r\n        this.showLastSyncTime = true;\r\n    }\r\n    ngOnInit() {\r\n        var _a;\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            this.unRegPageSyncEvent = this.crossFrameEventService.subscribe(SYNCHRONIZATION_POLLING.FAST_FETCH, (_eventId, eventData) => this.updateLastSynchedDate(eventData));\r\n            this.unRegPageUpdatedEvent = this.crossFrameEventService.subscribe(EVENTS.PAGE_UPDATED, (_eventId, eventData) => this.updatePageInfo((eventData === null || eventData === void 0 ? void 0 : eventData.uuid) || null));\r\n            const pageUuid = ((_a = this.cmsPage) === null || _a === void 0 ? void 0 : _a.uuid) || null;\r\n            yield this.initPageInfo(pageUuid);\r\n        });\r\n    }\r\n    ngOnDestroy() {\r\n        this.unRegPageSyncEvent();\r\n        this.unRegPageUpdatedEvent();\r\n    }\r\n    hasBeenSynchedBefore() {\r\n        return this.lastSynchedDate !== undefined;\r\n    }\r\n    initPageInfo(pageUuid) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            this.page = yield (pageUuid ? this.cmsPage : this.pageService.getCurrentPageInfo());\r\n            if (!this.cdr.destroyed) {\r\n                this.cdr.detectChanges();\r\n            }\r\n        });\r\n    }\r\n    updateLastSynchedDate(syncStatus) {\r\n        if (this.canUpdateLastSynchedDate(syncStatus.itemId)) {\r\n            this.lastSynchedDate = syncStatus.lastSyncStatus;\r\n            if (!this.cdr.destroyed) {\r\n                this.cdr.detectChanges();\r\n            }\r\n        }\r\n    }\r\n    updatePageInfo(updatedPageUuid) {\r\n        var _a;\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this.canUpdatePageInfo(updatedPageUuid)) {\r\n                return;\r\n            }\r\n            const displayStatusPrevious = (_a = this.page) === null || _a === void 0 ? void 0 : _a.displayStatus;\r\n            this.page = yield this.pageService.getCurrentPageInfo();\r\n            if (!!displayStatusPrevious && this.page.displayStatus === 'DRAFT') {\r\n                this.systemEventService.publish(WORKFLOW_REFRESH_EVENT);\r\n            }\r\n            if (!this.cdr.destroyed) {\r\n                this.cdr.detectChanges();\r\n            }\r\n        });\r\n    }\r\n    canUpdateLastSynchedDate(syncStatusItemId) {\r\n        return this.page && this.page.uuid === syncStatusItemId;\r\n    }\r\n    canUpdatePageInfo(cmsPageUuidToUpdate) {\r\n        return !cmsPageUuidToUpdate || (this.page && this.page.uuid === cmsPageUuidToUpdate);\r\n    }\r\n};\r\n__decorate([\r\n    Input(),\r\n    __metadata(\"design:type\", Object)\r\n], /* @ngInject */ PageDisplayStatusComponent.prototype, \"cmsPage\", void 0);\r\n__decorate([\r\n    Input(),\r\n    __metadata(\"design:type\", Object)\r\n], /* @ngInject */ PageDisplayStatusComponent.prototype, \"showLastSyncTime\", void 0);\r\n/* @ngInject */ PageDisplayStatusComponent = __decorate([\r\n    SeDowngradeComponent(),\r\n    Component({\r\n        selector: 'se-page-display-status',\r\n        template: `<ng-container *ngIf=\"showLastSyncTime; else pageStatus\"><se-tooltip [triggers]=\"['click']\" [placement]=\"'left'\" [isChevronVisible]=\"true\"><ng-container se-tooltip-trigger *ngTemplateOutlet=\"pageStatus\"></ng-container><div se-tooltip-body class=\"popover-tooltip\"><ng-container *ngIf=\"hasBeenSynchedBefore(); else notPublished\"><span [translate]=\"'se.cms.page.displaystatus.lastpublished.date'\"></span> <span>&ngsp;{{ lastSynchedDate | date: 'M/d/yy h:mm a' }}</span></ng-container><ng-template #notPublished><span [translate]=\"'se.cms.page.displaystatus.not.published'\"></span></ng-template></div></se-tooltip></ng-container><ng-template #pageStatus><se-page-status [uuid]=\"page?.uuid\" [displayStatus]=\"page?.displayStatus\"></se-page-status></ng-template>`,\r\n        changeDetection: ChangeDetectionStrategy.OnPush\r\n    }),\r\n    __metadata(\"design:paramtypes\", [IPageService,\r\n        CrossFrameEventService,\r\n        SystemEventService,\r\n        ChangeDetectorRef])\r\n], /* @ngInject */ PageDisplayStatusComponent);\r\nexport { /* @ngInject */ PageDisplayStatusComponent };\r\n//# sourceMappingURL=PageDisplayStatusComponent.js.map","references":["/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular+core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-commons/dist/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/components/workflow/constants.ts"],"map":"{\"version\":3,\"file\":\"PageDisplayStatusComponent.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../../src/components/workflow/components/pageDisplayStatus/PageDisplayStatusComponent.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/node_modules/.cache/rollup-plugin-typescript2/placeholder/components/workflow/components/pageDisplayStatus/PageDisplayStatusComponent.d.ts","writeByteOrderMark":false,"text":"import { ChangeDetectorRef, OnDestroy, OnInit } from '@angular/core';\r\nimport { CrossFrameEventService, SystemEventService, IPageService, ICMSPage } from 'smarteditcommons';\r\nexport declare class PageDisplayStatusComponent implements OnInit, OnDestroy {\r\n    private pageService;\r\n    private crossFrameEventService;\r\n    private systemEventService;\r\n    private cdr;\r\n    cmsPage?: ICMSPage;\r\n    showLastSyncTime: boolean;\r\n    page: ICMSPage;\r\n    lastSynchedDate: number;\r\n    private unRegPageSyncEvent;\r\n    private unRegPageUpdatedEvent;\r\n    constructor(pageService: IPageService, crossFrameEventService: CrossFrameEventService, systemEventService: SystemEventService, cdr: ChangeDetectorRef);\r\n    ngOnInit(): Promise<void>;\r\n    ngOnDestroy(): void;\r\n    hasBeenSynchedBefore(): boolean;\r\n    private initPageInfo;\r\n    private updateLastSynchedDate;\r\n    private updatePageInfo;\r\n    private canUpdateLastSynchedDate;\r\n    private canUpdatePageInfo;\r\n}\r\n"}}
