{"code":"import { __awaiter, __decorate, __metadata } from \"tslib\";\r\n/*\r\n * Copyright (c) 2022 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { IEditorEnablerService, IComponentMenuConditionAndCallbackService, SharedComponentButtonComponent, ExternalComponentButtonComponent } from 'cmscommons';\r\nimport { SeDowngradeService, IPermissionService } from 'smarteditcommons';\r\nlet /* @ngInject */ PageTreeComponentMenuService = class /* @ngInject */ PageTreeComponentMenuService {\r\n    constructor(editorEnablerService, componentMenuConditionAndCallbackService, permissionService) {\r\n        this.editorEnablerService = editorEnablerService;\r\n        this.componentMenuConditionAndCallbackService = componentMenuConditionAndCallbackService;\r\n        this.permissionService = permissionService;\r\n        // Menus are displayed from left to right in the order in array\r\n        this.originalMenus = [\r\n            {\r\n                key: 'externalcomponentbutton',\r\n                i18nKey: 'se.cms.contextmenu.title.externalcomponent',\r\n                displayIconClass: 'sap-icon--globe',\r\n                permissions: [],\r\n                condition: (configuration) => __awaiter(this, void 0, void 0, function* () {\r\n                    if (configuration.isComponentHidden) {\r\n                        return Promise.resolve(false);\r\n                    }\r\n                    else {\r\n                        return this.componentMenuConditionAndCallbackService.externalCondition(configuration);\r\n                    }\r\n                }),\r\n                action: {\r\n                    component: ExternalComponentButtonComponent\r\n                }\r\n            },\r\n            {\r\n                key: 'se.cms.sharedcomponentbutton',\r\n                i18nKey: 'se.cms.contextmenu.title.shared.component',\r\n                displayIconClass: 'sap-icon--chain-link',\r\n                permissions: [],\r\n                condition: (configuration) => __awaiter(this, void 0, void 0, function* () {\r\n                    if (configuration.isComponentHidden) {\r\n                        return Promise.resolve(false);\r\n                    }\r\n                    else {\r\n                        return this.componentMenuConditionAndCallbackService.sharedCondition(configuration);\r\n                    }\r\n                }),\r\n                action: {\r\n                    component: SharedComponentButtonComponent\r\n                }\r\n            },\r\n            {\r\n                key: 'se.cms.edit',\r\n                i18nKey: 'se.cms.contextmenu.title.edit',\r\n                displayIconClass: 'sap-icon--edit',\r\n                permissions: ['se.context.menu.edit.component'],\r\n                action: {\r\n                    callback: this.editorEnablerService.onClickEditButton\r\n                },\r\n                condition: (configuration) => __awaiter(this, void 0, void 0, function* () {\r\n                    if (configuration.isComponentHidden) {\r\n                        return this.componentMenuConditionAndCallbackService.editConditionForHiddenComponent(configuration);\r\n                    }\r\n                    else {\r\n                        return this.editorEnablerService.isSlotEditableForNonExternalComponent(configuration);\r\n                    }\r\n                })\r\n            },\r\n            {\r\n                key: 'se.cms.remove',\r\n                i18nKey: 'se.cms.contextmenu.title.remove',\r\n                displayIconClass: 'sap-icon--decline',\r\n                permissions: ['se.context.menu.remove.component'],\r\n                action: {\r\n                    callback: this.componentMenuConditionAndCallbackService.removeCallback\r\n                },\r\n                condition: this.componentMenuConditionAndCallbackService.removeCondition\r\n            },\r\n            {\r\n                key: 'clonecomponentbutton',\r\n                i18nKey: 'se.cms.contextmenu.title.clone.component',\r\n                displayIconClass: 'sap-icon--duplicate',\r\n                permissions: ['se.clone.component'],\r\n                action: {\r\n                    callback: this.componentMenuConditionAndCallbackService.cloneCallback\r\n                },\r\n                condition: this.componentMenuConditionAndCallbackService.cloneCondition\r\n            }\r\n        ];\r\n    }\r\n    getPageTreeComponentMenus(configuration) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const menus = yield this.buildMenusByPermission();\r\n            const promises = menus.map((item) => __awaiter(this, void 0, void 0, function* () {\r\n                if (!item.condition) {\r\n                    return item;\r\n                }\r\n                const isItemEnabled = yield item.condition(configuration);\r\n                return isItemEnabled ? item : null;\r\n            }));\r\n            return Promise.all(promises);\r\n        });\r\n    }\r\n    buildMenusByPermission() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const menus = yield Promise.all(this.originalMenus.map((item) => __awaiter(this, void 0, void 0, function* () {\r\n                if (!item.permissions || item.permissions.length === 0) {\r\n                    return item;\r\n                }\r\n                const allowed = yield this.permissionService.isPermitted([\r\n                    {\r\n                        names: item.permissions\r\n                    }\r\n                ]);\r\n                if (allowed) {\r\n                    return item;\r\n                }\r\n                return null;\r\n            })));\r\n            return menus.filter((menu) => !!menu);\r\n        });\r\n    }\r\n};\r\n/* @ngInject */ PageTreeComponentMenuService = __decorate([\r\n    SeDowngradeService(),\r\n    __metadata(\"design:paramtypes\", [IEditorEnablerService,\r\n        IComponentMenuConditionAndCallbackService,\r\n        IPermissionService])\r\n], /* @ngInject */ PageTreeComponentMenuService);\r\nexport { /* @ngInject */ PageTreeComponentMenuService };\r\n//# sourceMappingURL=PageTreeComponentMenuService.js.map","references":["/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-commons/dist/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts"],"map":"{\"version\":3,\"file\":\"PageTreeComponentMenuService.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/services/pageTree/PageTreeComponentMenuService.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/node_modules/.cache/rollup-plugin-typescript2/placeholder/services/pageTree/PageTreeComponentMenuService.d.ts","writeByteOrderMark":false,"text":"import { IEditorEnablerService, IComponentMenuConditionAndCallbackService } from 'cmscommons';\r\nimport { IContextualMenuButton, IContextualMenuConfiguration, IPermissionService } from 'smarteditcommons';\r\nexport declare class PageTreeComponentMenuService {\r\n    private readonly editorEnablerService;\r\n    private readonly componentMenuConditionAndCallbackService;\r\n    private readonly permissionService;\r\n    private readonly originalMenus;\r\n    constructor(editorEnablerService: IEditorEnablerService, componentMenuConditionAndCallbackService: IComponentMenuConditionAndCallbackService, permissionService: IPermissionService);\r\n    getPageTreeComponentMenus(configuration: IContextualMenuConfiguration): Promise<IContextualMenuButton[]>;\r\n    private buildMenusByPermission;\r\n}\r\n"}}
