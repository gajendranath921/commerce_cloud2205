{"code":"import { __awaiter, __decorate, __metadata } from \"tslib\";\r\n/*\r\n * Copyright (c) 2022 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { EVENT_CONTENT_CATALOG_UPDATE, IAlertService, IConfirmationModalService, IExperienceService, IPageInfoService, LogService, SeDowngradeService, SystemEventService, PageVersioningService, PageVersionSelectionService } from 'smarteditcommons';\r\n/**\r\n * This service is used to rollback a page version from the toolbar context.\r\n */\r\nlet /* @ngInject */ RollbackPageVersionService = class /* @ngInject */ RollbackPageVersionService {\r\n    constructor(logService, alertService, confirmationModalService, experienceService, pageInfoService, pageVersioningService, pageVersionSelectionService, systemEventService) {\r\n        this.logService = logService;\r\n        this.alertService = alertService;\r\n        this.confirmationModalService = confirmationModalService;\r\n        this.experienceService = experienceService;\r\n        this.pageInfoService = pageInfoService;\r\n        this.pageVersioningService = pageVersioningService;\r\n        this.pageVersionSelectionService = pageVersionSelectionService;\r\n        this.systemEventService = systemEventService;\r\n    }\r\n    rollbackPageVersion(version) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const pageVersion = version || this.pageVersionSelectionService.getSelectedPageVersion();\r\n            if (!!pageVersion) {\r\n                const TRANSLATE_NS = 'se.cms.actionitem.page.version.rollback.confirmation';\r\n                const pageUuid = yield this.pageInfoService.getPageUUID();\r\n                yield this.showConfirmationModal(pageVersion.label, TRANSLATE_NS);\r\n                yield this.performRollback(pageUuid, pageVersion);\r\n            }\r\n        });\r\n    }\r\n    // Warning! This method is patched in personalization module, be careful when modifying it.\r\n    showConfirmationModal(versionLabel, translateNs) {\r\n        return this.confirmationModalService.confirm({\r\n            title: `${translateNs}.title`,\r\n            description: `${translateNs}.description`,\r\n            descriptionPlaceholders: {\r\n                versionLabel\r\n            }\r\n        });\r\n    }\r\n    performRollback(pageUuid, pageVersion) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            try {\r\n                yield this.pageVersioningService.rollbackPageVersion(pageUuid, pageVersion.uid);\r\n                // invalidate the content catalog cache: a rollback of a page could replace the existing homepage.\r\n                this.systemEventService.publishAsync(EVENT_CONTENT_CATALOG_UPDATE);\r\n                this.alertService.showSuccess('se.cms.versions.rollback.alert.success');\r\n                // reload experience\r\n                yield this.experienceService.updateExperience({});\r\n                this.pageVersionSelectionService.deselectPageVersion(false);\r\n            }\r\n            catch (_a) {\r\n                this.logService.error('RollbackPageVersionService::performRollback - unable to perform page rollback');\r\n            }\r\n        });\r\n    }\r\n};\r\n/* @ngInject */ RollbackPageVersionService = __decorate([\r\n    SeDowngradeService(),\r\n    __metadata(\"design:paramtypes\", [LogService,\r\n        IAlertService,\r\n        IConfirmationModalService,\r\n        IExperienceService,\r\n        IPageInfoService,\r\n        PageVersioningService,\r\n        PageVersionSelectionService,\r\n        SystemEventService])\r\n], /* @ngInject */ RollbackPageVersionService);\r\nexport { /* @ngInject */ RollbackPageVersionService };\r\n//# sourceMappingURL=RollbackPageVersionService.js.map","references":["/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts"],"map":"{\"version\":3,\"file\":\"RollbackPageVersionService.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/components/versioning/services/RollbackPageVersionService.ts\"],\"names\":[],\"mappings\":\";AAAA;;GAEG;AACH,OAAO,EAEH,4BAA4B,EAC5B,aAAa,EACb,yBAAyB,EACzB,kBAAkB,EAClB,gBAAgB,EAChB,UAAU,EACV,kBAAkB,EAClB,kBAAkB,EAClB,qBAAqB,EAErB,2BAA2B,EAC9B,MAAM,kBAAkB,CAAC;AAE1B;;GAEG;AAEH,iDAAA;IACI,YACY,UAAsB,EACtB,YAA2B,EAC3B,wBAAmD,EACnD,iBAAqC,EACrC,eAAiC,EACjC,qBAA4C,EAC5C,2BAAwD,EACxD,kBAAsC;QAPtC,eAAU,GAAV,UAAU,CAAY;QACtB,iBAAY,GAAZ,YAAY,CAAe;QAC3B,6BAAwB,GAAxB,wBAAwB,CAA2B;QACnD,sBAAiB,GAAjB,iBAAiB,CAAoB;QACrC,oBAAe,GAAf,eAAe,CAAkB;QACjC,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,gCAA2B,GAA3B,2BAA2B,CAA6B;QACxD,uBAAkB,GAAlB,kBAAkB,CAAoB;IAC/C,CAAC;IAES,mBAAmB,CAAC,OAAsB;;YACnD,MAAM,WAAW,GAAG,OAAO,IAAI,IAAI,CAAC,2BAA2B,CAAC,sBAAsB,EAAE,CAAC;YACzF,IAAI,CAAC,CAAC,WAAW,EAAE;gBACf,MAAM,YAAY,GAAG,sDAAsD,CAAC;gBAC5E,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,WAAW,EAAE,CAAC;gBAC1D,MAAM,IAAI,CAAC,qBAAqB,CAAC,WAAW,CAAC,KAAK,EAAE,YAAY,CAAC,CAAC;gBAClE,MAAM,IAAI,CAAC,eAAe,CAAC,QAAQ,EAAE,WAAW,CAAC,CAAC;aACrD;QACL,CAAC;KAAA;IAED,2FAA2F;IACnF,qBAAqB,CAAC,YAAoB,EAAE,WAAmB;QACnE,OAAO,IAAI,CAAC,wBAAwB,CAAC,OAAO,CAAC;YACzC,KAAK,EAAE,GAAG,WAAW,QAAQ;YAC7B,WAAW,EAAE,GAAG,WAAW,cAAc;YACzC,uBAAuB,EAAE;gBACrB,YAAY;aACf;SACuB,CAAC,CAAC;IAClC,CAAC;IAEa,eAAe,CAAC,QAAgB,EAAE,WAAyB;;YACrE,IAAI;gBACA,MAAM,IAAI,CAAC,qBAAqB,CAAC,mBAAmB,CAAC,QAAQ,EAAE,WAAW,CAAC,GAAG,CAAC,CAAC;gBAEhF,kGAAkG;gBAClG,IAAI,CAAC,kBAAkB,CAAC,YAAY,CAAC,4BAA4B,CAAC,CAAC;gBACnE,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,wCAAwC,CAAC,CAAC;gBACxE,oBAAoB;gBACpB,MAAM,IAAI,CAAC,iBAAiB,CAAC,gBAAgB,CAAC,EAAE,CAAC,CAAC;gBAClD,IAAI,CAAC,2BAA2B,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAAC;aAC/D;YAAC,WAAM;gBACJ,IAAI,CAAC,UAAU,CAAC,KAAK,CACjB,+EAA+E,CAClF,CAAC;aACL;QACL,CAAC;KAAA;CACJ,CAAA;AAjDD;IADC,kBAAkB,EAAE;qCAGO,UAAU;QACR,aAAa;QACD,yBAAyB;QAChC,kBAAkB;QACpB,gBAAgB;QACV,qBAAqB;QACf,2BAA2B;QACpC,kBAAkB;8CAwCrD\"}","dts":{"name":"/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/node_modules/.cache/rollup-plugin-typescript2/placeholder/components/versioning/services/RollbackPageVersionService.d.ts","writeByteOrderMark":false,"text":"import { IAlertService, IConfirmationModalService, IExperienceService, IPageInfoService, LogService, SystemEventService, PageVersioningService, IPageVersion, PageVersionSelectionService } from 'smarteditcommons';\r\n/**\r\n * This service is used to rollback a page version from the toolbar context.\r\n */\r\nexport declare class RollbackPageVersionService {\r\n    private logService;\r\n    private alertService;\r\n    private confirmationModalService;\r\n    private experienceService;\r\n    private pageInfoService;\r\n    private pageVersioningService;\r\n    private pageVersionSelectionService;\r\n    private systemEventService;\r\n    constructor(logService: LogService, alertService: IAlertService, confirmationModalService: IConfirmationModalService, experienceService: IExperienceService, pageInfoService: IPageInfoService, pageVersioningService: PageVersioningService, pageVersionSelectionService: PageVersionSelectionService, systemEventService: SystemEventService);\r\n    rollbackPageVersion(version?: IPageVersion): Promise<void>;\r\n    private showConfirmationModal;\r\n    private performRollback;\r\n}\r\n"}}
