{"code":"import { __awaiter, __decorate, __metadata } from \"tslib\";\r\n/*\r\n * Copyright (c) 2022 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { PagesFallbacksRestService } from 'cmssmarteditcontainer/dao/PagesFallbacksRestService';\r\nimport { PagesRestService } from 'cmssmarteditcontainer/dao/PagesRestService';\r\nimport { PagesVariationsRestService } from 'cmssmarteditcontainer/dao/PagesVariationsRestService';\r\nimport { assign, isEmpty, isNumber } from 'lodash';\r\nimport { pageChangeEvictionTag, pageEvictionTag, rarelyChangingContent, Cached, GatewayProxied, IExperienceService, IPageInfoService, IUrlService, SeDowngradeService, objectUtils, CmsitemsRestService, IPageService, CmsApprovalStatus } from 'smarteditcommons';\r\nlet /* @ngInject */ PageService = class /* @ngInject */ PageService extends IPageService {\r\n    constructor(pagesRestService, pagesFallbacksRestService, pagesVariationsRestService, pageInfoService, cmsitemsRestService, experienceService, urlService) {\r\n        super();\r\n        this.pagesRestService = pagesRestService;\r\n        this.pagesFallbacksRestService = pagesFallbacksRestService;\r\n        this.pagesVariationsRestService = pagesVariationsRestService;\r\n        this.pageInfoService = pageInfoService;\r\n        this.cmsitemsRestService = cmsitemsRestService;\r\n        this.experienceService = experienceService;\r\n        this.urlService = urlService;\r\n    }\r\n    getPageByUuid(pageUuid) {\r\n        return this.cmsitemsRestService.getById(pageUuid);\r\n    }\r\n    getCurrentPageInfo() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const pageUUID = yield this.pageInfoService.getPageUUID();\r\n            return this.cmsitemsRestService.getById(pageUUID);\r\n        });\r\n    }\r\n    getPageById(pageUid) {\r\n        return this.pagesRestService.getById(pageUid);\r\n    }\r\n    getCurrentPageInfoByVersion(versionId) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const pageUUID = yield this.pageInfoService.getPageUUID();\r\n            return this.cmsitemsRestService.getByIdAndVersion(pageUUID, versionId);\r\n        });\r\n    }\r\n    primaryPageForPageTypeExists(pageTypeCode, uriParams) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const page = yield this.getPaginatedPrimaryPagesForPageType(pageTypeCode, uriParams, {\r\n                search: null,\r\n                pageSize: 1,\r\n                currentPage: 0\r\n            });\r\n            return page.response.length > 0;\r\n        });\r\n    }\r\n    getPaginatedPrimaryPagesForPageType(pageTypeCode, uriParams, fetchPageParams) {\r\n        const itemSearchParams = 'defaultPage:true,pageStatus:ACTIVE';\r\n        const extendedParams = assign({}, uriParams || {}, fetchPageParams || {}, {\r\n            typeCode: pageTypeCode,\r\n            itemSearchParams\r\n        });\r\n        if (extendedParams.search) {\r\n            extendedParams.mask = extendedParams.search;\r\n            delete extendedParams.search;\r\n        }\r\n        if (!isNumber(extendedParams.pageSize)) {\r\n            extendedParams.pageSize = 10;\r\n        }\r\n        if (!isNumber(extendedParams.currentPage)) {\r\n            extendedParams.currentPage = 0;\r\n        }\r\n        return this.cmsitemsRestService.get(extendedParams);\r\n    }\r\n    isPagePrimary(pageUid) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const fallbacks = yield this.pagesFallbacksRestService.getFallbacksForPageId(pageUid);\r\n            return fallbacks.length === 0;\r\n        });\r\n    }\r\n    isPagePrimaryWithContext(pageUid, uriContext) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const fallbacks = yield this.pagesFallbacksRestService.getFallbacksForPageIdAndContext(pageUid, uriContext);\r\n            return fallbacks.length === 0;\r\n        });\r\n    }\r\n    getPrimaryPage(variationPageId) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const fallbacks = yield this.pagesFallbacksRestService.getFallbacksForPageId(variationPageId);\r\n            return fallbacks[0]\r\n                ? this.pagesRestService.getById(fallbacks[0])\r\n                : Promise.resolve(null);\r\n        });\r\n    }\r\n    getVariationPages(primaryPageId) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const variationPageIds = yield this.pagesVariationsRestService.getVariationsForPrimaryPageId(primaryPageId);\r\n            return variationPageIds.length > 0\r\n                ? this.pagesRestService.get(variationPageIds)\r\n                : Promise.resolve([]);\r\n        });\r\n    }\r\n    updatePageById(pageUid, payload) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const originalPage = yield this.pagesRestService.getById(pageUid);\r\n            // This call is done to ensure that default promise properties are removed from the payload.\r\n            const originalPagePayload = objectUtils.copy(originalPage);\r\n            payload = Object.assign(Object.assign({}, originalPagePayload), payload);\r\n            return this.pagesRestService.update(pageUid, payload);\r\n        });\r\n    }\r\n    forcePageApprovalStatus(newPageStatus) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const pageInfo = yield this.getCurrentPageInfo();\r\n            const clonePageInfo = Object.assign({}, pageInfo);\r\n            clonePageInfo.approvalStatus = newPageStatus;\r\n            clonePageInfo.identifier = pageInfo.uuid;\r\n            return this.cmsitemsRestService.update(clonePageInfo);\r\n        });\r\n    }\r\n    isPageApproved(pageParam) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            let page;\r\n            if (typeof pageParam === 'string') {\r\n                page = yield this.getPageByUuid(pageParam);\r\n            }\r\n            else {\r\n                page = pageParam;\r\n            }\r\n            return page.approvalStatus === CmsApprovalStatus.APPROVED;\r\n        });\r\n    }\r\n    buildUriContextForCurrentPage(siteId, catalogId, catalogVersion) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            let uriContext = {};\r\n            if (siteId && catalogId && catalogVersion) {\r\n                uriContext = this.urlService.buildUriContext(siteId, catalogId, catalogVersion);\r\n            }\r\n            if (!isEmpty(uriContext)) {\r\n                return uriContext;\r\n            }\r\n            const experience = yield this.experienceService.getCurrentExperience();\r\n            return this.urlService.buildUriContext(experience.pageContext.siteId, experience.pageContext.catalogId, experience.pageContext.catalogVersion);\r\n        });\r\n    }\r\n};\r\n__decorate([\r\n    Cached({ actions: [rarelyChangingContent], tags: [pageEvictionTag] }),\r\n    __metadata(\"design:type\", Function),\r\n    __metadata(\"design:paramtypes\", [String]),\r\n    __metadata(\"design:returntype\", Promise)\r\n], /* @ngInject */ PageService.prototype, \"getPageByUuid\", null);\r\n__decorate([\r\n    Cached({ actions: [rarelyChangingContent], tags: [pageEvictionTag, pageChangeEvictionTag] }),\r\n    __metadata(\"design:type\", Function),\r\n    __metadata(\"design:paramtypes\", []),\r\n    __metadata(\"design:returntype\", Promise)\r\n], /* @ngInject */ PageService.prototype, \"getCurrentPageInfo\", null);\r\n/* @ngInject */ PageService = __decorate([\r\n    SeDowngradeService(IPageService),\r\n    GatewayProxied(),\r\n    __metadata(\"design:paramtypes\", [PagesRestService,\r\n        PagesFallbacksRestService,\r\n        PagesVariationsRestService,\r\n        IPageInfoService,\r\n        CmsitemsRestService,\r\n        IExperienceService,\r\n        IUrlService])\r\n], /* @ngInject */ PageService);\r\nexport { /* @ngInject */ PageService };\r\n//# sourceMappingURL=PageServiceOuter.js.map","references":["/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/dao/PagesFallbacksRestService.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/dao/PagesRestService.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/dao/PagesVariationsRestService.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@types+lodash@4.14.159/node_modules/@types/lodash/ts3.1/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts"],"map":"{\"version\":3,\"file\":\"PageServiceOuter.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/services/pages/PageServiceOuter.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/node_modules/.cache/rollup-plugin-typescript2/placeholder/services/pages/PageServiceOuter.d.ts","writeByteOrderMark":false,"text":"import { PagesFallbacksRestService } from 'cmssmarteditcontainer/dao/PagesFallbacksRestService';\r\nimport { PagesRestService } from 'cmssmarteditcontainer/dao/PagesRestService';\r\nimport { PagesVariationsRestService } from 'cmssmarteditcontainer/dao/PagesVariationsRestService';\r\nimport { IExperienceService, IPageInfoService, IUriContext, IUrlService, Nullable, CmsitemsRestService, IPage, IPageService, ICMSPage, CmsApprovalStatus } from 'smarteditcommons';\r\nexport declare class PageService extends IPageService {\r\n    private pagesRestService;\r\n    private pagesFallbacksRestService;\r\n    private pagesVariationsRestService;\r\n    private pageInfoService;\r\n    private cmsitemsRestService;\r\n    private experienceService;\r\n    private urlService;\r\n    constructor(pagesRestService: PagesRestService, pagesFallbacksRestService: PagesFallbacksRestService, pagesVariationsRestService: PagesVariationsRestService, pageInfoService: IPageInfoService, cmsitemsRestService: CmsitemsRestService, experienceService: IExperienceService, urlService: IUrlService);\r\n    getPageByUuid(pageUuid: string): Promise<ICMSPage>;\r\n    getCurrentPageInfo(): Promise<ICMSPage>;\r\n    getPageById(pageUid: string): Promise<ICMSPage>;\r\n    getCurrentPageInfoByVersion(versionId: string | null): Promise<ICMSPage>;\r\n    primaryPageForPageTypeExists(pageTypeCode: string, uriParams?: IUriContext): Promise<boolean>;\r\n    getPaginatedPrimaryPagesForPageType(pageTypeCode: string, uriParams?: IUriContext, fetchPageParams?: {\r\n        search: string;\r\n        pageSize: number;\r\n        currentPage: number;\r\n    }): Promise<IPage<ICMSPage>>;\r\n    isPagePrimary(pageUid: string): Promise<boolean>;\r\n    isPagePrimaryWithContext(pageUid: string, uriContext: IUriContext): Promise<boolean>;\r\n    getPrimaryPage(variationPageId: string): Promise<Nullable<ICMSPage>>;\r\n    getVariationPages(primaryPageId: string): Promise<ICMSPage[]>;\r\n    updatePageById(pageUid: string, payload: ICMSPage): Promise<ICMSPage>;\r\n    forcePageApprovalStatus(newPageStatus: CmsApprovalStatus): Promise<ICMSPage>;\r\n    isPageApproved(pageParam: string | ICMSPage): Promise<boolean>;\r\n    buildUriContextForCurrentPage(siteId: Nullable<string>, catalogId: Nullable<string>, catalogVersion: Nullable<string>): Promise<IUriContext>;\r\n}\r\n"}}
