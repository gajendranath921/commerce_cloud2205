{"code":"import { __decorate, __metadata } from \"tslib\";\r\n/*\r\n * Copyright (c) 2022 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { difference, concat } from 'lodash';\r\nimport { CrossFrameEventService, EVENTS, EVENT_CONTENT_CATALOG_UPDATE, GENERIC_EDITOR_UNRELATED_VALIDATION_MESSAGES_EVENT, IAlertService, IConfirmationModalService, SeDowngradeService } from 'smarteditcommons';\r\nimport { PageRestoredAlertService } from '../../actionableAlert';\r\nimport { GenericEditorModalService } from '../../GenericEditorModalService';\r\nimport { ACTIONABLE_ERRORS, NON_ACTIONABLE_ERRORS } from './PageRestoreModalConstants';\r\nlet /* @ngInject */ PageRestoreModalService = class /* @ngInject */ PageRestoreModalService {\r\n    constructor(alertService, confirmationModalService, genericEditorModalService, crossFrameEventService, pageRestoredAlertService, translate) {\r\n        this.alertService = alertService;\r\n        this.confirmationModalService = confirmationModalService;\r\n        this.genericEditorModalService = genericEditorModalService;\r\n        this.crossFrameEventService = crossFrameEventService;\r\n        this.pageRestoredAlertService = pageRestoredAlertService;\r\n        this.translate = translate;\r\n    }\r\n    /**\r\n     * Handles validation errors depending of their type - show error alert for unsupported errors,\r\n     * show confirmation message for non actionable errors, otherwise show modal with detailed errors\r\n     */\r\n    handleRestoreValidationErrors(pageInfo, errors) {\r\n        const actionableErrors = this.getActionableErrors(errors);\r\n        const nonActionableErrors = this.getNonActionableError(errors);\r\n        const unsupportedErrors = difference(errors, actionableErrors, nonActionableErrors);\r\n        if (unsupportedErrors.length > 0) {\r\n            this.showErrorAlert(unsupportedErrors);\r\n        }\r\n        else if (nonActionableErrors.length > 0) {\r\n            this.showConfirmationMessage(nonActionableErrors);\r\n        }\r\n        else {\r\n            this.showRestoreEditor(pageInfo, actionableErrors).then(() => {\r\n                this.crossFrameEventService.publish(EVENT_CONTENT_CATALOG_UPDATE);\r\n            });\r\n        }\r\n    }\r\n    showRestoreEditor(pageInfo, errors) {\r\n        let structureFields = this.getRestoreEditorStructureFields(errors);\r\n        const editorData = {\r\n            content: pageInfo,\r\n            title: 'se.cms.page.restore.page.title',\r\n            componentId: pageInfo.uid,\r\n            componentUuid: pageInfo.uuid,\r\n            componentType: pageInfo.typeCode,\r\n            structure: this.buildStructure(structureFields)\r\n        };\r\n        this.forceErrorsDisplayInEditor(pageInfo.componentUuid, errors);\r\n        return this.genericEditorModalService.open(editorData, () => {\r\n            this.pageRestoredAlertService.displayPageRestoredSuccessAlert(pageInfo);\r\n            this.crossFrameEventService.publish(EVENTS.PAGE_RESTORED);\r\n        }, (newErrors, ge) => {\r\n            const actionableErrors = this.getActionableErrors(newErrors);\r\n            const unsupportedErrors = difference(newErrors, actionableErrors);\r\n            if (unsupportedErrors.length > 0) {\r\n                this.showErrorAlert(unsupportedErrors);\r\n            }\r\n            else {\r\n                structureFields = concat(structureFields, this.getRestoreEditorStructureFields(newErrors));\r\n                ge.structure = this.buildStructure(structureFields);\r\n                this.forceErrorsDisplayInEditor(pageInfo.componentUuid, newErrors);\r\n            }\r\n        }, {\r\n            modalPanelClass: 'modal-stretched'\r\n        });\r\n    }\r\n    forceErrorsDisplayInEditor(editorId, errors) {\r\n        setTimeout(() => {\r\n            this.crossFrameEventService.publish(GENERIC_EDITOR_UNRELATED_VALIDATION_MESSAGES_EVENT, {\r\n                messages: errors,\r\n                targetGenericEditorId: editorId\r\n            });\r\n        }, 0);\r\n    }\r\n    buildStructure(structureFields) {\r\n        return {\r\n            attributes: structureFields,\r\n            category: 'PAGE'\r\n        };\r\n    }\r\n    getRestoreEditorStructureFields(errors) {\r\n        return errors.reduce((accumulator, currentError) => {\r\n            const errorMapping = ACTIONABLE_ERRORS.find((actionableErrorMapping) => this.isSupportedError(currentError) &&\r\n                this.isEqualTo(currentError, actionableErrorMapping));\r\n            accumulator.push(errorMapping.structure);\r\n            return accumulator;\r\n        }, []);\r\n    }\r\n    showConfirmationMessage(errors) {\r\n        const message = errors.reduce((accumulator, currentError) => {\r\n            const errorMapping = NON_ACTIONABLE_ERRORS.find((nonActionableErrorMapping) => this.isSupportedError(currentError) &&\r\n                this.isEqualTo(currentError, nonActionableErrorMapping));\r\n            return accumulator + this.translate.instant(errorMapping.messageKey) + ' ';\r\n        }, '');\r\n        const modalConfig = {\r\n            description: message.trim(),\r\n            showOkButtonOnly: true,\r\n            title: 'se.cms.page.restore.error.confirmationmodal.title'\r\n        };\r\n        this.confirmationModalService.confirm(modalConfig);\r\n    }\r\n    showErrorAlert(errors) {\r\n        const errorMessage = errors.reduce((accumulator, currentError) => accumulator + currentError.message + ' ', '');\r\n        this.alertService.showDanger(errorMessage.trim());\r\n    }\r\n    getActionableErrors(errors) {\r\n        return errors.filter((error) => ACTIONABLE_ERRORS.some((actionableErrorMapping) => this.isSupportedError(error) && this.isEqualTo(error, actionableErrorMapping)));\r\n    }\r\n    getNonActionableError(errors) {\r\n        return errors.filter((error) => NON_ACTIONABLE_ERRORS.some((nonActionableErrorMapping) => this.isSupportedError(error) && this.isEqualTo(error, nonActionableErrorMapping)));\r\n    }\r\n    isSupportedError(error) {\r\n        return error.type === 'ValidationError';\r\n    }\r\n    isEqualTo(error1, error2) {\r\n        return error1.subject === error2.subject && error1.errorCode === error2.errorCode;\r\n    }\r\n};\r\n/* @ngInject */ PageRestoreModalService = __decorate([\r\n    SeDowngradeService(),\r\n    __metadata(\"design:paramtypes\", [IAlertService,\r\n        IConfirmationModalService,\r\n        GenericEditorModalService,\r\n        CrossFrameEventService,\r\n        PageRestoredAlertService,\r\n        TranslateService])\r\n], /* @ngInject */ PageRestoreModalService);\r\nexport { /* @ngInject */ PageRestoreModalService };\r\n//# sourceMappingURL=PageRestoreModalService.js.map","references":["/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@ngx-translate+core@11.0.1_@angular+core@8.2.14+rxjs@6.5.4/node_modules/@ngx-translate/core/ngx-translate-core.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-commons/dist/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@types+lodash@4.14.159/node_modules/@types/lodash/ts3.1/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/services/actionableAlert/index.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/services/components/GenericEditorModalComponent.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/services/GenericEditorModalService.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/services/pages/pageRestore/PageRestoreModalConstants.ts"],"map":"{\"version\":3,\"file\":\"PageRestoreModalService.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/services/pages/pageRestore/PageRestoreModalService.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/node_modules/.cache/rollup-plugin-typescript2/placeholder/services/pages/pageRestore/PageRestoreModalService.d.ts","writeByteOrderMark":false,"text":"import { TranslateService } from '@ngx-translate/core';\r\nimport { CrossFrameEventService, IAlertService, IConfirmationModalService, ValidationError, ICMSPage } from 'smarteditcommons';\r\nimport { PageRestoredAlertService } from '../../actionableAlert';\r\nimport { GenericEditorModalService } from '../../GenericEditorModalService';\r\nexport declare class PageRestoreModalService {\r\n    private alertService;\r\n    private confirmationModalService;\r\n    private genericEditorModalService;\r\n    private crossFrameEventService;\r\n    private pageRestoredAlertService;\r\n    private translate;\r\n    constructor(alertService: IAlertService, confirmationModalService: IConfirmationModalService, genericEditorModalService: GenericEditorModalService, crossFrameEventService: CrossFrameEventService, pageRestoredAlertService: PageRestoredAlertService, translate: TranslateService);\r\n    /**\r\n     * Handles validation errors depending of their type - show error alert for unsupported errors,\r\n     * show confirmation message for non actionable errors, otherwise show modal with detailed errors\r\n     */\r\n    handleRestoreValidationErrors(pageInfo: ICMSPage, errors: ValidationError[]): void;\r\n    private showRestoreEditor;\r\n    private forceErrorsDisplayInEditor;\r\n    private buildStructure;\r\n    private getRestoreEditorStructureFields;\r\n    private showConfirmationMessage;\r\n    private showErrorAlert;\r\n    private getActionableErrors;\r\n    private getNonActionableError;\r\n    private isSupportedError;\r\n    private isEqualTo;\r\n}\r\n"}}
