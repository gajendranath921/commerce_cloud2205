{"code":"import { __awaiter, __decorate, __metadata } from \"tslib\";\r\nimport { ChangeDetectionStrategy, ChangeDetectorRef, Component, Input } from '@angular/core';\r\nimport { SynchronizationService, JOB_STATUS } from 'cmscommons';\r\nimport { take } from 'rxjs/operators';\r\nimport { EVENT_CONTENT_CATALOG_UPDATE, IConfirmationModalService, L10nPipe, SeDowngradeComponent, SystemEventService, USER_TRACKING_FUNCTIONALITY, UserTrackingService } from 'smarteditcommons';\r\nwindow.__smartedit__.addDecoratorPayload(\"Component\", \"SynchronizeCatalogComponent\", {\r\n    selector: 'se-synchronize-catalog',\r\n    template: `<div class=\"se-synchronize-catalog\"><div class=\"se-synchronize-catalog__sync-info\"><div *ngIf=\"isSyncJobFinished()\"><label class=\"se-synchronize-catalog__sync-info__sync-label\" *ngIf=\"catalogVersion.active\"><span translate=\"se.cms.cataloginfo.lastsyncedfrom\"></span>&nbsp; <span>{{ syncJobStatus.source }}</span></label> <label class=\"se-synchronize-catalog__sync-info__sync-label\" *ngIf=\"!catalogVersion.active\" translate=\"se.cms.cataloginfo.lastsynced\"></label> <span class=\"se-synchronize-catalog__sync-info__last-synched\">{{ syncJobStatus.syncEndTime | date: 'M/d/yy h:mm a' }}</span></div><span class=\"se-synchronize-catalog__in-progress\" *ngIf=\"isSyncJobInProgress()\" translate=\"se.sync.status.synced.inprogress\"></span> <span class=\"label-error se-synchronize-catalog__sync-failed\" *ngIf=\"isSyncJobFailed()\" translate=\"se.sync.status.synced.syncfailed\"></span></div><ng-container *seHasOperationPermission=\"syncCatalogPermission\"><ng-container *ngIf=\"!catalogVersion.active\"><button class=\"se-synchronize-catalog__sync-btn fd-button--emphasized\" [disabled]=\"!isSyncButtonEnabled()\" (click)=\"syncCatalog()\" translate=\"se.cms.cataloginfo.btn.sync\"></button></ng-container></ng-container></div>`,\r\n    styles: [`.se-synchronize-catalog{display:flex;flex-direction:row;align-items:center;justify-content:flex-end}.se-synchronize-catalog__sync-info{display:flex;flex-direction:row;align-items:center}.se-synchronize-catalog__sync-btn{margin-left:20px}.se-synchronize-catalog__sync-info__sync-label:first-child{font-weight:700}.se-synchronize-catalog__sync-info__last-synched,.se-synchronize-catalog__sync-info__sync-label{color:#6a6d70;display:block;text-align:right;margin:0}.se-synchronize-catalog__in-progress{color:#0a7e3e}.se-synchronize-catalog__sync-failed{color:#b00}`],\r\n    providers: [L10nPipe],\r\n    changeDetection: ChangeDetectionStrategy.OnPush\r\n});\r\nlet /* @ngInject */ SynchronizeCatalogComponent = class /* @ngInject */ SynchronizeCatalogComponent {\r\n    constructor(synchronizationService, confirmationModalService, systemEventService, l10nPipe, cdr, userTrackingService) {\r\n        this.synchronizationService = synchronizationService;\r\n        this.confirmationModalService = confirmationModalService;\r\n        this.systemEventService = systemEventService;\r\n        this.l10nPipe = l10nPipe;\r\n        this.cdr = cdr;\r\n        this.userTrackingService = userTrackingService;\r\n    }\r\n    ngOnInit() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            this.syncJobStatus = {\r\n                syncStartTime: '',\r\n                syncEndTime: '',\r\n                status: null,\r\n                source: '',\r\n                target: ''\r\n            };\r\n            this.targetCatalogVersion = this.activeCatalogVersion.version;\r\n            this.sourceCatalogVersion = !this.catalogVersion.active\r\n                ? this.catalogVersion.version\r\n                : null;\r\n            this.syncCatalogPermission = [\r\n                {\r\n                    names: ['se.sync.catalog'],\r\n                    context: {\r\n                        catalogId: this.catalog.catalogId,\r\n                        catalogVersion: this.sourceCatalogVersion,\r\n                        targetCatalogVersion: this.targetCatalogVersion\r\n                    }\r\n                }\r\n            ];\r\n            this.catalogDto = {\r\n                catalogId: this.catalog.catalogId,\r\n                targetCatalogVersion: this.targetCatalogVersion,\r\n                sourceCatalogVersion: this.sourceCatalogVersion\r\n            };\r\n            this.synchronizationService.startAutoGetSyncData(this.catalogDto, (job) => this.updateSyncStatusData(job));\r\n            yield this.callGetSyncData();\r\n        });\r\n    }\r\n    ngOnDestroy() {\r\n        this.synchronizationService.stopAutoGetSyncData(this.catalogDto);\r\n    }\r\n    isSyncJobFinished() {\r\n        return this.syncJobStatus.status === JOB_STATUS.FINISHED;\r\n    }\r\n    isSyncJobInProgress() {\r\n        return (this.syncJobStatus.status === JOB_STATUS.RUNNING ||\r\n            this.syncJobStatus.status === JOB_STATUS.UNKNOWN);\r\n    }\r\n    isSyncJobFailed() {\r\n        return (this.syncJobStatus.status === JOB_STATUS.ERROR ||\r\n            this.syncJobStatus.status === JOB_STATUS.FAILURE);\r\n    }\r\n    isSyncButtonEnabled() {\r\n        return !this.isSyncJobInProgress();\r\n    }\r\n    syncCatalog() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            this.userTrackingService.trackingUserAction(USER_TRACKING_FUNCTIONALITY.NAVIGATION, 'Sync');\r\n            const catalogName = yield this.translateCatalogName(this.catalog.name);\r\n            yield this.confirmationModalService\r\n                .confirm({\r\n                title: 'se.sync.confirmation.title',\r\n                description: 'se.sync.confirm.msg',\r\n                descriptionPlaceholders: {\r\n                    catalogName\r\n                }\r\n            })\r\n                .catch(() => Promise.reject());\r\n            const job = yield this.synchronizationService.updateCatalogSync(this.catalogDto);\r\n            this.updateSyncStatusData(job);\r\n            this.systemEventService.publishAsync(EVENT_CONTENT_CATALOG_UPDATE, job);\r\n        });\r\n    }\r\n    translateCatalogName(catalogName) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            return this.l10nPipe.transform(catalogName).pipe(take(1)).toPromise();\r\n        });\r\n    }\r\n    callGetSyncData() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const syncStatus = yield this.synchronizationService.getCatalogSyncStatus(this.catalogDto);\r\n            this.updateSyncStatusData(syncStatus);\r\n        });\r\n    }\r\n    updateSyncStatusData(syncStatus) {\r\n        this.syncJobStatus = {\r\n            syncStartTime: syncStatus.creationDate,\r\n            syncEndTime: syncStatus.endDate,\r\n            status: syncStatus.syncStatus,\r\n            source: syncStatus.sourceCatalogVersion ? syncStatus.sourceCatalogVersion : '',\r\n            target: syncStatus.targetCatalogVersion ? syncStatus.targetCatalogVersion : ''\r\n        };\r\n        if (!this.cdr.destroyed) {\r\n            this.cdr.detectChanges();\r\n        }\r\n    }\r\n};\r\n__decorate([\r\n    Input(),\r\n    __metadata(\"design:type\", Object)\r\n], /* @ngInject */ SynchronizeCatalogComponent.prototype, \"catalog\", void 0);\r\n__decorate([\r\n    Input(),\r\n    __metadata(\"design:type\", Object)\r\n], /* @ngInject */ SynchronizeCatalogComponent.prototype, \"catalogVersion\", void 0);\r\n__decorate([\r\n    Input(),\r\n    __metadata(\"design:type\", Object)\r\n], /* @ngInject */ SynchronizeCatalogComponent.prototype, \"activeCatalogVersion\", void 0);\r\n/* @ngInject */ SynchronizeCatalogComponent = __decorate([\r\n    SeDowngradeComponent(),\r\n    Component({\r\n        selector: 'se-synchronize-catalog',\r\n        template: `<div class=\"se-synchronize-catalog\"><div class=\"se-synchronize-catalog__sync-info\"><div *ngIf=\"isSyncJobFinished()\"><label class=\"se-synchronize-catalog__sync-info__sync-label\" *ngIf=\"catalogVersion.active\"><span translate=\"se.cms.cataloginfo.lastsyncedfrom\"></span>&nbsp; <span>{{ syncJobStatus.source }}</span></label> <label class=\"se-synchronize-catalog__sync-info__sync-label\" *ngIf=\"!catalogVersion.active\" translate=\"se.cms.cataloginfo.lastsynced\"></label> <span class=\"se-synchronize-catalog__sync-info__last-synched\">{{ syncJobStatus.syncEndTime | date: 'M/d/yy h:mm a' }}</span></div><span class=\"se-synchronize-catalog__in-progress\" *ngIf=\"isSyncJobInProgress()\" translate=\"se.sync.status.synced.inprogress\"></span> <span class=\"label-error se-synchronize-catalog__sync-failed\" *ngIf=\"isSyncJobFailed()\" translate=\"se.sync.status.synced.syncfailed\"></span></div><ng-container *seHasOperationPermission=\"syncCatalogPermission\"><ng-container *ngIf=\"!catalogVersion.active\"><button class=\"se-synchronize-catalog__sync-btn fd-button--emphasized\" [disabled]=\"!isSyncButtonEnabled()\" (click)=\"syncCatalog()\" translate=\"se.cms.cataloginfo.btn.sync\"></button></ng-container></ng-container></div>`,\r\n        styles: [`.se-synchronize-catalog{display:flex;flex-direction:row;align-items:center;justify-content:flex-end}.se-synchronize-catalog__sync-info{display:flex;flex-direction:row;align-items:center}.se-synchronize-catalog__sync-btn{margin-left:20px}.se-synchronize-catalog__sync-info__sync-label:first-child{font-weight:700}.se-synchronize-catalog__sync-info__last-synched,.se-synchronize-catalog__sync-info__sync-label{color:#6a6d70;display:block;text-align:right;margin:0}.se-synchronize-catalog__in-progress{color:#0a7e3e}.se-synchronize-catalog__sync-failed{color:#b00}`],\r\n        providers: [L10nPipe],\r\n        changeDetection: ChangeDetectionStrategy.OnPush\r\n    }),\r\n    __metadata(\"design:paramtypes\", [SynchronizationService,\r\n        IConfirmationModalService,\r\n        SystemEventService,\r\n        L10nPipe,\r\n        ChangeDetectorRef,\r\n        UserTrackingService])\r\n], /* @ngInject */ SynchronizeCatalogComponent);\r\nexport { /* @ngInject */ SynchronizeCatalogComponent };\r\n//# sourceMappingURL=SynchronizeCatalogComponent.js.map","references":["/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular+core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-commons/dist/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/rxjs@6.5.4/node_modules/rxjs/operators/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts"],"map":"{\"version\":3,\"file\":\"SynchronizeCatalogComponent.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../../src/components/synchronize/components/synchronizeCatalog/SynchronizeCatalogComponent.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/node_modules/.cache/rollup-plugin-typescript2/placeholder/components/synchronize/components/synchronizeCatalog/SynchronizeCatalogComponent.d.ts","writeByteOrderMark":false,"text":"import { ChangeDetectorRef, OnDestroy, OnInit } from '@angular/core';\r\nimport { SynchronizationService, ISyncJob, JOB_STATUS } from 'cmscommons';\r\nimport { ICatalog, ICatalogVersion, IConfirmationModalService, L10nPipe, MultiNamePermissionContext, Nullable, SystemEventService, UserTrackingService } from 'smarteditcommons';\r\ninterface SyncJobStatus {\r\n    syncStartTime: string;\r\n    syncEndTime: string;\r\n    status: JOB_STATUS;\r\n    source: string;\r\n    target: string;\r\n}\r\nexport declare class SynchronizeCatalogComponent implements OnInit, OnDestroy {\r\n    private synchronizationService;\r\n    private confirmationModalService;\r\n    private systemEventService;\r\n    private l10nPipe;\r\n    private cdr;\r\n    private userTrackingService;\r\n    catalog: ICatalog;\r\n    catalogVersion: ICatalogVersion;\r\n    activeCatalogVersion: ICatalogVersion;\r\n    syncJobStatus: SyncJobStatus;\r\n    targetCatalogVersion: string;\r\n    sourceCatalogVersion: Nullable<string>;\r\n    syncCatalogPermission: MultiNamePermissionContext[];\r\n    catalogDto: ISyncJob;\r\n    constructor(synchronizationService: SynchronizationService, confirmationModalService: IConfirmationModalService, systemEventService: SystemEventService, l10nPipe: L10nPipe, cdr: ChangeDetectorRef, userTrackingService: UserTrackingService);\r\n    ngOnInit(): Promise<void>;\r\n    ngOnDestroy(): void;\r\n    isSyncJobFinished(): boolean;\r\n    isSyncJobInProgress(): boolean;\r\n    isSyncJobFailed(): boolean;\r\n    isSyncButtonEnabled(): boolean;\r\n    syncCatalog(): Promise<void>;\r\n    private translateCatalogName;\r\n    private callGetSyncData;\r\n    private updateSyncStatusData;\r\n}\r\nexport {};\r\n"}}
