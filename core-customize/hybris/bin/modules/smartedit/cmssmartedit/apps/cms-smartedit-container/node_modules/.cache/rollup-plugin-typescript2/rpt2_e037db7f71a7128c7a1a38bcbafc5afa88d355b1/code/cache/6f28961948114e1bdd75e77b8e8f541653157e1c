{"code":"import { __awaiter, __decorate, __metadata, __param } from \"tslib\";\r\nimport { ChangeDetectionStrategy, ChangeDetectorRef, Component, Inject } from '@angular/core';\r\nimport { isEmpty } from 'lodash';\r\nimport { take } from 'rxjs/operators';\r\nimport { L10nPipe, GENERIC_EDITOR_WIDGET_DATA, WorkflowService } from 'smarteditcommons';\r\nwindow.__smartedit__.addDecoratorPayload(\"Component\", \"WorkflowCreateVersionFieldComponent\", {\r\n    selector: 'se-workflow-create-version-field',\r\n    template: `<div class=\"fd-form__set\"><div class=\"fd-form__item fd-form__item--check\"><label class=\"fd-form__label\"><input type=\"checkbox\" class=\"fd-form__control\" name=\"createVersion\" [(ngModel)]=\"model.createVersion\"/> {{ 'se.cms.workflow.editor.create.version' | translate }}</label></div><div class=\"fd-form__item\" *ngIf=\"model.createVersion\"><label class=\"fd-form__label version-label__title\" for=\"versionLabel\" translate=\"se.cms.workflow.editor.create.version.label\"></label> <input type=\"text\" name=\"versionLabel\" class=\"fd-form__control\" [class.has-error]=\"field.hasErrors\" [(ngModel)]=\"model.versionLabel\"/></div></div>`,\r\n    providers: [L10nPipe],\r\n    changeDetection: ChangeDetectionStrategy.OnPush\r\n});\r\nlet WorkflowCreateVersionFieldComponent = class WorkflowCreateVersionFieldComponent {\r\n    constructor(workflowService, data, cdr, l10nPipe) {\r\n        this.workflowService = workflowService;\r\n        this.data = data;\r\n        this.cdr = cdr;\r\n        this.l10nPipe = l10nPipe;\r\n        ({ field: this.field, model: this.model, editor: this.editor } = data);\r\n    }\r\n    ngOnInit() {\r\n        this.unregisterOnChangeEvent = this.editor.api.addContentChangeEvent(() => this.onCreateVersionChange());\r\n    }\r\n    ngOnDestroy() {\r\n        this.unregisterOnChangeEvent();\r\n    }\r\n    onCreateVersionChange() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (this.model.createVersion === false) {\r\n                this.model.versionLabel = null;\r\n                if (!this.cdr.destroyed) {\r\n                    this.cdr.detectChanges();\r\n                }\r\n                return;\r\n            }\r\n            if (!isEmpty(this.model.versionLabel)) {\r\n                return;\r\n            }\r\n            if (this.model.decisionCode) {\r\n                const workflowActions = yield this.workflowService.getAllActionsForWorkflowCode(this.model.workflowCode);\r\n                const workflowAction = workflowActions.find((action) => action.code === this.model.actionCode);\r\n                const workflowDecision = workflowAction.decisions.find((decision) => decision.code === this.model.decisionCode);\r\n                const [workflowDecisionName, workflowActionName] = yield Promise.all([\r\n                    this.l10nPipe.transform(workflowDecision.name).pipe(take(1)).toPromise(),\r\n                    this.l10nPipe.transform(workflowAction.name).pipe(take(1)).toPromise()\r\n                ]);\r\n                this.model.versionLabel = `${workflowDecisionName} for ${workflowActionName}`;\r\n                if (!this.cdr.destroyed) {\r\n                    this.cdr.detectChanges();\r\n                }\r\n                return;\r\n            }\r\n            const workflow = yield this.workflowService.getWorkflowTemplateByCode(this.model.templateCode);\r\n            if (workflow) {\r\n                const workflowName = yield this.l10nPipe\r\n                    .transform(workflow.name)\r\n                    .pipe(take(1))\r\n                    .toPromise();\r\n                this.model.versionLabel = `${workflowName} workflow started`;\r\n                if (!this.cdr.destroyed) {\r\n                    this.cdr.detectChanges();\r\n                }\r\n            }\r\n        });\r\n    }\r\n};\r\nWorkflowCreateVersionFieldComponent = __decorate([\r\n    Component({\r\n        selector: 'se-workflow-create-version-field',\r\n        template: `<div class=\"fd-form__set\"><div class=\"fd-form__item fd-form__item--check\"><label class=\"fd-form__label\"><input type=\"checkbox\" class=\"fd-form__control\" name=\"createVersion\" [(ngModel)]=\"model.createVersion\"/> {{ 'se.cms.workflow.editor.create.version' | translate }}</label></div><div class=\"fd-form__item\" *ngIf=\"model.createVersion\"><label class=\"fd-form__label version-label__title\" for=\"versionLabel\" translate=\"se.cms.workflow.editor.create.version.label\"></label> <input type=\"text\" name=\"versionLabel\" class=\"fd-form__control\" [class.has-error]=\"field.hasErrors\" [(ngModel)]=\"model.versionLabel\"/></div></div>`,\r\n        providers: [L10nPipe],\r\n        changeDetection: ChangeDetectionStrategy.OnPush\r\n    }),\r\n    __param(1, Inject(GENERIC_EDITOR_WIDGET_DATA)),\r\n    __metadata(\"design:paramtypes\", [WorkflowService, Object, ChangeDetectorRef,\r\n        L10nPipe])\r\n], WorkflowCreateVersionFieldComponent);\r\nexport { WorkflowCreateVersionFieldComponent };\r\n//# sourceMappingURL=WorkflowCreateVersionFieldComponent.js.map","references":["/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular+core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@types+lodash@4.14.159/node_modules/@types/lodash/ts3.1/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/rxjs@6.5.4/node_modules/rxjs/operators/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts"],"map":"{\"version\":3,\"file\":\"WorkflowCreateVersionFieldComponent.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/components/genericEditor/workflowCreateVersionField/WorkflowCreateVersionFieldComponent.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/node_modules/.cache/rollup-plugin-typescript2/placeholder/components/genericEditor/workflowCreateVersionField/WorkflowCreateVersionFieldComponent.d.ts","writeByteOrderMark":false,"text":"import { ChangeDetectorRef, OnDestroy, OnInit } from '@angular/core';\r\nimport { L10nPipe, GenericEditorField, GenericEditorWidgetData, Nullable, WorkflowService } from 'smarteditcommons';\r\ninterface WorkflowCreateVersionFieldData {\r\n    workflowCode: string;\r\n    actionCode: string;\r\n    decisionCode: string;\r\n    templateCode: string;\r\n    createVersion: boolean;\r\n    versionLabel: Nullable<string>;\r\n}\r\nexport declare class WorkflowCreateVersionFieldComponent implements OnInit, OnDestroy {\r\n    private workflowService;\r\n    data: GenericEditorWidgetData<WorkflowCreateVersionFieldData>;\r\n    private cdr;\r\n    private l10nPipe;\r\n    field: GenericEditorField;\r\n    model: WorkflowCreateVersionFieldData;\r\n    private editor;\r\n    private unregisterOnChangeEvent;\r\n    constructor(workflowService: WorkflowService, data: GenericEditorWidgetData<WorkflowCreateVersionFieldData>, cdr: ChangeDetectorRef, l10nPipe: L10nPipe);\r\n    ngOnInit(): void;\r\n    ngOnDestroy(): void;\r\n    onCreateVersionChange(): Promise<void>;\r\n}\r\nexport {};\r\n"}}
