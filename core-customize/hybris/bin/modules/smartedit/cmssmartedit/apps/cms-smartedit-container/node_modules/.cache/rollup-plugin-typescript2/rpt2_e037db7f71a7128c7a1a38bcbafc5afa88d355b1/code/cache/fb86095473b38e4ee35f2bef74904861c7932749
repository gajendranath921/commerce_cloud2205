{"code":"import { __awaiter, __decorate, __metadata } from \"tslib\";\r\nimport { cloneDeep } from 'lodash';\r\nimport { stringUtils, ICatalogService, IPageInfoService, SeDowngradeService, CmsitemsRestService, IPageService } from 'smarteditcommons';\r\nimport { TypeStructureRestService } from '../../../dao/TypeStructureRestService';\r\nimport { ContextAwarePageStructureService } from '../../../services';\r\nexport class ClonePageBuilder {\r\n    constructor(restrictionsStepHandler, basePageUUID, uriContext, contextAwarePageStructureService, typeStructureRestService, cmsitemsRestService, catalogService, pageInfoService) {\r\n        this.restrictionsStepHandler = restrictionsStepHandler;\r\n        this.basePageUUID = basePageUUID;\r\n        this.uriContext = uriContext;\r\n        this.contextAwarePageStructureService = contextAwarePageStructureService;\r\n        this.typeStructureRestService = typeStructureRestService;\r\n        this.cmsitemsRestService = cmsitemsRestService;\r\n        this.catalogService = catalogService;\r\n        this.pageInfoService = pageInfoService;\r\n        this.basePage = {};\r\n        this.pageData = {};\r\n        this.pageInfoStructure = {};\r\n        this.basePageInfoAvailable = false;\r\n        this.componentCloneOption = '';\r\n    }\r\n    getPageTypeCode() {\r\n        return this.pageData.typeCode;\r\n    }\r\n    getPageTemplate() {\r\n        return this.pageData.template;\r\n    }\r\n    getPageLabel() {\r\n        return this.pageData.label;\r\n    }\r\n    getBasePageUuid() {\r\n        return this.basePage.uuid;\r\n    }\r\n    getPageInfo() {\r\n        return this.pageData;\r\n    }\r\n    getBasePageInfo() {\r\n        return this.basePage;\r\n    }\r\n    getPageProperties() {\r\n        return {\r\n            type: this.pageData.type,\r\n            typeCode: this.pageData.typeCode,\r\n            template: this.pageData.template,\r\n            onlyOneRestrictionMustApply: this.pageData.onlyOneRestrictionMustApply,\r\n            catalogVersion: this.pageData.catalogVersion\r\n        };\r\n    }\r\n    getPageInfoStructure() {\r\n        return this.pageInfoStructure;\r\n    }\r\n    getPageRestrictions() {\r\n        return this.pageData.restrictions || [];\r\n    }\r\n    getComponentCloneOption() {\r\n        return this.componentCloneOption;\r\n    }\r\n    displayConditionSelected(displayConditionResult) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const isPrimaryPage = displayConditionResult.isPrimary;\r\n            this.pageData.defaultPage = isPrimaryPage;\r\n            this.pageData.homepage = displayConditionResult.homepage;\r\n            if (isPrimaryPage) {\r\n                this.pageData.label = this.basePage.label;\r\n                if (this.pageData.restrictions) {\r\n                    delete this.pageData.restrictions;\r\n                }\r\n                this.restrictionsStepHandler.hideStep();\r\n            }\r\n            else {\r\n                this.pageData.label = displayConditionResult.primaryPage\r\n                    ? displayConditionResult.primaryPage.label\r\n                    : '';\r\n                this.restrictionsStepHandler.showStep();\r\n            }\r\n            this.pageData.uid = '';\r\n            yield this.updatePageInfoFields();\r\n        });\r\n    }\r\n    onTargetCatalogVersionSelected(targetCatalogVersion) {\r\n        this.targetCatalogVersion = targetCatalogVersion;\r\n        this.pageData.catalogVersion = targetCatalogVersion.uuid;\r\n    }\r\n    componentCloneOptionSelected(cloneOptionResult) {\r\n        this.componentCloneOption = cloneOptionResult;\r\n    }\r\n    restrictionsSelected(onlyOneRestrictionMustApply, restrictions) {\r\n        this.pageData.onlyOneRestrictionMustApply = onlyOneRestrictionMustApply;\r\n        this.pageData.restrictions = restrictions;\r\n    }\r\n    getTargetCatalogVersion() {\r\n        return this.targetCatalogVersion;\r\n    }\r\n    isBasePageInfoAvailable() {\r\n        return this.basePageInfoAvailable;\r\n    }\r\n    init() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const pageUUID = yield this.getPageUUID(this.basePageUUID);\r\n            const uuid = yield this.catalogService.getCatalogVersionUUid(this.uriContext);\r\n            const page = yield this.cmsitemsRestService.getById(pageUUID);\r\n            this.basePage = cloneDeep(page);\r\n            this.pageData = cloneDeep(this.basePage);\r\n            this.pageData.catalogVersion = uuid;\r\n            this.pageData.pageUuid = this.basePage.uuid;\r\n            delete this.pageData.uuid;\r\n            this.basePageInfoAvailable = true;\r\n            this.pageData.template = this.basePage.masterTemplateId;\r\n            const structure = (yield this.typeStructureRestService.getStructureByTypeAndMode(this.pageData.typeCode, 'DEFAULT', true));\r\n            this.pageData.type = structure.type;\r\n        });\r\n    }\r\n    getPageUUID(pageUUID) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            return !stringUtils.isBlank(pageUUID) ? pageUUID : this.pageInfoService.getPageUUID();\r\n        });\r\n    }\r\n    updatePageInfoFields() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (typeof this.pageData.defaultPage === 'undefined') {\r\n                return;\r\n            }\r\n            if (this.pageData.typeCode) {\r\n                const pageInfoFields = yield this.contextAwarePageStructureService.getPageStructureForNewPage(this.pageData.typeCode, this.pageData.defaultPage);\r\n                this.pageInfoStructure = pageInfoFields;\r\n            }\r\n            else {\r\n                this.pageInfoStructure = {};\r\n            }\r\n        });\r\n    }\r\n}\r\nlet /* @ngInject */ ClonePageBuilderFactory = class /* @ngInject */ ClonePageBuilderFactory {\r\n    constructor(contextAwarePageStructureService, typeStructureRestService, cmsitemsRestService, catalogService, pageInfoService, pageService) {\r\n        this.contextAwarePageStructureService = contextAwarePageStructureService;\r\n        this.typeStructureRestService = typeStructureRestService;\r\n        this.cmsitemsRestService = cmsitemsRestService;\r\n        this.catalogService = catalogService;\r\n        this.pageInfoService = pageInfoService;\r\n        this.pageService = pageService;\r\n    }\r\n    createClonePageBuilder(restrictionsStepHandler, basePageUUID, uriContext) {\r\n        return new ClonePageBuilder(restrictionsStepHandler, basePageUUID, uriContext, this.contextAwarePageStructureService, this.typeStructureRestService, this.cmsitemsRestService, this.catalogService, this.pageInfoService);\r\n    }\r\n};\r\n/* @ngInject */ ClonePageBuilderFactory = __decorate([\r\n    SeDowngradeService(),\r\n    __metadata(\"design:paramtypes\", [ContextAwarePageStructureService,\r\n        TypeStructureRestService,\r\n        CmsitemsRestService,\r\n        ICatalogService,\r\n        IPageInfoService,\r\n        IPageService])\r\n], /* @ngInject */ ClonePageBuilderFactory);\r\nexport { /* @ngInject */ ClonePageBuilderFactory };\r\n//# sourceMappingURL=ClonePageBuilderFactory.js.map","references":["/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-commons/dist/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@types+lodash@4.14.159/node_modules/@types/lodash/ts3.1/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/dao/TypeStructureRestService.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/interfaces/index.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/services/index.ts"],"map":"{\"version\":3,\"file\":\"ClonePageBuilderFactory.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/components/pages/clonePageWizard/ClonePageBuilderFactory.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/node_modules/.cache/rollup-plugin-typescript2/placeholder/components/pages/clonePageWizard/ClonePageBuilderFactory.d.ts","writeByteOrderMark":false,"text":"import { GenericEditorStructure, ICatalogService, ICatalogVersion, IPageInfoService, IUriContext, CmsitemsRestService, IPageService, ICMSPage, CMSPageTypes } from 'smarteditcommons';\r\nimport { TypeStructureRestService } from '../../../dao/TypeStructureRestService';\r\nimport { IRestrictionsStepHandler } from '../../../interfaces';\r\nimport { ContextAwarePageStructureService } from '../../../services';\r\nexport declare class ClonePageBuilder {\r\n    private restrictionsStepHandler;\r\n    private basePageUUID;\r\n    private uriContext;\r\n    private contextAwarePageStructureService;\r\n    private typeStructureRestService;\r\n    private cmsitemsRestService;\r\n    private catalogService;\r\n    private pageInfoService;\r\n    private basePage;\r\n    private pageData;\r\n    private pageInfoStructure;\r\n    private targetCatalogVersion;\r\n    private componentCloneOption;\r\n    private basePageInfoAvailable;\r\n    constructor(restrictionsStepHandler: IRestrictionsStepHandler, basePageUUID: string, uriContext: IUriContext, contextAwarePageStructureService: ContextAwarePageStructureService, typeStructureRestService: TypeStructureRestService, cmsitemsRestService: CmsitemsRestService, catalogService: ICatalogService, pageInfoService: IPageInfoService);\r\n    getPageTypeCode(): CMSPageTypes;\r\n    getPageTemplate(): string;\r\n    getPageLabel(): string;\r\n    getBasePageUuid(): string;\r\n    getPageInfo(): ICMSPage;\r\n    getBasePageInfo(): ICMSPage;\r\n    getPageProperties(): Partial<ICMSPage>;\r\n    getPageInfoStructure(): GenericEditorStructure;\r\n    getPageRestrictions(): string[];\r\n    getComponentCloneOption(): string;\r\n    displayConditionSelected(displayConditionResult: ICMSPage): Promise<void>;\r\n    onTargetCatalogVersionSelected(targetCatalogVersion: ICatalogVersion): void;\r\n    componentCloneOptionSelected(cloneOptionResult: string): void;\r\n    restrictionsSelected(onlyOneRestrictionMustApply: boolean, restrictions: string[]): void;\r\n    getTargetCatalogVersion(): ICatalogVersion;\r\n    isBasePageInfoAvailable(): boolean;\r\n    init(): Promise<void>;\r\n    private getPageUUID;\r\n    private updatePageInfoFields;\r\n}\r\nexport declare class ClonePageBuilderFactory {\r\n    private contextAwarePageStructureService;\r\n    private typeStructureRestService;\r\n    private cmsitemsRestService;\r\n    private catalogService;\r\n    private pageInfoService;\r\n    private pageService;\r\n    constructor(contextAwarePageStructureService: ContextAwarePageStructureService, typeStructureRestService: TypeStructureRestService, cmsitemsRestService: CmsitemsRestService, catalogService: ICatalogService, pageInfoService: IPageInfoService, pageService: IPageService);\r\n    createClonePageBuilder(restrictionsStepHandler: IRestrictionsStepHandler, basePageUUID: string, uriContext: IUriContext): ClonePageBuilder;\r\n}\r\n"}}
