{"code":"import { __awaiter, __decorate, __metadata } from \"tslib\";\r\nimport { Component, EventEmitter, Input, Output, ViewChild } from '@angular/core';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { SynchronizationPanelComponent } from 'cmscommons';\r\nimport { HomepageService } from 'cmssmarteditcontainer/services';\r\nimport { cloneDeep } from 'lodash';\r\nimport { CrossFrameEventService, EVENTS, IAlertServiceType, SeDowngradeComponent, IPageService, ISyncPollingService } from 'smarteditcommons';\r\nimport { PAGE_SYNC_STATUS_READY } from '../../constants';\r\nwindow.__smartedit__.addDecoratorPayload(\"Component\", \"PageSynchronizationPanelComponent\", {\r\n    selector: 'se-page-synchronization-panel',\r\n    template: `<se-page-synchronization-header class=\"se-sync-panel__sync-status\" [syncStatus]=\"syncStatus\" [pageSyncConditions]=\"pageSyncConditions\"></se-page-synchronization-header><se-synchronization-panel *ngIf=\"!showFooter\" [itemId]=\"cmsPage.uuid\" [showFooter]=\"false\" [getSyncStatus]=\"getSyncStatus\" [performSync]=\"performSync\" (selectedItemsUpdate)=\"onSelectedItemsUpdate($event)\" (syncStatusReady)=\"onSyncStatusReady($event)\" (getApi)=\"onGetApi($event)\"></se-synchronization-panel><se-synchronization-panel *ngIf=\"showFooter\" [itemId]=\"cmsPage.uuid\" [getSyncStatus]=\"getSyncStatus\" [performSync]=\"performSync\" (syncStatusReady)=\"onSyncStatusReady($event)\" (getApi)=\"onGetApi($event)\"></se-synchronization-panel>`\r\n});\r\nlet /* @ngInject */ PageSynchronizationPanelComponent = class /* @ngInject */ PageSynchronizationPanelComponent {\r\n    constructor(pageService, homepageService, crossFrameEventService, syncPollingService, translateService) {\r\n        this.pageService = pageService;\r\n        this.homepageService = homepageService;\r\n        this.crossFrameEventService = crossFrameEventService;\r\n        this.syncPollingService = syncPollingService;\r\n        this.translateService = translateService;\r\n        this.getSyncStatus = () => __awaiter(this, void 0, void 0, function* () {\r\n            const [canSyncHomepage, syncStatus] = yield Promise.all([\r\n                this.homepageService.canSyncHomepage(this.cmsPage, this.uriContext),\r\n                this.syncPollingService.getSyncStatus(this.cmsPage.uuid, this.uriContext),\r\n                this.evaluateIfSyncIsApproved()\r\n            ]);\r\n            this.pageSyncConditions.canSyncHomepage = canSyncHomepage;\r\n            this.syncStatus = syncStatus;\r\n            return this.syncStatus;\r\n        });\r\n        this.performSync = (items) => this.syncPollingService.performSync(items, this.uriContext);\r\n        this.syncStatusReady = (syncStatus) => {\r\n            this.pageSyncConditions.pageHasUnavailableDependencies =\r\n                syncStatus.unavailableDependencies.length > 0;\r\n            this.pageSyncConditions.pageHasSyncStatus = !!syncStatus.lastSyncStatus;\r\n            this.pageSyncConditions.pageHasNoDepOrNoSyncStatus =\r\n                this.pageSyncConditions.pageHasUnavailableDependencies ||\r\n                    !this.pageSyncConditions.pageHasSyncStatus;\r\n            this.pageSyncConditions = cloneDeep(this.pageSyncConditions);\r\n            if (this.pageSyncConditions.pageHasUnavailableDependencies) {\r\n                this.hidePageSync();\r\n            }\r\n            else if (!this.pageSyncConditions.pageHasSyncStatus) {\r\n                this.showPageSync();\r\n            }\r\n            else {\r\n                this.enableSlotsSync();\r\n            }\r\n            this.crossFrameEventService.publish(PAGE_SYNC_STATUS_READY, this.pageSyncConditions);\r\n        };\r\n        this.selectedItemsUpdate = new EventEmitter();\r\n        this.showFooter = true;\r\n        this.syncStatus = null;\r\n        this.pageSyncConditions = {\r\n            canSyncHomepage: false,\r\n            pageHasUnavailableDependencies: false,\r\n            pageHasSyncStatus: false,\r\n            pageHasNoDepOrNoSyncStatus: false\r\n        };\r\n    }\r\n    ngOnInit() {\r\n        this.unSubPageUpdatedEvent = this.crossFrameEventService.subscribe(EVENTS.PAGE_UPDATED, () => this.evaluateIfSyncIsApproved());\r\n    }\r\n    ngOnDestroy() {\r\n        this.unSubPageUpdatedEvent();\r\n    }\r\n    onGetApi(api) {\r\n        this.synchronizationPanelApi = api;\r\n        this.synchronizationPanelApi.disableItem = (item) => !this.pageSyncConditions.canSyncHomepage && item === this.syncStatus;\r\n    }\r\n    onSyncStatusReady(syncStatus) {\r\n        this.syncStatusReady(syncStatus);\r\n    }\r\n    onSelectedItemsUpdate(items) {\r\n        this.selectedItemsUpdate.emit(items);\r\n    }\r\n    syncItems() {\r\n        return this.synchronizationPanel.syncItems();\r\n    }\r\n    evaluateIfSyncIsApproved() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const isPageApproved = yield this.pageService.isPageApproved(this.cmsPage.uuid);\r\n            if (!isPageApproved) {\r\n                this.disablePageSync();\r\n            }\r\n        });\r\n    }\r\n    disablePageSync() {\r\n        this.synchronizationPanelApi.setMessage({\r\n            type: IAlertServiceType.WARNING,\r\n            description: this.translateService.instant('se.cms.synchronization.slot.disabled.msg')\r\n        });\r\n        this.synchronizationPanelApi.disableItemList(true);\r\n    }\r\n    hidePageSync() {\r\n        this.synchronizationPanelApi.displayItemList(false);\r\n    }\r\n    showPageSync() {\r\n        this.synchronizationPanelApi.selectAll();\r\n        this.synchronizationPanelApi.displayItemList(false);\r\n    }\r\n    enableSlotsSync() {\r\n        this.synchronizationPanelApi.displayItemList(true);\r\n    }\r\n};\r\n__decorate([\r\n    Output(),\r\n    __metadata(\"design:type\", EventEmitter)\r\n], /* @ngInject */ PageSynchronizationPanelComponent.prototype, \"selectedItemsUpdate\", void 0);\r\n__decorate([\r\n    Input(),\r\n    __metadata(\"design:type\", Object)\r\n], /* @ngInject */ PageSynchronizationPanelComponent.prototype, \"uriContext\", void 0);\r\n__decorate([\r\n    Input(),\r\n    __metadata(\"design:type\", Object)\r\n], /* @ngInject */ PageSynchronizationPanelComponent.prototype, \"cmsPage\", void 0);\r\n__decorate([\r\n    Input(),\r\n    __metadata(\"design:type\", Boolean)\r\n], /* @ngInject */ PageSynchronizationPanelComponent.prototype, \"showFooter\", void 0);\r\n__decorate([\r\n    ViewChild(SynchronizationPanelComponent, { static: false }),\r\n    __metadata(\"design:type\", SynchronizationPanelComponent)\r\n], /* @ngInject */ PageSynchronizationPanelComponent.prototype, \"synchronizationPanel\", void 0);\r\n/* @ngInject */ PageSynchronizationPanelComponent = __decorate([\r\n    SeDowngradeComponent(),\r\n    Component({\r\n        selector: 'se-page-synchronization-panel',\r\n        template: `<se-page-synchronization-header class=\"se-sync-panel__sync-status\" [syncStatus]=\"syncStatus\" [pageSyncConditions]=\"pageSyncConditions\"></se-page-synchronization-header><se-synchronization-panel *ngIf=\"!showFooter\" [itemId]=\"cmsPage.uuid\" [showFooter]=\"false\" [getSyncStatus]=\"getSyncStatus\" [performSync]=\"performSync\" (selectedItemsUpdate)=\"onSelectedItemsUpdate($event)\" (syncStatusReady)=\"onSyncStatusReady($event)\" (getApi)=\"onGetApi($event)\"></se-synchronization-panel><se-synchronization-panel *ngIf=\"showFooter\" [itemId]=\"cmsPage.uuid\" [getSyncStatus]=\"getSyncStatus\" [performSync]=\"performSync\" (syncStatusReady)=\"onSyncStatusReady($event)\" (getApi)=\"onGetApi($event)\"></se-synchronization-panel>`\r\n    }),\r\n    __metadata(\"design:paramtypes\", [IPageService,\r\n        HomepageService,\r\n        CrossFrameEventService,\r\n        ISyncPollingService,\r\n        TranslateService])\r\n], /* @ngInject */ PageSynchronizationPanelComponent);\r\nexport { /* @ngInject */ PageSynchronizationPanelComponent };\r\n//# sourceMappingURL=PageSynchronizationPanelComponent.js.map","references":["/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular+core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@ngx-translate+core@11.0.1_@angular+core@8.2.14+rxjs@6.5.4/node_modules/@ngx-translate/core/ngx-translate-core.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-commons/dist/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/services/index.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@types+lodash@4.14.159/node_modules/@types/lodash/ts3.1/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/components/synchronize/constants.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/components/synchronize/types.ts"],"map":"{\"version\":3,\"file\":\"PageSynchronizationPanelComponent.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../../src/components/synchronize/components/pageSynchronizationPanel/PageSynchronizationPanelComponent.ts\"],\"names\":[],\"mappings\":\";AACA,OAAO,EACH,SAAS,EACT,YAAY,EACZ,KAAK,EAGL,MAAM,EACN,SAAS,EACZ,MAAM,eAAe,CAAC;AACvB,OAAO,EAAE,gBAAgB,EAAE,MAAM,qBAAqB,CAAC;AACvD,OAAO,EAKH,6BAA6B,EAChC,MAAM,YAAY,CAAC;AACpB,OAAO,EAAE,eAAe,EAAE,MAAM,gCAAgC,CAAC;AACjE,OAAO,EAAE,SAAS,EAAE,MAAM,QAAQ,CAAC;AACnC,OAAO,EACH,sBAAsB,EACtB,MAAM,EACN,iBAAiB,EAEjB,oBAAoB,EAEpB,YAAY,EAEZ,mBAAmB,EACtB,MAAM,kBAAkB,CAAC;AAC1B,OAAO,EAAE,sBAAsB,EAAE,MAAM,iBAAiB,CAAC;2FAI9C;IACP,QAAQ,EAAE,+BAA+B;IACzC,QAAQ,EAAE,ksBAAksB;CAC/sB;AACD,wDAAA;IAgBI,YACY,WAAyB,EACzB,eAAgC,EAChC,sBAA8C,EAC9C,kBAAuC,EACvC,gBAAkC;QAJlC,gBAAW,GAAX,WAAW,CAAc;QACzB,oBAAe,GAAf,eAAe,CAAiB;QAChC,2BAAsB,GAAtB,sBAAsB,CAAwB;QAC9C,uBAAkB,GAAlB,kBAAkB,CAAqB;QACvC,qBAAgB,GAAhB,gBAAgB,CAAkB;QA0BvC,kBAAa,GAAG,GAA+B,EAAE;YACpD,MAAM,CAAC,eAAe,EAAE,UAAU,CAAC,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC;gBACpD,IAAI,CAAC,eAAe,CAAC,eAAe,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,UAAU,CAAC;gBACnE,IAAI,CAAC,kBAAkB,CAAC,aAAa,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,IAAI,CAAC,UAAU,CAAC;gBACzE,IAAI,CAAC,wBAAwB,EAAE;aAClC,CAAC,CAAC;YAEH,IAAI,CAAC,kBAAkB,CAAC,eAAe,GAAG,eAAe,CAAC;YAE1D,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;YAE7B,OAAO,IAAI,CAAC,UAAU,CAAC;QAC3B,CAAC,CAAA,CAAC;QAEK,gBAAW,GAAG,CAAC,KAAyB,EAAqB,EAAE,CAClE,IAAI,CAAC,kBAAkB,CAAC,WAAW,CAAC,KAAK,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QAqBxD,oBAAe,GAAG,CAAC,UAAuB,EAAQ,EAAE;YACxD,IAAI,CAAC,kBAAkB,CAAC,8BAA8B;gBAClD,UAAU,CAAC,uBAAuB,CAAC,MAAM,GAAG,CAAC,CAAC;YAClD,IAAI,CAAC,kBAAkB,CAAC,iBAAiB,GAAG,CAAC,CAAC,UAAU,CAAC,cAAc,CAAC;YACxE,IAAI,CAAC,kBAAkB,CAAC,0BAA0B;gBAC9C,IAAI,CAAC,kBAAkB,CAAC,8BAA8B;oBACtD,CAAC,IAAI,CAAC,kBAAkB,CAAC,iBAAiB,CAAC;YAE/C,IAAI,CAAC,kBAAkB,GAAG,SAAS,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;YAE7D,IAAI,IAAI,CAAC,kBAAkB,CAAC,8BAA8B,EAAE;gBACxD,IAAI,CAAC,YAAY,EAAE,CAAC;aACvB;iBAAM,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,iBAAiB,EAAE;gBACnD,IAAI,CAAC,YAAY,EAAE,CAAC;aACvB;iBAAM;gBACH,IAAI,CAAC,eAAe,EAAE,CAAC;aAC1B;YAED,IAAI,CAAC,sBAAsB,CAAC,OAAO,CAAC,sBAAsB,EAAE,IAAI,CAAC,kBAAkB,CAAC,CAAC;QACzF,CAAC,CAAC;QA/EE,IAAI,CAAC,mBAAmB,GAAG,IAAI,YAAY,EAAqB,CAAC;QACjE,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;QAEvB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;QAEvB,IAAI,CAAC,kBAAkB,GAAG;YACtB,eAAe,EAAE,KAAK;YACtB,8BAA8B,EAAE,KAAK;YACrC,iBAAiB,EAAE,KAAK;YACxB,0BAA0B,EAAE,KAAK;SACpC,CAAC;IACN,CAAC;IAED,QAAQ;QACJ,IAAI,CAAC,qBAAqB,GAAG,IAAI,CAAC,sBAAsB,CAAC,SAAS,CAC9D,MAAM,CAAC,YAAY,EACnB,GAAG,EAAE,CAAC,IAAI,CAAC,wBAAwB,EAAE,CACxC,CAAC;IACN,CAAC;IAED,WAAW;QACP,IAAI,CAAC,qBAAqB,EAAE,CAAC;IACjC,CAAC;IAmBM,QAAQ,CAAC,GAA6B;QACzC,IAAI,CAAC,uBAAuB,GAAG,GAAG,CAAC;QAEnC,IAAI,CAAC,uBAAuB,CAAC,WAAW,GAAG,CAAC,IAAI,EAAW,EAAE,CACzD,CAAC,IAAI,CAAC,kBAAkB,CAAC,eAAe,IAAI,IAAI,KAAK,IAAI,CAAC,UAAU,CAAC;IAC7E,CAAC;IAEM,iBAAiB,CAAC,UAAuB;QAC5C,IAAI,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC;IACrC,CAAC;IAEM,qBAAqB,CAAC,KAAwB;QACjD,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IACzC,CAAC;IAEM,SAAS;QACZ,OAAO,IAAI,CAAC,oBAAoB,CAAC,SAAS,EAAE,CAAC;IACjD,CAAC;IAuBa,wBAAwB;;YAClC,MAAM,cAAc,GAAG,MAAM,IAAI,CAAC,WAAW,CAAC,cAAc,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;YAChF,IAAI,CAAC,cAAc,EAAE;gBACjB,IAAI,CAAC,eAAe,EAAE,CAAC;aAC1B;QACL,CAAC;KAAA;IAEO,eAAe;QACnB,IAAI,CAAC,uBAAuB,CAAC,UAAU,CAAC;YACpC,IAAI,EAAE,iBAAiB,CAAC,OAAO;YAC/B,WAAW,EAAE,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,0CAA0C,CAAC;SACzF,CAAC,CAAC;QACH,IAAI,CAAC,uBAAuB,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;IACvD,CAAC;IAEO,YAAY;QAChB,IAAI,CAAC,uBAAuB,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC;IACxD,CAAC;IAGO,YAAY;QAChB,IAAI,CAAC,uBAAuB,CAAC,SAAS,EAAE,CAAC;QACzC,IAAI,CAAC,uBAAuB,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC;IACxD,CAAC;IAGO,eAAe;QACnB,IAAI,CAAC,uBAAuB,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC;IACvD,CAAC;CACJ,CAAA;AApIa;IAAT,MAAM,EAAE;8BAAsB,YAAY;8FAAoB;AAEtD;IAAR,KAAK,EAAE;;qFAAyB;AACxB;IAAR,KAAK,EAAE;;kFAAmB;AAClB;IAAR,KAAK,EAAE;;qFAAqB;AAG7B;IADC,SAAS,CAAC,6BAA6B,EAAE,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC;8BAC9B,6BAA6B;+FAAC;AARhE;IALC,oBAAoB,EAAE;IACtB,SAAS,CAAC;QACP,QAAQ,EAAE,+BAA+B;QACzC,QAAQ,EAAE,ksBAAksB;KAC/sB,CAAC;qCAkB2B,YAAY;QACR,eAAe;QACR,sBAAsB;QAC1B,mBAAmB;QACrB,gBAAgB;qDAgHjD\"}","dts":{"name":"/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/node_modules/.cache/rollup-plugin-typescript2/placeholder/components/synchronize/components/pageSynchronizationPanel/PageSynchronizationPanelComponent.d.ts","writeByteOrderMark":false,"text":"import { EventEmitter, OnDestroy, OnInit } from '@angular/core';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { ISynchronizationPanelApi, ISyncJob, ISyncStatus, ISyncStatusItem } from 'cmscommons';\r\nimport { HomepageService } from 'cmssmarteditcontainer/services';\r\nimport { CrossFrameEventService, IUriContext, TypedMap, IPageService, ICMSPage, ISyncPollingService } from 'smarteditcommons';\r\nexport declare class PageSynchronizationPanelComponent implements OnInit, OnDestroy {\r\n    private pageService;\r\n    private homepageService;\r\n    private crossFrameEventService;\r\n    private syncPollingService;\r\n    private translateService;\r\n    selectedItemsUpdate: EventEmitter<ISyncStatusItem[]>;\r\n    uriContext: IUriContext;\r\n    cmsPage: ICMSPage;\r\n    showFooter: boolean;\r\n    private synchronizationPanel;\r\n    private syncStatus;\r\n    private synchronizationPanelApi;\r\n    private pageSyncConditions;\r\n    private unSubPageUpdatedEvent;\r\n    constructor(pageService: IPageService, homepageService: HomepageService, crossFrameEventService: CrossFrameEventService, syncPollingService: ISyncPollingService, translateService: TranslateService);\r\n    ngOnInit(): void;\r\n    ngOnDestroy(): void;\r\n    getSyncStatus: () => Promise<ISyncStatus>;\r\n    performSync: (items: TypedMap<string>[]) => Promise<ISyncJob>;\r\n    onGetApi(api: ISynchronizationPanelApi): void;\r\n    onSyncStatusReady(syncStatus: ISyncStatus): void;\r\n    onSelectedItemsUpdate(items: ISyncStatusItem[]): void;\r\n    syncItems(): Promise<void>;\r\n    private syncStatusReady;\r\n    private evaluateIfSyncIsApproved;\r\n    private disablePageSync;\r\n    private hidePageSync;\r\n    private showPageSync;\r\n    private enableSlotsSync;\r\n}\r\n"}}
