{"code":"import { __awaiter, __decorate, __metadata, __param } from \"tslib\";\r\nimport { ChangeDetectorRef, Component, Inject } from '@angular/core';\r\nimport { CrossFrameEventService, SeDowngradeComponent, EVENT_OPEN_IN_PAGE_TREE, YJQUERY_TOKEN, LogService, EVENT_OVERALL_REFRESH_TREE_NODE, EVENT_PART_REFRESH_TREE_NODE } from 'smarteditcommons';\r\nimport { NodeInfoService, INTERVAL_RETRIES, INTERVAL_MILLISEC } from '../../../services/pageTree/NodeInfoService';\r\nwindow.__smartedit__.addDecoratorPayload(\"Component\", \"PageTreePanel\", {\r\n    selector: 'se-page-tree',\r\n    template: `<div class=\"se-page-tree\"><div class=\"se-page-tree--header\"><span class=\"se-page-tree--header--icon sap-icon--Chart-Tree-Map\"></span> <span class=\"se-page-tree--header--title\">{{ 'se.page.tree.title' | translate }}</span></div><div *ngFor=\"let node of slotNodes\"><se-page-tree-slot [node]=\"node\" (onSlotExpanded)=\"onSlotExpanded($event)\"></se-page-tree-slot></div></div>`,\r\n    styles: [`.se-page-tree{background:#fff;width:100%;height:100%;filter:drop-shadow(0 4px 4px rgba(0, 0, 0, .25));border-radius:4px;overflow-y:scroll}.se-page-tree::-webkit-scrollbar{display:none}.se-page-tree--header{height:48px;padding:0 12px;display:flex;align-items:center;box-shadow:0 1px 0 #dedede}.se-page-tree--header--icon{width:16px;height:18px;line-height:19px;font-size:16px;color:var(--sapContent_IconColor);text-align:center}.se-page-tree--header--title{font-family:\"72\";font-size:18px;line-height:21px;margin:0 10px;color:#595959}`]\r\n});\r\nlet /* @ngInject */ PageTreePanel = class /* @ngInject */ PageTreePanel {\r\n    constructor(crossFrameEventService, nodeInfoService, yjQuery, cdr, logService) {\r\n        this.crossFrameEventService = crossFrameEventService;\r\n        this.nodeInfoService = nodeInfoService;\r\n        this.yjQuery = yjQuery;\r\n        this.cdr = cdr;\r\n        this.logService = logService;\r\n        this.slotNodes = null;\r\n        this.scrollToNodeInterval = null;\r\n        this.expandComponentNodeInterval = null;\r\n        this.crossFrameEventService.subscribe(EVENT_OPEN_IN_PAGE_TREE, this.handleEventOpenInPageTree.bind(this));\r\n        this.crossFrameEventService.subscribe(EVENT_PART_REFRESH_TREE_NODE, (_eventId, eventData) => __awaiter(this, void 0, void 0, function* () { return (this.slotNodes = yield this.nodeInfoService.updatePartTreeNodesInfo(eventData)); }));\r\n        this.crossFrameEventService.subscribe(EVENT_OVERALL_REFRESH_TREE_NODE, () => __awaiter(this, void 0, void 0, function* () { return (this.slotNodes = yield this.nodeInfoService.buildNodesInfo()); }));\r\n    }\r\n    ngOnInit() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            this.slotNodes = yield this.nodeInfoService.buildNodesInfo();\r\n        });\r\n    }\r\n    onSlotExpanded(slot) {\r\n        this.slotNodes\r\n            .filter((node) => slot.elementUuid !== node.elementUuid)\r\n            .forEach((node) => {\r\n            node.isExpanded = false;\r\n            node.componentNodes.forEach((component) => (component.isExpanded = false));\r\n        });\r\n    }\r\n    handleEventOpenInPageTree(eventId, elementUuid) {\r\n        clearInterval(this.expandComponentNodeInterval);\r\n        if (!this.expandComponentNode(elementUuid)) {\r\n            let retries = 0;\r\n            this.expandComponentNodeInterval = setInterval(() => {\r\n                if (this.expandComponentNode(elementUuid)) {\r\n                    clearInterval(this.expandComponentNodeInterval);\r\n                }\r\n                if (retries > INTERVAL_RETRIES) {\r\n                    this.logService.error(`PageTreeComponent:: handleEventOpenInPageTree error: expand component node ${elementUuid} failed`);\r\n                    clearInterval(this.expandComponentNodeInterval);\r\n                }\r\n                retries++;\r\n            }, INTERVAL_MILLISEC);\r\n        }\r\n    }\r\n    expandComponentNode(elementUuid) {\r\n        if (this.slotNodes) {\r\n            this.slotNodes.forEach((slot) => {\r\n                let componentNode = null;\r\n                slot.componentNodes.forEach((component) => {\r\n                    if (component.elementUuid === elementUuid) {\r\n                        component.isExpanded = true;\r\n                        componentNode = component;\r\n                    }\r\n                    else {\r\n                        component.isExpanded = false;\r\n                    }\r\n                });\r\n                if (componentNode) {\r\n                    slot.isExpanded = true;\r\n                    this.scrollToNodeByInterval(componentNode.elementUuid);\r\n                }\r\n                else {\r\n                    slot.isExpanded = false;\r\n                }\r\n            });\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    scrollToNode(elementUuid) {\r\n        const element = this.yjQuery(`div[node-smartedit-element-uuid=\"${elementUuid}\"]`)\r\n            .get()\r\n            .shift();\r\n        if (element) {\r\n            element.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    scrollToNodeByInterval(elementUuid) {\r\n        clearInterval(this.scrollToNodeInterval);\r\n        if (!this.scrollToNode(elementUuid)) {\r\n            let retries = 0;\r\n            this.scrollToNodeInterval = setInterval(() => {\r\n                if (this.scrollToNode(elementUuid)) {\r\n                    clearInterval(this.scrollToNodeInterval);\r\n                }\r\n                if (retries > INTERVAL_RETRIES) {\r\n                    this.logService.error(`PageTreeComponent:: scrollToNodeByInterval error: scroll to tree node ${elementUuid} failed!`);\r\n                    clearInterval(this.scrollToNodeInterval);\r\n                }\r\n                retries++;\r\n            }, INTERVAL_MILLISEC);\r\n        }\r\n    }\r\n};\r\n/* @ngInject */ PageTreePanel = __decorate([\r\n    SeDowngradeComponent(),\r\n    Component({\r\n        selector: 'se-page-tree',\r\n        template: `<div class=\"se-page-tree\"><div class=\"se-page-tree--header\"><span class=\"se-page-tree--header--icon sap-icon--Chart-Tree-Map\"></span> <span class=\"se-page-tree--header--title\">{{ 'se.page.tree.title' | translate }}</span></div><div *ngFor=\"let node of slotNodes\"><se-page-tree-slot [node]=\"node\" (onSlotExpanded)=\"onSlotExpanded($event)\"></se-page-tree-slot></div></div>`,\r\n        styles: [`.se-page-tree{background:#fff;width:100%;height:100%;filter:drop-shadow(0 4px 4px rgba(0, 0, 0, .25));border-radius:4px;overflow-y:scroll}.se-page-tree::-webkit-scrollbar{display:none}.se-page-tree--header{height:48px;padding:0 12px;display:flex;align-items:center;box-shadow:0 1px 0 #dedede}.se-page-tree--header--icon{width:16px;height:18px;line-height:19px;font-size:16px;color:var(--sapContent_IconColor);text-align:center}.se-page-tree--header--title{font-family:\"72\";font-size:18px;line-height:21px;margin:0 10px;color:#595959}`]\r\n    }),\r\n    __param(2, Inject(YJQUERY_TOKEN)),\r\n    __metadata(\"design:paramtypes\", [CrossFrameEventService,\r\n        NodeInfoService, Function, ChangeDetectorRef,\r\n        LogService])\r\n], /* @ngInject */ PageTreePanel);\r\nexport { /* @ngInject */ PageTreePanel };\r\n//# sourceMappingURL=PageTreePanel.js.map","references":["/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular+core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/src/services/pageTree/NodeInfoService.ts"],"map":"{\"version\":3,\"file\":\"PageTreePanel.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/components/pageTree/PageTreePanel/PageTreePanel.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit-container/node_modules/.cache/rollup-plugin-typescript2/placeholder/components/pageTree/PageTreePanel/PageTreePanel.d.ts","writeByteOrderMark":false,"text":"/// <reference types=\"angular\" />\r\n/// <reference types=\"jquery\" />\r\nimport { ChangeDetectorRef, OnInit } from '@angular/core';\r\nimport { CrossFrameEventService, LogService } from 'smarteditcommons';\r\nimport { SlotNode, NodeInfoService } from '../../../services/pageTree/NodeInfoService';\r\nexport declare class PageTreePanel implements OnInit {\r\n    private readonly crossFrameEventService;\r\n    private readonly nodeInfoService;\r\n    private readonly yjQuery;\r\n    private readonly cdr;\r\n    private readonly logService;\r\n    private slotNodes;\r\n    private scrollToNodeInterval;\r\n    private expandComponentNodeInterval;\r\n    constructor(crossFrameEventService: CrossFrameEventService, nodeInfoService: NodeInfoService, yjQuery: JQueryStatic, cdr: ChangeDetectorRef, logService: LogService);\r\n    ngOnInit(): Promise<void>;\r\n    onSlotExpanded(slot: SlotNode): void;\r\n    handleEventOpenInPageTree(eventId: string, elementUuid: string): void;\r\n    private expandComponentNode;\r\n    private scrollToNode;\r\n    private scrollToNodeByInterval;\r\n}\r\n"}}
