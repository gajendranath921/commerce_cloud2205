{"code":"import { __awaiter, __decorate, __metadata } from \"tslib\";\r\nimport { Component, ChangeDetectionStrategy, ChangeDetectorRef } from '@angular/core';\r\nimport { DEFAULT_SYNCHRONIZATION_STATUSES, DEFAULT_SYNCHRONIZATION_POLLING } from 'cmscommons';\r\nimport { AbstractDecorator, CrossFrameEventService, ICatalogService, IPageInfoService, SeDecorator } from 'smarteditcommons';\r\nimport { SlotSynchronizationService } from '../../services/SlotSynchronizationService';\r\nwindow.__smartedit__.addDecoratorPayload(\"Component\", \"SyncIndicatorDecorator\", {\r\n    selector: 'sync-indicator',\r\n    template: `<div class=\"sync-indicator-decorator\" [ngClass]=\"syncStatus.status\" [attr.sync-status]=\"syncStatus.status\"><ng-content class=\"se-wrapper-data\"></ng-content></div>`,\r\n    changeDetection: ChangeDetectionStrategy.OnPush\r\n});\r\nlet /* @ngInject */ SyncIndicatorDecorator = class /* @ngInject */ SyncIndicatorDecorator extends AbstractDecorator {\r\n    constructor(catalogService, slotSynchronizationService, crossFrameEventService, pageInfoService, cdr) {\r\n        super();\r\n        this.catalogService = catalogService;\r\n        this.slotSynchronizationService = slotSynchronizationService;\r\n        this.crossFrameEventService = crossFrameEventService;\r\n        this.pageInfoService = pageInfoService;\r\n        this.cdr = cdr;\r\n        this.isVersionNonActive = false;\r\n        this.syncStatus = {\r\n            status: DEFAULT_SYNCHRONIZATION_STATUSES.UNAVAILABLE\r\n        };\r\n    }\r\n    ngOnInit() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            yield Promise.all([this.getPageUuid(), this.getIsVersionNonActive()]);\r\n            if (this.isVersionNonActive) {\r\n                yield this.fetchSyncStatus();\r\n            }\r\n            this.unRegisterSyncPolling = this.crossFrameEventService.subscribe(DEFAULT_SYNCHRONIZATION_POLLING.FAST_FETCH, () => __awaiter(this, void 0, void 0, function* () {\r\n                yield this.fetchSyncStatus();\r\n                if (!this.cdr.destroyed) {\r\n                    this.cdr.detectChanges();\r\n                }\r\n            }));\r\n            if (!this.cdr.destroyed) {\r\n                this.cdr.detectChanges();\r\n            }\r\n        });\r\n    }\r\n    ngOnDestroy() {\r\n        if (this.unRegisterSyncPolling) {\r\n            this.unRegisterSyncPolling();\r\n        }\r\n    }\r\n    getPageUuid() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            this.pageUUID = yield this.pageInfoService.getPageUUID();\r\n        });\r\n    }\r\n    getIsVersionNonActive() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            this.isVersionNonActive = yield this.catalogService.isContentCatalogVersionNonActive();\r\n        });\r\n    }\r\n    fetchSyncStatus() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this.isVersionNonActive) {\r\n                return;\r\n            }\r\n            try {\r\n                const syncStatus = yield this.slotSynchronizationService.getSyncStatus(this.pageUUID, this.componentAttributes.smarteditComponentId);\r\n                if (this.slotSynchronizationService.syncStatusExists(syncStatus)) {\r\n                    this.syncStatus = syncStatus;\r\n                }\r\n            }\r\n            catch (_a) {\r\n                this.syncStatus.status = DEFAULT_SYNCHRONIZATION_STATUSES.UNAVAILABLE;\r\n            }\r\n        });\r\n    }\r\n};\r\n/* @ngInject */ SyncIndicatorDecorator = __decorate([\r\n    SeDecorator(),\r\n    Component({\r\n        selector: 'sync-indicator',\r\n        template: `<div class=\"sync-indicator-decorator\" [ngClass]=\"syncStatus.status\" [attr.sync-status]=\"syncStatus.status\"><ng-content class=\"se-wrapper-data\"></ng-content></div>`,\r\n        changeDetection: ChangeDetectionStrategy.OnPush\r\n    }),\r\n    __metadata(\"design:paramtypes\", [ICatalogService,\r\n        SlotSynchronizationService,\r\n        CrossFrameEventService,\r\n        IPageInfoService,\r\n        ChangeDetectorRef])\r\n], /* @ngInject */ SyncIndicatorDecorator);\r\nexport { /* @ngInject */ SyncIndicatorDecorator };\r\n//# sourceMappingURL=SyncIndicatorDecorator.js.map","references":["/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular+core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-commons/dist/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit/src/services/SlotSynchronizationService.ts"],"map":"{\"version\":3,\"file\":\"SyncIndicatorDecorator.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/components/synchronize/SyncIndicatorDecorator.ts\"],\"names\":[],\"mappings\":\";AACA,OAAO,EAAE,SAAS,EAAE,uBAAuB,EAAE,iBAAiB,EAAW,MAAM,eAAe,CAAC;AAC/F,OAAO,EACH,gCAAgC,EAChC,+BAA+B,EAElC,MAAM,YAAY,CAAC;AACpB,OAAO,EACH,iBAAiB,EACjB,sBAAsB,EACtB,eAAe,EACf,gBAAgB,EAChB,WAAW,EACd,MAAM,kBAAkB,CAAC;AAC1B,OAAO,EAAE,0BAA0B,EAAE,MAAM,2CAA2C,CAAC;gFAG5E;IACP,QAAQ,EAAE,gBAAgB;IAC1B,QAAQ,EAAE,oKAAoK;IAC9K,eAAe,EAAE,uBAAuB,CAAC,MAAM;CAClD;AACD,6CAAA,4CAAoC,SAAQ,iBAAiB;IAOzD,YACY,cAA+B,EAC/B,0BAAsD,EACtD,sBAA8C,EAC9C,eAAiC,EACjC,GAAsB;QAE9B,KAAK,EAAE,CAAC;QANA,mBAAc,GAAd,cAAc,CAAiB;QAC/B,+BAA0B,GAA1B,0BAA0B,CAA4B;QACtD,2BAAsB,GAAtB,sBAAsB,CAAwB;QAC9C,oBAAe,GAAf,eAAe,CAAkB;QACjC,QAAG,GAAH,GAAG,CAAmB;QAI9B,IAAI,CAAC,kBAAkB,GAAG,KAAK,CAAC;QAChC,IAAI,CAAC,UAAU,GAAG;YACd,MAAM,EAAE,gCAAgC,CAAC,WAAW;SACxC,CAAC;IACrB,CAAC;IAEK,QAAQ;;YACV,MAAM,OAAO,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,WAAW,EAAE,EAAE,IAAI,CAAC,qBAAqB,EAAE,CAAC,CAAC,CAAC;YAEtE,IAAI,IAAI,CAAC,kBAAkB,EAAE;gBACzB,MAAM,IAAI,CAAC,eAAe,EAAE,CAAC;aAChC;YAED,IAAI,CAAC,qBAAqB,GAAG,IAAI,CAAC,sBAAsB,CAAC,SAAS,CAC9D,+BAA+B,CAAC,UAAU,EAC1C,GAAS,EAAE;gBACP,MAAM,IAAI,CAAC,eAAe,EAAE,CAAC;gBAC7B,IAAI,CAAE,IAAI,CAAC,GAAe,CAAC,SAAS,EAAE;oBAClC,IAAI,CAAC,GAAG,CAAC,aAAa,EAAE,CAAC;iBAC5B;YACL,CAAC,CAAA,CACJ,CAAC;YAEF,IAAI,CAAE,IAAI,CAAC,GAAe,CAAC,SAAS,EAAE;gBAClC,IAAI,CAAC,GAAG,CAAC,aAAa,EAAE,CAAC;aAC5B;QACL,CAAC;KAAA;IAED,WAAW;QACP,IAAI,IAAI,CAAC,qBAAqB,EAAE;YAC5B,IAAI,CAAC,qBAAqB,EAAE,CAAC;SAChC;IACL,CAAC;IAEa,WAAW;;YACrB,IAAI,CAAC,QAAQ,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,WAAW,EAAE,CAAC;QAC7D,CAAC;KAAA;IAEa,qBAAqB;;YAC/B,IAAI,CAAC,kBAAkB,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC,gCAAgC,EAAE,CAAC;QAC3F,CAAC;KAAA;IAEa,eAAe;;YACzB,IAAI,CAAC,IAAI,CAAC,kBAAkB,EAAE;gBAC1B,OAAO;aACV;YACD,IAAI;gBACA,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,0BAA0B,CAAC,aAAa,CAClE,IAAI,CAAC,QAAQ,EACb,IAAI,CAAC,mBAAmB,CAAC,oBAAoB,CAChD,CAAC;gBACF,IAAI,IAAI,CAAC,0BAA0B,CAAC,gBAAgB,CAAC,UAAU,CAAC,EAAE;oBAC9D,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;iBAChC;aACJ;YAAC,WAAM;gBACJ,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,gCAAgC,CAAC,WAAW,CAAC;aACzE;QACL,CAAC;KAAA;CACJ,CAAA;AA1ED;IANC,WAAW,EAAE;IACb,SAAS,CAAC;QACP,QAAQ,EAAE,gBAAgB;QAC1B,QAAQ,EAAE,oKAAoK;QAC9K,eAAe,EAAE,uBAAuB,CAAC,MAAM;KAClD,CAAC;qCAS8B,eAAe;QACH,0BAA0B;QAC9B,sBAAsB;QAC7B,gBAAgB;QAC5B,iBAAiB;0CA8DrC\"}","dts":{"name":"/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/cmssmartedit/apps/cms-smartedit/node_modules/.cache/rollup-plugin-typescript2/placeholder/components/synchronize/SyncIndicatorDecorator.d.ts","writeByteOrderMark":false,"text":"import { ChangeDetectorRef } from '@angular/core';\r\nimport { ISyncStatus } from 'cmscommons';\r\nimport { AbstractDecorator, CrossFrameEventService, ICatalogService, IPageInfoService } from 'smarteditcommons';\r\nimport { SlotSynchronizationService } from '../../services/SlotSynchronizationService';\r\nexport declare class SyncIndicatorDecorator extends AbstractDecorator {\r\n    private catalogService;\r\n    private slotSynchronizationService;\r\n    private crossFrameEventService;\r\n    private pageInfoService;\r\n    private cdr;\r\n    pageUUID: string;\r\n    syncStatus: ISyncStatus;\r\n    isVersionNonActive: boolean;\r\n    private unRegisterSyncPolling;\r\n    constructor(catalogService: ICatalogService, slotSynchronizationService: SlotSynchronizationService, crossFrameEventService: CrossFrameEventService, pageInfoService: IPageInfoService, cdr: ChangeDetectorRef);\r\n    ngOnInit(): Promise<void>;\r\n    ngOnDestroy(): void;\r\n    private getPageUuid;\r\n    private getIsVersionNonActive;\r\n    private fetchSyncStatus;\r\n}\r\n"}}
