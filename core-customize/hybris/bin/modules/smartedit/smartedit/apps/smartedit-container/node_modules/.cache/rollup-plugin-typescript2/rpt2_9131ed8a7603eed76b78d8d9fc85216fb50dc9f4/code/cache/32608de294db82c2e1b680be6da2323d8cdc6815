{"code":"import { __decorate, __metadata } from \"tslib\";\r\n/*\r\n * Copyright (c) 2022 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { Injectable } from '@angular/core';\r\nimport * as lodash from 'lodash';\r\nimport { CryptographicUtils, FingerPrintingService, GatewayProxied, IStorageService, LogService, SeDowngradeService, WindowUtils } from 'smarteditcommons';\r\n/** @internal */\r\nlet /* @ngInject */ StorageService = class /* @ngInject */ StorageService extends IStorageService {\r\n    constructor(logService, windowUtils, cryptographicUtils, fingerPrintingService) {\r\n        super();\r\n        this.logService = logService;\r\n        this.windowUtils = windowUtils;\r\n        this.cryptographicUtils = cryptographicUtils;\r\n        this.fingerPrintingService = fingerPrintingService;\r\n        this.SMARTEDIT_SESSIONS = 'smartedit-sessions';\r\n        this.CUSTOM_PROPERTIES = 'custom_properties';\r\n    }\r\n    isInitialized() {\r\n        const sessions = this.getAuthTokens();\r\n        return Promise.resolve(lodash.values(lodash.omit(sessions, [this.CUSTOM_PROPERTIES])).length > 0);\r\n    }\r\n    storeAuthToken(authURI, auth) {\r\n        const sessions = this.getAuthTokens();\r\n        sessions[authURI] = auth;\r\n        this._setSmarteditSessions(sessions);\r\n        return Promise.resolve();\r\n    }\r\n    getAuthToken(authURI) {\r\n        const sessions = this.getAuthTokens();\r\n        return Promise.resolve(sessions[authURI]);\r\n    }\r\n    removeAuthToken(authURI) {\r\n        const sessions = this.getAuthTokens();\r\n        delete sessions[authURI];\r\n        this._setSmarteditSessions(sessions);\r\n        return Promise.resolve();\r\n    }\r\n    removeAllAuthTokens() {\r\n        this._removeAllAuthTokens();\r\n        return Promise.resolve();\r\n    }\r\n    getValueFromCookie(cookieName, isEncoded) {\r\n        throw new Error('getValueFromCookie deprecated since 1905, use getValueFromLocalStorage');\r\n    }\r\n    getValueFromLocalStorage(cookieName, isEncoded) {\r\n        return Promise.resolve(this._getValueFromLocalStorage(cookieName, isEncoded));\r\n    }\r\n    getAuthTokens() {\r\n        const smarteditSessions = this.windowUtils\r\n            .getWindow()\r\n            .localStorage.getItem(this.SMARTEDIT_SESSIONS);\r\n        let authTokens;\r\n        if (smarteditSessions) {\r\n            try {\r\n                const decrypted = this.cryptographicUtils.aesDecrypt(smarteditSessions, this.fingerPrintingService.getFingerprint());\r\n                authTokens = JSON.parse(decodeURIComponent(escape(decrypted)));\r\n            }\r\n            catch (_a) {\r\n                // failed to decrypt token. may occur if fingerprint changed.\r\n                this.logService.info('Failed to read authentication token. Forcing a re-authentication.');\r\n            }\r\n        }\r\n        return authTokens || {};\r\n    }\r\n    putValueInCookie(cookieName, value, encode) {\r\n        throw new Error('putValueInCookie deprecated since 1905, use setValueInLocalStorage');\r\n    }\r\n    setValueInLocalStorage(cookieName, value, encode) {\r\n        return Promise.resolve(this._setValueInLocalStorage(cookieName, value, encode));\r\n    }\r\n    setItem(key, value) {\r\n        const sessions = this.getAuthTokens();\r\n        sessions[this.CUSTOM_PROPERTIES] = sessions[this.CUSTOM_PROPERTIES] || {};\r\n        sessions[this.CUSTOM_PROPERTIES][key] = value;\r\n        this._setSmarteditSessions(sessions);\r\n        return Promise.resolve();\r\n    }\r\n    getItem(key) {\r\n        const sessions = this.getAuthTokens();\r\n        sessions[this.CUSTOM_PROPERTIES] = sessions[this.CUSTOM_PROPERTIES] || {};\r\n        return Promise.resolve(sessions[this.CUSTOM_PROPERTIES][key]);\r\n    }\r\n    _removeAllAuthTokens() {\r\n        const sessions = this.getAuthTokens();\r\n        const newSessions = lodash.pick(sessions, [this.CUSTOM_PROPERTIES]);\r\n        this._setSmarteditSessions(newSessions);\r\n    }\r\n    _getValueFromLocalStorage(cookieName, isEncoded) {\r\n        const rawValue = this.windowUtils.getWindow().localStorage.getItem(cookieName);\r\n        let value = null;\r\n        if (rawValue) {\r\n            try {\r\n                value = JSON.parse(isEncoded ? decodeURIComponent(escape(window.atob(rawValue))) : rawValue);\r\n            }\r\n            catch (e) {\r\n                // protecting against deserialization issue\r\n                this.logService.error('Failed during deserialization ', e);\r\n            }\r\n        }\r\n        return value;\r\n    }\r\n    _setSmarteditSessions(sessions) {\r\n        const sessionsJSONString = btoa(unescape(encodeURIComponent(JSON.stringify(sessions))));\r\n        const sessionsEncrypted = this.cryptographicUtils.aesBase64Encrypt(sessionsJSONString, this.fingerPrintingService.getFingerprint());\r\n        this.windowUtils\r\n            .getWindow()\r\n            .localStorage.setItem(this.SMARTEDIT_SESSIONS, sessionsEncrypted);\r\n    }\r\n    _setValueInLocalStorage(cookieName, value, encode) {\r\n        let processedValue = JSON.stringify(value);\r\n        processedValue = encode\r\n            ? btoa(unescape(encodeURIComponent(processedValue)))\r\n            : processedValue;\r\n        this.windowUtils.getWindow().localStorage.setItem(cookieName, processedValue);\r\n    }\r\n};\r\n/* @ngInject */ StorageService = __decorate([\r\n    SeDowngradeService(IStorageService),\r\n    GatewayProxied('isInitialized', 'storeAuthToken', 'getAuthToken', 'removeAuthToken', 'removeAllAuthTokens', 'storePrincipalIdentifier', 'getPrincipalIdentifier', 'removePrincipalIdentifier', 'getValueFromCookie', 'getValueFromLocalStorage'),\r\n    Injectable(),\r\n    __metadata(\"design:paramtypes\", [LogService,\r\n        WindowUtils,\r\n        CryptographicUtils,\r\n        FingerPrintingService])\r\n], /* @ngInject */ StorageService);\r\nexport { /* @ngInject */ StorageService };\r\n//# sourceMappingURL=StorageServiceOuter.js.map","references":["/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular+core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@types+lodash@4.14.159/node_modules/@types/lodash/ts3.1/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts"],"map":"{\"version\":3,\"file\":\"StorageServiceOuter.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/services/StorageServiceOuter.ts\"],\"names\":[],\"mappings\":\";AAAA;;GAEG;AACH,OAAO,EAAE,UAAU,EAAE,MAAM,eAAe,CAAC;AAC3C,OAAO,KAAK,MAAM,MAAM,QAAQ,CAAC;AACjC,OAAO,EACH,kBAAkB,EAClB,qBAAqB,EACrB,cAAc,EAEd,eAAe,EACf,UAAU,EACV,kBAAkB,EAClB,WAAW,EACd,MAAM,kBAAkB,CAAC;AAK1B,gBAAgB;AAehB,qCAAA,oCAA4B,SAAQ,eAAe;IAI/C,YACY,UAAsB,EACtB,WAAwB,EACxB,kBAAsC,EACtC,qBAA4C;QAEpD,KAAK,EAAE,CAAC;QALA,eAAU,GAAV,UAAU,CAAY;QACtB,gBAAW,GAAX,WAAW,CAAa;QACxB,uBAAkB,GAAlB,kBAAkB,CAAoB;QACtC,0BAAqB,GAArB,qBAAqB,CAAuB;QAPhD,uBAAkB,GAAG,oBAAoB,CAAC;QAC1C,sBAAiB,GAAG,mBAAmB,CAAC;IAShD,CAAC;IAED,aAAa;QACT,MAAM,QAAQ,GAAiB,IAAI,CAAC,aAAa,EAAE,CAAC;QACpD,OAAO,OAAO,CAAC,OAAO,CAClB,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC,MAAM,GAAG,CAAC,CAC5E,CAAC;IACN,CAAC;IAED,cAAc,CAAC,OAAe,EAAE,IAAgB;QAC5C,MAAM,QAAQ,GAAiB,IAAI,CAAC,aAAa,EAAE,CAAC;QACpD,QAAQ,CAAC,OAAO,CAAC,GAAG,IAAI,CAAC;QACzB,IAAI,CAAC,qBAAqB,CAAC,QAAQ,CAAC,CAAC;QACrC,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC;IAC7B,CAAC;IAED,YAAY,CAAC,OAAe;QACxB,MAAM,QAAQ,GAAiB,IAAI,CAAC,aAAa,EAAE,CAAC;QACpD,OAAO,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC;IAC9C,CAAC;IAED,eAAe,CAAC,OAAe;QAC3B,MAAM,QAAQ,GAAiB,IAAI,CAAC,aAAa,EAAE,CAAC;QACpD,OAAO,QAAQ,CAAC,OAAO,CAAC,CAAC;QACzB,IAAI,CAAC,qBAAqB,CAAC,QAAQ,CAAC,CAAC;QACrC,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC;IAC7B,CAAC;IAED,mBAAmB;QACf,IAAI,CAAC,oBAAoB,EAAE,CAAC;QAC5B,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC;IAC7B,CAAC;IAED,kBAAkB,CAAC,UAAkB,EAAE,SAAkB;QACrD,MAAM,IAAI,KAAK,CAAC,wEAAwE,CAAC,CAAC;IAC9F,CAAC;IAED,wBAAwB,CAAC,UAAkB,EAAE,SAAkB;QAC3D,OAAO,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,yBAAyB,CAAC,UAAU,EAAE,SAAS,CAAC,CAAC,CAAC;IAClF,CAAC;IAED,aAAa;QACT,MAAM,iBAAiB,GAAG,IAAI,CAAC,WAAW;aACrC,SAAS,EAAE;aACX,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;QACnD,IAAI,UAAwB,CAAC;QAC7B,IAAI,iBAAiB,EAAE;YACnB,IAAI;gBACA,MAAM,SAAS,GAAG,IAAI,CAAC,kBAAkB,CAAC,UAAU,CAChD,iBAAiB,EACjB,IAAI,CAAC,qBAAqB,CAAC,cAAc,EAAE,CAC9C,CAAC;gBACF,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,kBAAkB,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;aAClE;YAAC,WAAM;gBACJ,6DAA6D;gBAC7D,IAAI,CAAC,UAAU,CAAC,IAAI,CAChB,mEAAmE,CACtE,CAAC;aACL;SACJ;QACD,OAAO,UAAU,IAAI,EAAE,CAAC;IAC5B,CAAC;IAED,gBAAgB,CAAC,UAAkB,EAAE,KAAU,EAAE,MAAe;QAC5D,MAAM,IAAI,KAAK,CAAC,oEAAoE,CAAC,CAAC;IAC1F,CAAC;IAED,sBAAsB,CAAC,UAAkB,EAAE,KAAU,EAAE,MAAe;QAClE,OAAO,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,uBAAuB,CAAC,UAAU,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC,CAAC;IACpF,CAAC;IAED,OAAO,CAAC,GAAW,EAAE,KAAU;QAC3B,MAAM,QAAQ,GAAG,IAAI,CAAC,aAAa,EAAE,CAAC;QACtC,QAAQ,CAAC,IAAI,CAAC,iBAAiB,CAAC,GAAG,QAAQ,CAAC,IAAI,CAAC,iBAAiB,CAAC,IAAI,EAAE,CAAC;QAC1E,QAAQ,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;QAC9C,IAAI,CAAC,qBAAqB,CAAC,QAAQ,CAAC,CAAC;QACrC,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC;IAC7B,CAAC;IAED,OAAO,CAAC,GAAW;QACf,MAAM,QAAQ,GAAG,IAAI,CAAC,aAAa,EAAE,CAAC;QACtC,QAAQ,CAAC,IAAI,CAAC,iBAAiB,CAAC,GAAG,QAAQ,CAAC,IAAI,CAAC,iBAAiB,CAAC,IAAI,EAAE,CAAC;QAC1E,OAAO,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;IAClE,CAAC;IAEO,oBAAoB;QACxB,MAAM,QAAQ,GAAiB,IAAI,CAAC,aAAa,EAAE,CAAC;QACpD,MAAM,WAAW,GAAG,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC;QACpE,IAAI,CAAC,qBAAqB,CAAC,WAAW,CAAC,CAAC;IAC5C,CAAC;IAEO,yBAAyB,CAAC,UAAkB,EAAE,SAAkB;QACpE,MAAM,QAAQ,GAAW,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC,YAAY,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;QACvF,IAAI,KAAK,GAAG,IAAI,CAAC;QACjB,IAAI,QAAQ,EAAE;YACV,IAAI;gBACA,KAAK,GAAG,IAAI,CAAC,KAAK,CACd,SAAS,CAAC,CAAC,CAAC,kBAAkB,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQ,CAC3E,CAAC;aACL;YAAC,OAAO,CAAC,EAAE;gBACR,2CAA2C;gBAC3C,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,gCAAgC,EAAE,CAAC,CAAC,CAAC;aAC9D;SACJ;QACD,OAAO,KAAK,CAAC;IACjB,CAAC;IAEO,qBAAqB,CAAC,QAAsB;QAChD,MAAM,kBAAkB,GAAG,IAAI,CAAC,QAAQ,CAAC,kBAAkB,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;QACxF,MAAM,iBAAiB,GAAG,IAAI,CAAC,kBAAkB,CAAC,gBAAgB,CAC9D,kBAAkB,EAClB,IAAI,CAAC,qBAAqB,CAAC,cAAc,EAAE,CAC9C,CAAC;QACF,IAAI,CAAC,WAAW;aACX,SAAS,EAAE;aACX,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,kBAAkB,EAAE,iBAAiB,CAAC,CAAC;IAC1E,CAAC;IAEO,uBAAuB,CAAC,UAAkB,EAAE,KAAU,EAAE,MAAe;QAC3E,IAAI,cAAc,GAAW,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;QACnD,cAAc,GAAG,MAAM;YACnB,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,kBAAkB,CAAC,cAAc,CAAC,CAAC,CAAC;YACpD,CAAC,CAAC,cAAc,CAAC;QACrB,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC,YAAY,CAAC,OAAO,CAAC,UAAU,EAAE,cAAc,CAAC,CAAC;IAClF,CAAC;CACJ,CAAA;AAxID;IAdC,kBAAkB,CAAC,eAAe,CAAC;IACnC,cAAc,CACX,eAAe,EACf,gBAAgB,EAChB,cAAc,EACd,iBAAiB,EACjB,qBAAqB,EACrB,0BAA0B,EAC1B,wBAAwB,EACxB,2BAA2B,EAC3B,oBAAoB,EACpB,0BAA0B,CAC7B;IACA,UAAU,EAAE;qCAMe,UAAU;QACT,WAAW;QACJ,kBAAkB;QACf,qBAAqB;kCAgI3D\"}","dts":{"name":"/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-container/node_modules/.cache/rollup-plugin-typescript2/placeholder/services/StorageServiceOuter.d.ts","writeByteOrderMark":false,"text":"import { CryptographicUtils, FingerPrintingService, IAuthToken, IStorageService, LogService, WindowUtils } from 'smarteditcommons';\r\nexport interface ISessionAuth {\r\n    [index: string]: IAuthToken | any;\r\n}\r\n/** @internal */\r\nexport declare class StorageService extends IStorageService {\r\n    private logService;\r\n    private windowUtils;\r\n    private cryptographicUtils;\r\n    private fingerPrintingService;\r\n    private SMARTEDIT_SESSIONS;\r\n    private CUSTOM_PROPERTIES;\r\n    constructor(logService: LogService, windowUtils: WindowUtils, cryptographicUtils: CryptographicUtils, fingerPrintingService: FingerPrintingService);\r\n    isInitialized(): Promise<boolean>;\r\n    storeAuthToken(authURI: string, auth: IAuthToken): Promise<void>;\r\n    getAuthToken(authURI: string): Promise<IAuthToken>;\r\n    removeAuthToken(authURI: string): Promise<void>;\r\n    removeAllAuthTokens(): Promise<void>;\r\n    getValueFromCookie(cookieName: string, isEncoded: boolean): Promise<any>;\r\n    getValueFromLocalStorage(cookieName: string, isEncoded: boolean): Promise<any>;\r\n    getAuthTokens(): ISessionAuth;\r\n    putValueInCookie(cookieName: string, value: any, encode: boolean): void;\r\n    setValueInLocalStorage(cookieName: string, value: any, encode: boolean): Promise<void>;\r\n    setItem(key: string, value: any): Promise<void>;\r\n    getItem(key: string): Promise<any>;\r\n    private _removeAllAuthTokens;\r\n    private _getValueFromLocalStorage;\r\n    private _setSmarteditSessions;\r\n    private _setValueInLocalStorage;\r\n}\r\n"}}
