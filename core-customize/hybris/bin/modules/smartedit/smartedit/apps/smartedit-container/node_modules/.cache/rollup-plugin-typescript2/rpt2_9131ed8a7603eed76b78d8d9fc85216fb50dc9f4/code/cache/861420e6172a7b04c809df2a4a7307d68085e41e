{"code":"import { __awaiter, __decorate, __metadata, __param } from \"tslib\";\r\nimport './ExperienceSelectorButtonComponent.scss';\r\nimport { DatePipe } from '@angular/common';\r\nimport { Component, Inject, LOCALE_ID } from '@angular/core';\r\nimport moment from 'moment';\r\nimport { take } from 'rxjs/operators';\r\nimport { CrossFrameEventService, DATE_CONSTANTS, EVENTS, ISharedDataService, SeDowngradeComponent, SystemEventService, EXPERIENCE_STORAGE_KEY, L10nPipe } from 'smarteditcommons';\r\nwindow.__smartedit__.addDecoratorPayload(\"Component\", \"ExperienceSelectorButtonComponent\", {\r\n    selector: 'se-experience-selector-button',\r\n    template: `<fd-popover class=\"se-experience-selector\" [(isOpen)]=\"status.isOpen\" (isOpenChange)=\"resetExperienceSelector()\" [closeOnOutsideClick]=\"false\" [triggers]=\"['click']\" [placement]=\"'bottom-end'\"><fd-popover-control><div class=\"se-experience-selector__control\"><se-tooltip [placement]=\"'bottom'\" [triggers]=\"['mouseenter', 'mouseleave']\" *ngIf=\"isCurrentPageFromParent\" class=\"se-experience-selector__tooltip\"><span se-tooltip-trigger class=\"se-experience-selector__btn--globe\"><span class=\"hyicon hyicon-globe se-experience-selector__btn--globe--icon\"></span></span><div se-tooltip-body>{{ parentCatalogVersion }}</div></se-tooltip><button class=\"se-experience-selector__btn\" id=\"experience-selector-btn\"><span [attr.title]=\"experienceText\" class=\"se-experience-selector__btn-text se-nowrap-ellipsis\">{{ experienceText }} </span><span class=\"se-experience-selector__btn-arrow icon-navigation-down-arrow\"></span></button></div></fd-popover-control><fd-popover-body><div class=\"se-experience-selector__dropdown fd-modal fd-modal__content\" role=\"menu\"><se-experience-selector [experience]=\"experience\" [dropdownStatus]=\"status\" [(resetExperienceSelector)]=\"resetExperienceSelector\"></se-experience-selector></div></fd-popover-body></fd-popover>`,\r\n    providers: [L10nPipe]\r\n});\r\nlet /* @ngInject */ ExperienceSelectorButtonComponent = class /* @ngInject */ ExperienceSelectorButtonComponent {\r\n    constructor(systemEventService, crossFrameEventService, locale, sharedDataService, l10nPipe) {\r\n        this.systemEventService = systemEventService;\r\n        this.crossFrameEventService = crossFrameEventService;\r\n        this.locale = locale;\r\n        this.sharedDataService = sharedDataService;\r\n        this.l10nPipe = l10nPipe;\r\n        this.status = { isOpen: false };\r\n        this.isCurrentPageFromParent = false;\r\n    }\r\n    ngOnInit() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            yield this.updateExperience();\r\n            yield this.setExperienceText();\r\n            this.unregFn = this.systemEventService.subscribe(EVENTS.EXPERIENCE_UPDATE, () => __awaiter(this, void 0, void 0, function* () {\r\n                yield this.updateExperience();\r\n                yield this.setExperienceText();\r\n            }));\r\n            this.unRegNewPageContextEventFn = this.crossFrameEventService.subscribe(EVENTS.PAGE_CHANGE, (eventId, data) => {\r\n                this.setPageFromParent(data);\r\n            });\r\n        });\r\n    }\r\n    ngOnDestroy() {\r\n        this.unregFn();\r\n        this.unRegNewPageContextEventFn();\r\n    }\r\n    updateExperience() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            this.experience = (yield this.sharedDataService.get(EXPERIENCE_STORAGE_KEY));\r\n        });\r\n    }\r\n    setPageFromParent(data) {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const { pageContext: { catalogName, catalogVersion, catalogVersionUuid: pageContextCatalogVersionUuid }, catalogDescriptor: { catalogVersionUuid: catalogDescriptorCatalogVersionUuid } } = data;\r\n            const translatedName = yield this.l10nPipe.transform(catalogName).pipe(take(1)).toPromise();\r\n            this.parentCatalogVersion = `${translatedName} (${catalogVersion})`;\r\n            this.isCurrentPageFromParent =\r\n                catalogDescriptorCatalogVersionUuid !== pageContextCatalogVersionUuid;\r\n        });\r\n    }\r\n    setExperienceText() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            if (!this.experience) {\r\n                this.experienceText = '';\r\n            }\r\n            const { catalogDescriptor: { name, catalogVersion }, languageDescriptor: { nativeName }, time } = this.experience;\r\n            const pipe = new DatePipe(this.locale);\r\n            const transformedTime = time\r\n                ? `  |  ${pipe.transform(moment(time).isValid() ? time : moment.now(), DATE_CONSTANTS.ANGULAR_SHORT)}`\r\n                : '';\r\n            const [translatedName, catalogVersions] = yield Promise.all([\r\n                this.l10nPipe.transform(name).pipe(take(1)).toPromise(),\r\n                this.getProductCatalogVersionTextByUuids()\r\n            ]);\r\n            this.experienceText = `${translatedName} - ${catalogVersion}  |  ${nativeName}${transformedTime}${catalogVersions}`;\r\n        });\r\n    }\r\n    getProductCatalogVersionTextByUuids() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const { productCatalogVersions } = this.experience;\r\n            const SEPARATOR = '';\r\n            const versionPromises = productCatalogVersions.map(({ catalogName, catalogVersion }) => __awaiter(this, void 0, void 0, function* () {\r\n                const translatedName = yield this.l10nPipe\r\n                    .transform(catalogName)\r\n                    .pipe(take(1))\r\n                    .toPromise();\r\n                return `${translatedName} (${catalogVersion})`;\r\n            }));\r\n            const versions = yield Promise.all(versionPromises);\r\n            return [SEPARATOR].concat(versions).join(' | ');\r\n        });\r\n    }\r\n};\r\n/* @ngInject */ ExperienceSelectorButtonComponent = __decorate([\r\n    SeDowngradeComponent(),\r\n    Component({\r\n        selector: 'se-experience-selector-button',\r\n        template: `<fd-popover class=\"se-experience-selector\" [(isOpen)]=\"status.isOpen\" (isOpenChange)=\"resetExperienceSelector()\" [closeOnOutsideClick]=\"false\" [triggers]=\"['click']\" [placement]=\"'bottom-end'\"><fd-popover-control><div class=\"se-experience-selector__control\"><se-tooltip [placement]=\"'bottom'\" [triggers]=\"['mouseenter', 'mouseleave']\" *ngIf=\"isCurrentPageFromParent\" class=\"se-experience-selector__tooltip\"><span se-tooltip-trigger class=\"se-experience-selector__btn--globe\"><span class=\"hyicon hyicon-globe se-experience-selector__btn--globe--icon\"></span></span><div se-tooltip-body>{{ parentCatalogVersion }}</div></se-tooltip><button class=\"se-experience-selector__btn\" id=\"experience-selector-btn\"><span [attr.title]=\"experienceText\" class=\"se-experience-selector__btn-text se-nowrap-ellipsis\">{{ experienceText }} </span><span class=\"se-experience-selector__btn-arrow icon-navigation-down-arrow\"></span></button></div></fd-popover-control><fd-popover-body><div class=\"se-experience-selector__dropdown fd-modal fd-modal__content\" role=\"menu\"><se-experience-selector [experience]=\"experience\" [dropdownStatus]=\"status\" [(resetExperienceSelector)]=\"resetExperienceSelector\"></se-experience-selector></div></fd-popover-body></fd-popover>`,\r\n        providers: [L10nPipe]\r\n    }),\r\n    __param(2, Inject(LOCALE_ID)),\r\n    __metadata(\"design:paramtypes\", [SystemEventService,\r\n        CrossFrameEventService, String, ISharedDataService,\r\n        L10nPipe])\r\n], /* @ngInject */ ExperienceSelectorButtonComponent);\r\nexport { /* @ngInject */ ExperienceSelectorButtonComponent };\r\n//# sourceMappingURL=ExperienceSelectorButtonComponent.js.map","references":["/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular+common@8.2.14_@angular+core@8.2.14+rxjs@6.5.4/node_modules/@angular/common/common.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular+core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/moment@2.29.4/node_modules/moment/ts3.1-typings/moment.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/rxjs@6.5.4/node_modules/rxjs/operators/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts"],"map":"{\"version\":3,\"file\":\"ExperienceSelectorButtonComponent.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/services/ExperienceSelectorButtonComponent/ExperienceSelectorButtonComponent.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-container/node_modules/.cache/rollup-plugin-typescript2/placeholder/services/ExperienceSelectorButtonComponent/ExperienceSelectorButtonComponent.d.ts","writeByteOrderMark":false,"text":"import './ExperienceSelectorButtonComponent.scss';\r\nimport { OnDestroy, OnInit } from '@angular/core';\r\nimport { CrossFrameEventService, IExperience, ISharedDataService, SystemEventService, L10nPipe } from 'smarteditcommons';\r\nexport declare class ExperienceSelectorButtonComponent implements OnInit, OnDestroy {\r\n    private systemEventService;\r\n    private crossFrameEventService;\r\n    private locale;\r\n    private sharedDataService;\r\n    private l10nPipe;\r\n    resetExperienceSelector: () => void;\r\n    status: {\r\n        isOpen: boolean;\r\n    };\r\n    isCurrentPageFromParent: boolean;\r\n    parentCatalogVersion: string;\r\n    experience: IExperience;\r\n    experienceText: string;\r\n    private unregFn;\r\n    private unRegNewPageContextEventFn;\r\n    constructor(systemEventService: SystemEventService, crossFrameEventService: CrossFrameEventService, locale: string, sharedDataService: ISharedDataService, l10nPipe: L10nPipe);\r\n    ngOnInit(): Promise<void>;\r\n    ngOnDestroy(): void;\r\n    updateExperience(): Promise<void>;\r\n    setPageFromParent(data: IExperience): Promise<void>;\r\n    private setExperienceText;\r\n    private getProductCatalogVersionTextByUuids;\r\n}\r\n"}}
