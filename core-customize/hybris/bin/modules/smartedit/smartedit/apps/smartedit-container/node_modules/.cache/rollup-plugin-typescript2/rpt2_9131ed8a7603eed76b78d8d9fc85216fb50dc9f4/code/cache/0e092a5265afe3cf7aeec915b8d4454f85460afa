{"code":"import { __decorate, __metadata, __param } from \"tslib\";\r\n/*\r\n * Copyright (c) 2022 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { Inject } from '@angular/core';\r\nimport * as lo from 'lodash';\r\nimport { CrossFrameEventService, DRAG_AND_DROP_CROSS_ORIGIN_BEFORE_TIME, IDragAndDropCrossOrigin, SeDowngradeService, SEND_MOUSE_POSITION_THROTTLE, SMARTEDIT_DRAG_AND_DROP_EVENTS, SMARTEDIT_IFRAME_DRAG_AREA, YJQUERY_TOKEN } from 'smarteditcommons';\r\nimport { IframeManagerService } from './iframe/IframeManagerService';\r\n/**\r\n * Polyfill for HTML5 Drag and Drop in a cross-origin setup.\r\n * Most browsers (except Firefox) do not allow on-page drag-and-drop from non-same-origin frames.\r\n * This service is a polyfill to allow it, by listening the 'dragover' event over a sibling <div> of the iframe and sending the mouse position to the inner frame.\r\n * The inner frame 'DragAndDropCrossOriginInner' will use document.elementFromPoint (or isPointOverElement helper function for IE only) to determine the current hovered element and then dispatch drag events onto elligible droppable elements.\r\n *\r\n * More information about security restrictions:\r\n * https://bugs.chromium.org/p/chromium/issues/detail?id=251718\r\n * https://bugs.chromium.org/p/chromium/issues/detail?id=59081\r\n * https://www.infosecurity-magazine.com/news/new-google-chrome-clickjacking-vulnerability/\r\n * https://bugzilla.mozilla.org/show_bug.cgi?id=605991\r\n */\r\n/** @internal */\r\nlet /* @ngInject */ DragAndDropCrossOrigin = class /* @ngInject */ DragAndDropCrossOrigin extends IDragAndDropCrossOrigin {\r\n    constructor(yjQuery, crossFrameEventService, iframeManagerService) {\r\n        super();\r\n        this.yjQuery = yjQuery;\r\n        this.crossFrameEventService = crossFrameEventService;\r\n        this.iframeManagerService = iframeManagerService;\r\n        this.onDragStart = () => {\r\n            if (!this.isEnabled()) {\r\n                return;\r\n            }\r\n            this.crossFrameEventService.publish(SMARTEDIT_DRAG_AND_DROP_EVENTS.DRAG_DROP_CROSS_ORIGIN_START);\r\n            this.syncIframeDragArea()\r\n                .show()\r\n                .off('dragover') // `off()` is necessary since dragEnd event is not always fired.\r\n                .on('dragover', (e) => {\r\n                e.preventDefault(); // `preventDefault()` is necessary for the 'drop' event callback to be fired.\r\n                const mousePosition = this.getPositionRelativeToIframe(e.pageX, e.pageY);\r\n                this.throttledSendMousePosition(mousePosition);\r\n                return false;\r\n            })\r\n                .off('drop')\r\n                .on('drop', (e) => {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                const mousePosition = this.getPositionRelativeToIframe(e.pageX, e.pageY);\r\n                this.crossFrameEventService.publish(SMARTEDIT_DRAG_AND_DROP_EVENTS.DROP_ELEMENT, mousePosition);\r\n                return false;\r\n            });\r\n        };\r\n        this.onDragEnd = () => {\r\n            if (!this.isEnabled()) {\r\n                return;\r\n            }\r\n            this.getIframeDragArea().off('dragover').off('drop').hide();\r\n        };\r\n        this.sendMousePosition = (mousePosition) => {\r\n            this.crossFrameEventService.publish(SMARTEDIT_DRAG_AND_DROP_EVENTS.TRACK_MOUSE_POSITION, mousePosition);\r\n        };\r\n    }\r\n    initialize() {\r\n        this.throttledSendMousePosition = lo.throttle(this.sendMousePosition, SEND_MOUSE_POSITION_THROTTLE);\r\n        this.crossFrameEventService.subscribe(SMARTEDIT_DRAG_AND_DROP_EVENTS.DRAG_DROP_START, this.onDragStart);\r\n        this.crossFrameEventService.subscribe(SMARTEDIT_DRAG_AND_DROP_EVENTS.DRAG_DROP_END, this.onDragEnd);\r\n        this.crossFrameEventService.subscribe(DRAG_AND_DROP_CROSS_ORIGIN_BEFORE_TIME.START, () => {\r\n            if (this.isEnabled()) {\r\n                this.iframeManagerService.getIframe().css('pointer-events', 'none');\r\n            }\r\n        });\r\n        this.crossFrameEventService.subscribe(DRAG_AND_DROP_CROSS_ORIGIN_BEFORE_TIME.END, () => {\r\n            if (this.isEnabled()) {\r\n                this.iframeManagerService.getIframe().css('pointer-events', 'auto');\r\n            }\r\n        });\r\n    }\r\n    isEnabled() {\r\n        return this.iframeManagerService.isCrossOrigin();\r\n    }\r\n    getIframeDragArea() {\r\n        return this.yjQuery('#' + SMARTEDIT_IFRAME_DRAG_AREA);\r\n    }\r\n    getPositionRelativeToIframe(posX, posY) {\r\n        const iframeOffset = this.getIframeDragArea().offset();\r\n        return {\r\n            x: posX - iframeOffset.left,\r\n            y: posY - iframeOffset.top\r\n        };\r\n    }\r\n    syncIframeDragArea() {\r\n        this.getIframeDragArea().width(this.iframeManagerService.getIframe().width());\r\n        this.getIframeDragArea().height(this.iframeManagerService.getIframe().height());\r\n        const iframeOffset = this.iframeManagerService.getIframe().offset();\r\n        this.getIframeDragArea().css({\r\n            top: iframeOffset.top,\r\n            left: iframeOffset.left\r\n        });\r\n        return this.getIframeDragArea();\r\n    }\r\n};\r\n/* @ngInject */ DragAndDropCrossOrigin = __decorate([\r\n    SeDowngradeService(IDragAndDropCrossOrigin),\r\n    __param(0, Inject(YJQUERY_TOKEN)),\r\n    __metadata(\"design:paramtypes\", [Function, CrossFrameEventService,\r\n        IframeManagerService])\r\n], /* @ngInject */ DragAndDropCrossOrigin);\r\nexport { /* @ngInject */ DragAndDropCrossOrigin };\r\n//# sourceMappingURL=DragAndDropCrossOriginOuter.js.map","references":["/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular+core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@types+lodash@4.14.159/node_modules/@types/lodash/ts3.1/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-container/src/services/iframe/IframeManagerService.ts"],"map":"{\"version\":3,\"file\":\"DragAndDropCrossOriginOuter.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/services/DragAndDropCrossOriginOuter.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-container/node_modules/.cache/rollup-plugin-typescript2/placeholder/services/DragAndDropCrossOriginOuter.d.ts","writeByteOrderMark":false,"text":"/// <reference types=\"angular\" />\r\n/// <reference types=\"jquery\" />\r\nimport { CrossFrameEventService, IDragAndDropCrossOrigin } from 'smarteditcommons';\r\nimport { IframeManagerService } from './iframe/IframeManagerService';\r\n/**\r\n * Polyfill for HTML5 Drag and Drop in a cross-origin setup.\r\n * Most browsers (except Firefox) do not allow on-page drag-and-drop from non-same-origin frames.\r\n * This service is a polyfill to allow it, by listening the 'dragover' event over a sibling <div> of the iframe and sending the mouse position to the inner frame.\r\n * The inner frame 'DragAndDropCrossOriginInner' will use document.elementFromPoint (or isPointOverElement helper function for IE only) to determine the current hovered element and then dispatch drag events onto elligible droppable elements.\r\n *\r\n * More information about security restrictions:\r\n * https://bugs.chromium.org/p/chromium/issues/detail?id=251718\r\n * https://bugs.chromium.org/p/chromium/issues/detail?id=59081\r\n * https://www.infosecurity-magazine.com/news/new-google-chrome-clickjacking-vulnerability/\r\n * https://bugzilla.mozilla.org/show_bug.cgi?id=605991\r\n */\r\n/** @internal */\r\nexport declare class DragAndDropCrossOrigin extends IDragAndDropCrossOrigin {\r\n    private yjQuery;\r\n    private crossFrameEventService;\r\n    private iframeManagerService;\r\n    private throttledSendMousePosition;\r\n    constructor(yjQuery: JQueryStatic, crossFrameEventService: CrossFrameEventService, iframeManagerService: IframeManagerService);\r\n    initialize(): void;\r\n    private isEnabled;\r\n    private onDragStart;\r\n    private onDragEnd;\r\n    private sendMousePosition;\r\n    private getIframeDragArea;\r\n    private getPositionRelativeToIframe;\r\n    private syncIframeDragArea;\r\n}\r\n"}}
