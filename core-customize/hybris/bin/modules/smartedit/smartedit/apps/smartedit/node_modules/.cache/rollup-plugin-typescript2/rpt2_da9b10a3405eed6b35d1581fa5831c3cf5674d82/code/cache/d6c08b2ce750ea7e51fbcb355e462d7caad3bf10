{"code":"var /* @ngInject */ PageInfoService_1;\r\nimport { __awaiter, __decorate, __metadata, __param } from \"tslib\";\r\n/*\r\n * Copyright (c) 2022 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { Inject } from '@angular/core';\r\nimport { Cached, GatewayProxied, IPageInfoService, IRestServiceFactory, LogService, pageChangeEvictionTag, rarelyChangingContent, SeDowngradeService, YJQUERY_TOKEN } from 'smarteditcommons';\r\n/** @internal */\r\nlet /* @ngInject */ PageInfoService = /* @ngInject */ PageInfoService_1 = class /* @ngInject */ PageInfoService extends IPageInfoService {\r\n    /* @internal */\r\n    constructor(yjQuery, restServiceFactory, logService) {\r\n        super();\r\n        this.yjQuery = yjQuery;\r\n        this.restServiceFactory = restServiceFactory;\r\n        this.logService = logService;\r\n        this.pageTemplateRestService = restServiceFactory.get('/cmswebservices/v1/pagetemplate');\r\n    }\r\n    /**\r\n     * When the time comes to deprecate these 3 functions from componentHandlerService in the inner app, we will need\r\n     * to migrate their implementations to here.\r\n     */\r\n    getPageUID() {\r\n        return this.try(() => this.getBodyClassAttributeByRegEx(/* @ngInject */ PageInfoService_1.PATTERN_SMARTEDIT_PAGE_UID));\r\n    }\r\n    getPageUUID() {\r\n        return this.try(() => this.getBodyClassAttributeByRegEx(/* @ngInject */ PageInfoService_1.PATTERN_SMARTEDIT_PAGE_UUID));\r\n    }\r\n    getCatalogVersionUUIDFromPage() {\r\n        return this.try(() => this.getBodyClassAttributeByRegEx(/* @ngInject */ PageInfoService_1.PATTERN_SMARTEDIT_CATALOG_VERSION_UUID));\r\n    }\r\n    // eslint-disable-next-line @typescript-eslint/member-ordering\r\n    isSameCatalogVersionOfPageAndPageTemplate() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            const pageUuid = yield this.getPageUUID();\r\n            const pageCatalogVersion = yield this.getCatalogVersionUUIDFromPage();\r\n            const params = {\r\n                pageUuid\r\n            };\r\n            const pageTemplate = yield this.pageTemplateRestService.get(params);\r\n            return pageCatalogVersion === pageTemplate.catalogVersion;\r\n        });\r\n    }\r\n    /**\r\n     * @param pattern Pattern of class names to search for\r\n     *\r\n     * @returns  Class attributes from the body element of the storefront\r\n     */\r\n    getBodyClassAttributeByRegEx(pattern) {\r\n        try {\r\n            const bodyClass = this.yjQuery('body').attr('class');\r\n            return pattern.exec(bodyClass)[1];\r\n        }\r\n        catch (_a) {\r\n            throw {\r\n                name: 'InvalidStorefrontPageError',\r\n                message: 'Error: the page is not a valid storefront page.'\r\n            };\r\n        }\r\n    }\r\n    /** @internal */\r\n    try(func) {\r\n        try {\r\n            return Promise.resolve(func());\r\n        }\r\n        catch (e) {\r\n            this.logService.warn('Missing SmartEdit attributes on body element of the storefront - SmartEdit will resume once the attributes are added');\r\n            return Promise.reject(e);\r\n        }\r\n    }\r\n};\r\n/* @ngInject */ PageInfoService.PATTERN_SMARTEDIT_CATALOG_VERSION_UUID = /smartedit-catalog-version-uuid\\-(\\S+)/;\r\n/* @ngInject */ PageInfoService.PATTERN_SMARTEDIT_PAGE_UID = /smartedit-page-uid\\-(\\S+)/;\r\n/* @ngInject */ PageInfoService.PATTERN_SMARTEDIT_PAGE_UUID = /smartedit-page-uuid\\-(\\S+)/;\r\n__decorate([\r\n    Cached({ actions: [rarelyChangingContent], tags: [pageChangeEvictionTag] }),\r\n    __metadata(\"design:type\", Function),\r\n    __metadata(\"design:paramtypes\", []),\r\n    __metadata(\"design:returntype\", Promise)\r\n], /* @ngInject */ PageInfoService.prototype, \"isSameCatalogVersionOfPageAndPageTemplate\", null);\r\n/* @ngInject */ PageInfoService = /* @ngInject */ PageInfoService_1 = __decorate([\r\n    SeDowngradeService(IPageInfoService),\r\n    GatewayProxied('getPageUID', 'getPageUUID', 'getCatalogVersionUUIDFromPage', 'isSameCatalogVersionOfPageAndPageTemplate'),\r\n    __param(0, Inject(YJQUERY_TOKEN)),\r\n    __metadata(\"design:paramtypes\", [Function, IRestServiceFactory,\r\n        LogService])\r\n], /* @ngInject */ PageInfoService);\r\nexport { /* @ngInject */ PageInfoService };\r\n//# sourceMappingURL=PageInfoServiceInner.js.map","references":["/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular+core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts"],"map":"{\"version\":3,\"file\":\"PageInfoServiceInner.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/services/PageInfoServiceInner.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit/node_modules/.cache/rollup-plugin-typescript2/placeholder/services/PageInfoServiceInner.d.ts","writeByteOrderMark":false,"text":"/// <reference types=\"angular\" />\r\n/// <reference types=\"jquery\" />\r\nimport { IPageInfoService, IRestServiceFactory, LogService } from 'smarteditcommons';\r\n/** @internal */\r\nexport declare class PageInfoService extends IPageInfoService {\r\n    private readonly yjQuery;\r\n    private readonly restServiceFactory;\r\n    private readonly logService;\r\n    static PATTERN_SMARTEDIT_CATALOG_VERSION_UUID: RegExp;\r\n    private static PATTERN_SMARTEDIT_PAGE_UID;\r\n    private static PATTERN_SMARTEDIT_PAGE_UUID;\r\n    private readonly pageTemplateRestService;\r\n    constructor(yjQuery: JQueryStatic, restServiceFactory: IRestServiceFactory, logService: LogService);\r\n    /**\r\n     * When the time comes to deprecate these 3 functions from componentHandlerService in the inner app, we will need\r\n     * to migrate their implementations to here.\r\n     */\r\n    getPageUID(): Promise<string>;\r\n    getPageUUID(): Promise<string>;\r\n    getCatalogVersionUUIDFromPage(): Promise<string>;\r\n    isSameCatalogVersionOfPageAndPageTemplate(): Promise<boolean>;\r\n    /**\r\n     * @param pattern Pattern of class names to search for\r\n     *\r\n     * @returns  Class attributes from the body element of the storefront\r\n     */\r\n    getBodyClassAttributeByRegEx(pattern: RegExp): string;\r\n    /** @internal */\r\n    try(func: () => string): Promise<string>;\r\n}\r\n"}}
