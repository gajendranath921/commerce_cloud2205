{"code":"import { __decorate, __metadata, __param } from \"tslib\";\r\n/*\r\n * Copyright (c) 2022 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { DOCUMENT } from '@angular/common';\r\nimport { Inject } from '@angular/core';\r\nimport { CrossFrameEventService, DragAndDropScrollingService, InViewElementObserver, IDragAndDropCrossOrigin, IDragEventType, PolyfillService, SeDowngradeService, SMARTEDIT_DRAG_AND_DROP_EVENTS, SMARTEDIT_ELEMENT_HOVERED, YJQUERY_TOKEN } from 'smarteditcommons';\r\n/** @internal */\r\nlet /* @ngInject */ DragAndDropCrossOrigin = class /* @ngInject */ DragAndDropCrossOrigin extends IDragAndDropCrossOrigin {\r\n    constructor(document, yjQuery, crossFrameEventService, inViewElementObserver, dragAndDropScrollingService, polyfillService) {\r\n        super();\r\n        this.document = document;\r\n        this.yjQuery = yjQuery;\r\n        this.crossFrameEventService = crossFrameEventService;\r\n        this.inViewElementObserver = inViewElementObserver;\r\n        this.dragAndDropScrollingService = dragAndDropScrollingService;\r\n        this.polyfillService = polyfillService;\r\n        this.onDnDCrossOriginStart = (eventId) => {\r\n            this.dragAndDropScrollingService.toggleThrottling(this.polyfillService.isEligibleForThrottledScrolling());\r\n        };\r\n        this.onTrackMouseInner = (eventId, eventData) => {\r\n            if (this.isSearchingElement) {\r\n                return;\r\n            }\r\n            this.isSearchingElement = true;\r\n            /**\r\n             * Get the element from mouse position.\r\n             * In IE11, document.elementFromPoint returns null because of the #ySmartEditFrameDragArea positioned over the iframe and has pointer-events (necessary to listen on 'dragover' to track the mouse position).\r\n             * To polyfill document.elementFromPoint in IE11 in this scenario, we call isPointOverElement() on each elligible droppable element.\r\n             *\r\n             * Note: in IE11, a switch of pointer-events value to none for the #ySmartEditFrameDragArea will return a value when calling $document.elementFromPoint, BUT it is causing cursor flickering and too much latency. The 'isPointOverElement' approach give better results.\r\n             */\r\n            this.currentElementHovered = this.yjQuery(this.inViewElementObserver.elementFromPoint(eventData));\r\n            const mousePositionInPage = this.getMousePositionInPage(eventData);\r\n            if (this.lastElementHovered && this.lastElementHovered.length) {\r\n                if ((this.currentElementHovered.length &&\r\n                    this.lastElementHovered[0] !== this.currentElementHovered[0]) ||\r\n                    !this.currentElementHovered.length) {\r\n                    this.dispatchDragEvent(this.lastElementHovered[0], IDragEventType.DRAG_LEAVE, mousePositionInPage);\r\n                    this.lastElementHovered.data(SMARTEDIT_ELEMENT_HOVERED, false);\r\n                }\r\n            }\r\n            if (this.currentElementHovered.length) {\r\n                if (!this.currentElementHovered.data(SMARTEDIT_ELEMENT_HOVERED)) {\r\n                    this.dispatchDragEvent(this.currentElementHovered[0], IDragEventType.DRAG_ENTER, mousePositionInPage);\r\n                    this.currentElementHovered.data(SMARTEDIT_ELEMENT_HOVERED, true);\r\n                }\r\n                this.dispatchDragEvent(this.currentElementHovered[0], IDragEventType.DRAG_OVER, mousePositionInPage);\r\n            }\r\n            this.lastElementHovered = this.currentElementHovered;\r\n            this.isSearchingElement = false;\r\n        };\r\n        this.onDropElementInner = (eventId, mousePosition) => {\r\n            if (this.currentElementHovered.length) {\r\n                this.currentElementHovered.data(SMARTEDIT_ELEMENT_HOVERED, false);\r\n                this.dispatchDragEvent(this.currentElementHovered[0], IDragEventType.DROP, mousePosition);\r\n                this.dispatchDragEvent(this.currentElementHovered[0], IDragEventType.DRAG_LEAVE, mousePosition);\r\n            }\r\n        };\r\n    }\r\n    initialize() {\r\n        this.crossFrameEventService.subscribe(SMARTEDIT_DRAG_AND_DROP_EVENTS.TRACK_MOUSE_POSITION, this.onTrackMouseInner.bind(this));\r\n        this.crossFrameEventService.subscribe(SMARTEDIT_DRAG_AND_DROP_EVENTS.DROP_ELEMENT, this.onDropElementInner.bind(this));\r\n        this.crossFrameEventService.subscribe(SMARTEDIT_DRAG_AND_DROP_EVENTS.DRAG_DROP_CROSS_ORIGIN_START, this.onDnDCrossOriginStart.bind(this));\r\n    }\r\n    dispatchDragEvent(element, type, mousePosition) {\r\n        const evt = this.document.createEvent('CustomEvent');\r\n        evt.initCustomEvent(type, true, true, null);\r\n        evt.dataTransfer = {\r\n            data: {},\r\n            // eslint-disable-next-line @typescript-eslint/ban-types\r\n            setData(_type, val) {\r\n                this.data[_type] = val;\r\n            },\r\n            getData(_type) {\r\n                return this.data[_type];\r\n            }\r\n        };\r\n        evt.pageX = mousePosition.x;\r\n        evt.pageY = mousePosition.y;\r\n        element.dispatchEvent(evt);\r\n    }\r\n    getMousePositionInPage(mousePosition) {\r\n        const scrollingElement = this.yjQuery(this.document.scrollingElement || this.document.documentElement);\r\n        return {\r\n            x: mousePosition.x + scrollingElement.scrollLeft(),\r\n            y: mousePosition.y + scrollingElement.scrollTop()\r\n        };\r\n    }\r\n};\r\n/* @ngInject */ DragAndDropCrossOrigin = __decorate([\r\n    SeDowngradeService(IDragAndDropCrossOrigin),\r\n    __param(0, Inject(DOCUMENT)),\r\n    __param(1, Inject(YJQUERY_TOKEN)),\r\n    __metadata(\"design:paramtypes\", [Document, Function, CrossFrameEventService,\r\n        InViewElementObserver,\r\n        DragAndDropScrollingService,\r\n        PolyfillService])\r\n], /* @ngInject */ DragAndDropCrossOrigin);\r\nexport { /* @ngInject */ DragAndDropCrossOrigin };\r\n//# sourceMappingURL=DragAndDropCrossOriginInner.js.map","references":["/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular+common@8.2.14_@angular+core@8.2.14+rxjs@6.5.4/node_modules/@angular/common/common.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular+core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts"],"map":"{\"version\":3,\"file\":\"DragAndDropCrossOriginInner.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/services/DragAndDropCrossOriginInner.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit/node_modules/.cache/rollup-plugin-typescript2/placeholder/services/DragAndDropCrossOriginInner.d.ts","writeByteOrderMark":false,"text":"/// <reference types=\"angular\" />\r\n/// <reference types=\"jquery\" />\r\nimport { CrossFrameEventService, DragAndDropScrollingService, InViewElementObserver, IDragAndDropCrossOrigin, PolyfillService } from 'smarteditcommons';\r\n/** @internal */\r\nexport declare class DragAndDropCrossOrigin extends IDragAndDropCrossOrigin {\r\n    private document;\r\n    private yjQuery;\r\n    private crossFrameEventService;\r\n    private inViewElementObserver;\r\n    private dragAndDropScrollingService;\r\n    private polyfillService;\r\n    private currentElementHovered;\r\n    private lastElementHovered;\r\n    private isSearchingElement;\r\n    constructor(document: Document, yjQuery: JQueryStatic, crossFrameEventService: CrossFrameEventService, inViewElementObserver: InViewElementObserver, dragAndDropScrollingService: DragAndDropScrollingService, polyfillService: PolyfillService);\r\n    initialize(): void;\r\n    private onDnDCrossOriginStart;\r\n    private onTrackMouseInner;\r\n    private onDropElementInner;\r\n    private dispatchDragEvent;\r\n    private getMousePositionInPage;\r\n}\r\n"}}
