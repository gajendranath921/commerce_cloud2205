{"code":"/*\r\n * Copyright (c) 2022 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\n/* eslint-disable max-classes-per-file */\r\n/*\r\n * Copyright (c) 2020 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\n/* tslint:disable:max-classes-per-file */\r\nimport { __decorate, __metadata } from \"tslib\";\r\nimport { Injectable } from '@angular/core';\r\nimport { UpgradeModule } from '@angular/upgrade/static';\r\nimport * as lodash from 'lodash';\r\nimport { promiseUtils, AbstractAngularJSBasedCustomElement, ELEMENT_UUID_ATTRIBUTE, ID_ATTRIBUTE, ILegacyDecoratorToCustomElementConverter, NodeUtils, SeDowngradeService } from 'smarteditcommons';\r\nconst CONTENT_PLACEHOLDER = 'CONTENT_PLACEHOLDER';\r\nconst scopes = [];\r\nfunction angularJSDecoratorCustomElementClassFactory(upgrade, nodeUtils, componentName) {\r\n    return class extends AbstractAngularJSBasedCustomElement {\r\n        /**\r\n         * Avoid changing anything (no DOM changes) to the custom element in the constructor (Safari throw NotSupportedError).\r\n         */\r\n        constructor() {\r\n            super(upgrade);\r\n            // this.attachShadow({mode: 'open'});\r\n        }\r\n        static get observedAttributes() {\r\n            return ['active'];\r\n        }\r\n        internalConnectedCallback() {\r\n            this.markAsProcessed();\r\n            let componentAttributes;\r\n            try {\r\n                componentAttributes = nodeUtils.collectSmarteditAttributesByElementUuid(this.getAttribute(ELEMENT_UUID_ATTRIBUTE));\r\n            }\r\n            catch (e) {\r\n                // the original component may have disappeared in the meantime\r\n                return;\r\n            }\r\n            /* compile should only happen in one layer,\r\n             * other layers will iteratively be compiled by their own custom element\r\n             * these layers are therefore to be removed before compilation\r\n             */\r\n            this.content =\r\n                this.content ||\r\n                    Array.from(this.childNodes).find((childNode) => childNode.nodeType === Node.ELEMENT_NODE);\r\n            // const computedStyle = window.getComputedStyle(this.content);\r\n            const placeholder = document.createElement(CONTENT_PLACEHOLDER);\r\n            // placeholder.style.width = computedStyle.width + \"px\";\r\n            // placeholder.style.height = computedStyle.height + \"px\";\r\n            // placeholder.style.minHeight = \"49px\";\r\n            // placeholder.style.minWidth = \"51px\";\r\n            while (this.firstChild) {\r\n                this.removeChild(this.firstChild);\r\n            }\r\n            this.appendChild(placeholder);\r\n            const actualActiveState = this.getAttribute('active') === 'true';\r\n            this.setAttribute('active', 'active');\r\n            // compile should only happen in one layer\r\n            this.scope = this.$rootScope.$new(false);\r\n            scopes.push(this.scopeIdentifier);\r\n            this.scope.active = actualActiveState;\r\n            this.scope.componentAttributes = componentAttributes;\r\n            const compiledClone = this.$compile(this)(this.scope)[0];\r\n            // const style = document.createElement('style');\r\n            // style.innerHTML = `\r\n            // \t\t:host {\r\n            // \t\t\tdisplay: block;\r\n            // \t\t}`;\r\n            // this.shadowRoot.appendChild(style);\r\n            // reappending content after potentially asynchronous compilation\r\n            /*\r\n             * When using templateUrl, rendering is asynchronous\r\n             * we need wait until the place holder is transcluded before continuing\r\n             */\r\n            promiseUtils.waitOnCondition(() => !!compiledClone.querySelector(CONTENT_PLACEHOLDER), () => {\r\n                compiledClone.querySelector(CONTENT_PLACEHOLDER).replaceWith(this.content);\r\n                // this.shadowRoot.append(compiledClone);\r\n            }, `decorator ${componentName} doesn't seem to contain contain an ng-transclude statement`);\r\n        }\r\n        internalAttributeChangedCallback(name, oldValue, newValue) {\r\n            /*\r\n             * attributes don't change in the case of decorators:\r\n             * - they come from the shallow clone itself\r\n             * - only active flag changes but because of the full rewrapping it goes through constructor\r\n             */\r\n            this.scope.active = newValue === 'true';\r\n        }\r\n        internalDisconnectedCallback() {\r\n            scopes.splice(scopes.indexOf(this.scopeIdentifier), 1);\r\n        }\r\n        get scopeIdentifier() {\r\n            return `${this.getAttribute(ID_ATTRIBUTE)}_${this.tagName}`;\r\n        }\r\n    };\r\n}\r\nlet /* @ngInject */ LegacyDecoratorToCustomElementConverter = class /* @ngInject */ LegacyDecoratorToCustomElementConverter {\r\n    constructor(upgrade, nodeUtils) {\r\n        this.upgrade = upgrade;\r\n        this.nodeUtils = nodeUtils;\r\n        this.convertedDecorators = [];\r\n    }\r\n    // for e2e purposes\r\n    getScopes() {\r\n        return scopes;\r\n    }\r\n    /*\r\n     * Decorators are first class components:\r\n     * even though they are built hierarchically, they are independant on one another and their scope should not be chained.\r\n     * As a consequence, compiling them seperately is not an issue and thus enables converting them\r\n     * to custom elements.\r\n     */\r\n    convert(_componentName) {\r\n        const componentName = _componentName.replace('se.', '');\r\n        const originalName = lodash.kebabCase(componentName);\r\n        if (!customElements.get(originalName)) {\r\n            // may already have been defined through DI\r\n            const CustomComponentClass = angularJSDecoratorCustomElementClassFactory(this.upgrade, this.nodeUtils, componentName);\r\n            customElements.define(originalName, CustomComponentClass);\r\n        }\r\n    }\r\n    convertIfNeeded(componentNames) {\r\n        componentNames.forEach((componentName) => {\r\n            if (this.convertedDecorators.indexOf(componentName) === -1) {\r\n                this.convertedDecorators.push(componentName);\r\n                this.convert(componentName);\r\n            }\r\n        });\r\n    }\r\n};\r\n/* @ngInject */ LegacyDecoratorToCustomElementConverter = __decorate([\r\n    SeDowngradeService(ILegacyDecoratorToCustomElementConverter),\r\n    Injectable(),\r\n    __metadata(\"design:paramtypes\", [UpgradeModule, NodeUtils])\r\n], /* @ngInject */ LegacyDecoratorToCustomElementConverter);\r\nexport { /* @ngInject */ LegacyDecoratorToCustomElementConverter };\r\n//# sourceMappingURL=LegacyDecoratorToCustomElementConverter.js.map","references":["/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular+core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular+upgrade@8.2.14_d2ff5303d1bb22207cb4aaa9bb380a83/node_modules/@angular/upgrade/static.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@types+lodash@4.14.159/node_modules/@types/lodash/ts3.1/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts"],"map":"{\"version\":3,\"file\":\"LegacyDecoratorToCustomElementConverter.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/services/sakExecutor/LegacyDecoratorToCustomElementConverter.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit/node_modules/.cache/rollup-plugin-typescript2/placeholder/services/sakExecutor/LegacyDecoratorToCustomElementConverter.d.ts","writeByteOrderMark":false,"text":"import { UpgradeModule } from '@angular/upgrade/static';\r\nimport { ILegacyDecoratorToCustomElementConverter, NodeUtils } from 'smarteditcommons';\r\nexport declare class LegacyDecoratorToCustomElementConverter implements ILegacyDecoratorToCustomElementConverter {\r\n    private upgrade;\r\n    private nodeUtils;\r\n    private convertedDecorators;\r\n    constructor(upgrade: UpgradeModule, nodeUtils: NodeUtils);\r\n    getScopes(): string[];\r\n    convert(_componentName: string): void;\r\n    convertIfNeeded(componentNames: string[]): void;\r\n}\r\n"}}
