{"code":"import { __decorate, __metadata, __param } from \"tslib\";\r\n/*\r\n * Copyright (c) 2022 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { Inject } from '@angular/core';\r\nimport * as lodash from 'lodash';\r\nimport { functionsUtils, nodeUtils, CONTRACT_CHANGE_LISTENER_COMPONENT_PROCESS_STATUS, CONTRACT_CHANGE_LISTENER_PROCESS_EVENTS, ID_ATTRIBUTE, IPageInfoService, IPositionRegistry, IResizeListener, ISmartEditContractChangeListener, JQueryUtilsService, LogService, MUTATION_TYPES, PolyfillService, SeDowngradeService, SystemEventService, SMARTEDIT_COMPONENT_PROCESS_STATUS, TestModeService, TYPE_ATTRIBUTE, UUID_ATTRIBUTE, YJQUERY_TOKEN, ComponentHandlerService, IPageTreeNodeService } from 'smarteditcommons';\r\nvar COMPONENT_STATE;\r\n(function (COMPONENT_STATE) {\r\n    COMPONENT_STATE[\"ADDED\"] = \"added\";\r\n    COMPONENT_STATE[\"DESTROYED\"] = \"destroyed\";\r\n})(COMPONENT_STATE || (COMPONENT_STATE = {}));\r\n/*\r\n * interval at which manual listening/checks are executed\r\n * So far it is only by repositionListener\r\n * (resizeListener delegates to a self-contained third-party library and DOM mutations observation is done in native MutationObserver)\r\n */\r\n/* @internal */\r\nexport const DEFAULT_REPROCESS_TIMEOUT = 100;\r\n/* @internal */\r\nexport const DEFAULT_PROCESS_QUEUE_POLYFILL_INTERVAL = 250;\r\n/* @internal */\r\nexport const DEFAULT_CONTRACT_CHANGE_LISTENER_INTERSECTION_OBSERVER_OPTIONS = {\r\n    // The root to use for intersection.\r\n    // If not provided, use the top-level documentâ€™s viewport.\r\n    root: null,\r\n    // Same as margin, can be 1, 2, 3 or 4 components, possibly negative lengths.\r\n    // If an explicit root element is specified, components may be percentages of the\r\n    // root element size. If no explicit root element is specified, using a percentage\r\n    // is an error.\r\n    rootMargin: '1000px',\r\n    // Threshold(s) at which to trigger callback, specified as a ratio, or list of\r\n    // ratios, of (visible area / total area) of the observed element (hence all\r\n    // entries must be in the range [0, 1]). Callback will be invoked when the visible\r\n    // ratio of the observed element crosses a threshold in the list.\r\n    threshold: 0\r\n};\r\n/* @internal */\r\nexport const DEFAULT_CONTRACT_CHANGE_LISTENER_PROCESS_QUEUE_THROTTLE = 500;\r\n/* @internal */\r\nlet /* @ngInject */ SmartEditContractChangeListener = class /* @ngInject */ SmartEditContractChangeListener {\r\n    constructor(yjQueryUtilsService, componentHandlerService, pageInfoService, resizeListener, positionRegistry, logService, yjQuery, systemEventService, polyfillService, testModeService, pageTreeNodeService) {\r\n        this.yjQueryUtilsService = yjQueryUtilsService;\r\n        this.componentHandlerService = componentHandlerService;\r\n        this.pageInfoService = pageInfoService;\r\n        this.resizeListener = resizeListener;\r\n        this.positionRegistry = positionRegistry;\r\n        this.logService = logService;\r\n        this.yjQuery = yjQuery;\r\n        this.systemEventService = systemEventService;\r\n        this.polyfillService = polyfillService;\r\n        this.testModeService = testModeService;\r\n        this.pageTreeNodeService = pageTreeNodeService;\r\n        /*\r\n         * This is the configuration passed to the MutationObserver instance\r\n         */\r\n        this.MUTATION_OBSERVER_OPTIONS = {\r\n            /*\r\n             * enables observation of attribute mutations\r\n             */\r\n            attributes: true,\r\n            /*\r\n             * instruct the observer to keep in store the former values of the mutated attributes\r\n             */\r\n            attributeOldValue: true,\r\n            /*\r\n             * enables observation of addition and removal of nodes\r\n             */\r\n            childList: true,\r\n            characterData: false,\r\n            /*\r\n             * enables recursive lookup without which only addition and removal of DIRECT children of the observed DOM root would be collected\r\n             */\r\n            subtree: true\r\n        };\r\n        /*\r\n         * Component state values\r\n         * 'added' when _componentsAddedCallback was called\r\n         * 'destroyed' when _componentsRemovedCallback was called\r\n         */\r\n        this.enableExtendedView = false;\r\n        /*\r\n         * nullable callbacks provided to smartEditContractChangeListener for all the observed events\r\n         */\r\n        this._componentsAddedCallback = null;\r\n        this._componentsRemovedCallback = null;\r\n        this._componentResizedCallback = null;\r\n        this._componentRepositionedCallback = null;\r\n        this._onComponentChangedCallback = null;\r\n        this._pageChangedCallback = null;\r\n        this._throttledProcessQueue = lodash.throttle(() => this._rawProcessQueue(), DEFAULT_CONTRACT_CHANGE_LISTENER_PROCESS_QUEUE_THROTTLE);\r\n        /*\r\n         * Queue used to process components when intersecting the viewport\r\n         * {Array.<{isIntersecting: Boolean, parent: DOMElement, processed: SmartEditContractChangeListener.COMPONENT_STATE}>}\r\n         */\r\n        this.componentsQueue = new Map();\r\n        this.smartEditAttributeNames = [TYPE_ATTRIBUTE, ID_ATTRIBUTE, UUID_ATTRIBUTE];\r\n    }\r\n    /*\r\n     * wrapping for test purposes\r\n     */\r\n    _newMutationObserver(callback) {\r\n        return new MutationObserver(callback);\r\n    }\r\n    /*\r\n     * wrapping for test purposes\r\n     */\r\n    _newIntersectionObserver(callback) {\r\n        return new IntersectionObserver(callback, DEFAULT_CONTRACT_CHANGE_LISTENER_INTERSECTION_OBSERVER_OPTIONS);\r\n    }\r\n    /*\r\n     * Add the given entry to the componentsQueue\r\n     * The components in the queue are sorted according to their position in the DOM\r\n     * so that the adding of components is done to have parents before children\r\n     */\r\n    _addToComponentQueue(entry) {\r\n        const component = this.componentsQueue.get(entry.target);\r\n        if (component) {\r\n            component.isIntersecting = entry.isIntersecting;\r\n        }\r\n        else if (this.yjQueryUtilsService.isInDOM(entry.target)) {\r\n            this.componentsQueue.set(entry.target, {\r\n                component: entry.target,\r\n                isIntersecting: entry.isIntersecting,\r\n                processed: null,\r\n                oldProcessedValue: null,\r\n                parent: this.componentHandlerService.getParent(entry.target)[0]\r\n            });\r\n        }\r\n    }\r\n    /*\r\n     * for e2e test purposes\r\n     */\r\n    _componentsQueueLength() {\r\n        return this.componentsQueue.size;\r\n    }\r\n    isExtendedViewEnabled() {\r\n        return this.enableExtendedView;\r\n    }\r\n    /**\r\n     * Set the 'economyMode' to true for better performance.\r\n     * In economyMode, resize/position listeners are not present, and the current economyMode value is passed to the add /remove callbacks.\r\n     */\r\n    setEconomyMode(_mode) {\r\n        this.economyMode = _mode;\r\n        if (!this.economyMode) {\r\n            // reactivate\r\n            Array.from(this.componentHandlerService.getFirstSmartEditComponentChildren(this.yjQuery('body'))).forEach((firstLevelComponent) => {\r\n                this.applyToSelfAndAllChildren(firstLevelComponent, (node) => {\r\n                    this._registerSizeAndPositionListeners(node);\r\n                });\r\n            });\r\n        }\r\n    }\r\n    /*\r\n     * initializes and starts all Intersection/DOM listeners:\r\n     * - Intersection of smartEditComponents with the viewport\r\n     * - DOM mutations on smartEditComponents and page identifier (by Means of native MutationObserver)\r\n     * - smartEditComponents repositioning (by means of querying, with an interval, the list of repositioned components from the positionRegistry)\r\n     * - smartEditComponents resizing (by delegating to the injected resizeListener)\r\n     */\r\n    initListener() {\r\n        this.enableExtendedView = this.polyfillService.isEligibleForExtendedView();\r\n        this.pageInfoService.getPageUUID().then((pageUUID) => {\r\n            this.currentPage = pageUUID;\r\n            if (this._pageChangedCallback) {\r\n                this.executeCallback(this._pageChangedCallback.bind(undefined, this.currentPage));\r\n            }\r\n        });\r\n        this.systemEventService.subscribe(CONTRACT_CHANGE_LISTENER_PROCESS_EVENTS.RESTART_PROCESS, () => {\r\n            this._processQueue();\r\n            return Promise.resolve();\r\n        });\r\n        // Intersection Observer not able to re-evaluate components that are not intersecting but going in and out of the extended viewport.\r\n        if (this.enableExtendedView) {\r\n            setInterval(() => {\r\n                this._processQueue();\r\n            }, DEFAULT_PROCESS_QUEUE_POLYFILL_INTERVAL);\r\n        }\r\n        this.mutationObserver = this._newMutationObserver(this.mutationObserverCallback.bind(this));\r\n        this.mutationObserver.observe(document.body, this.MUTATION_OBSERVER_OPTIONS);\r\n        // Intersection Observer is used to observe intersection of components with the viewport.\r\n        // each time the 'isIntersecting' property of an entry (SmartEdit component) changes, the Intersection Callback is called.\r\n        // we are using the componentsQueue to hold the components references and their isIntersecting value.\r\n        this.intersectionObserver = this._newIntersectionObserver((entries) => {\r\n            entries.forEach((entry) => {\r\n                this._addToComponentQueue(entry);\r\n            });\r\n            // A better approach would be to process each entry individually instead of processing the whole queue, but a bug Firefox v.55 prevent us to do so.\r\n            this._processQueue();\r\n        });\r\n        // Observing all SmartEdit components that are already in the page.\r\n        // Note that when an element visible in the viewport is removed, the Intersection Callback is called so we don't need to use the Mutation Observe to observe the removal of Nodes.\r\n        Array.from(this.componentHandlerService.getFirstSmartEditComponentChildren(this.yjQuery('body'))).forEach((firstLevelComponent) => {\r\n            this.applyToSelfAndAllChildren(firstLevelComponent, this.intersectionObserver.observe.bind(this.intersectionObserver));\r\n        });\r\n        this._startExpendableListeners();\r\n    }\r\n    // Processing the queue with throttling in production to avoid scrolling lag when there is a lot of components in the page.\r\n    // No throttling when e2e mode is active\r\n    _processQueue() {\r\n        if (this.testModeService.isE2EMode() || functionsUtils.isUnitTestMode()) {\r\n            this._rawProcessQueue();\r\n        }\r\n        else {\r\n            this._throttledProcessQueue();\r\n        }\r\n    }\r\n    isIntersecting(obj) {\r\n        if (!this.yjQueryUtilsService.isInDOM(obj.component)) {\r\n            return false;\r\n        }\r\n        return this.enableExtendedView\r\n            ? this.yjQueryUtilsService.isInExtendedViewPort(obj.component)\r\n            : obj.isIntersecting;\r\n    }\r\n    // for each component in the componentsQueue, we use the 'isIntersecting' and 'processed' values to add or remove it.\r\n    // An intersecting component that was not already added is added, and a non intersecting component that was added is removed (happens when scrolling, resizing the page, zooming, opening dev-tools)\r\n    // the 'PROCESS_COMPONENTS' promise is RESOLVED when the component can be added or removed, and it is REJECTED when the component can't be added but could be removed.\r\n    _rawProcessQueue() {\r\n        const observedQueueArray = Array.from(this.componentsQueue.values());\r\n        this.systemEventService\r\n            .publish(CONTRACT_CHANGE_LISTENER_PROCESS_EVENTS.PROCESS_COMPONENTS, observedQueueArray.map(({ component }) => component))\r\n            .then(this.publishSuccess.bind(this, observedQueueArray));\r\n    }\r\n    _addComponents(componentsObj) {\r\n        if (this._componentsAddedCallback) {\r\n            this.executeCallback(this._componentsAddedCallback.bind(undefined, lodash.map(componentsObj, 'component'), this.economyMode));\r\n        }\r\n        if (!this.economyMode) {\r\n            componentsObj\r\n                .filter((queueObj) => queueObj.oldProcessedValue === null)\r\n                .forEach((queueObj) => {\r\n                this._registerSizeAndPositionListeners(queueObj.component);\r\n            });\r\n        }\r\n    }\r\n    _removeComponents(componentsObj, forceRemoval = false) {\r\n        componentsObj\r\n            .filter((queueObj) => !this.yjQueryUtilsService.isInDOM(queueObj.component) || forceRemoval)\r\n            .forEach((queueObj) => {\r\n            if (!this.economyMode) {\r\n                this._unregisterSizeAndPositionListeners(queueObj.component);\r\n            }\r\n            this.componentsQueue.delete(queueObj.component);\r\n        });\r\n        if (this._componentsRemovedCallback) {\r\n            const removedComponents = componentsObj.map((obj) => lodash.pick(obj, ['component', 'parent', 'oldAttributes']));\r\n            this.executeCallback(this._componentsRemovedCallback.bind(undefined, removedComponents, this.economyMode));\r\n        }\r\n    }\r\n    _registerSizeAndPositionListeners(component) {\r\n        if (this._componentRepositionedCallback) {\r\n            this.positionRegistry.register(component);\r\n        }\r\n        if (this._componentResizedCallback) {\r\n            this.resizeListener.register(component, this._componentResizedCallback.bind(undefined, component));\r\n        }\r\n    }\r\n    _unregisterSizeAndPositionListeners(component) {\r\n        if (this._componentRepositionedCallback) {\r\n            this.positionRegistry.unregister(component);\r\n        }\r\n        if (this._componentResizedCallback) {\r\n            this.resizeListener.unregister(component);\r\n        }\r\n    }\r\n    /*\r\n     * stops and clean up all listeners\r\n     */\r\n    stopListener() {\r\n        // Stop listening for DOM mutations\r\n        if (this.mutationObserver) {\r\n            this.mutationObserver.disconnect();\r\n        }\r\n        this.intersectionObserver.disconnect();\r\n        this.mutationObserver = null;\r\n        this._stopExpendableListeners();\r\n    }\r\n    _stopExpendableListeners() {\r\n        // Stop listening for DOM resize\r\n        this.resizeListener.dispose();\r\n        // Stop listening for DOM repositioning\r\n        if (this.repositionListener) {\r\n            clearInterval(this.repositionListener);\r\n            this.repositionListener = null;\r\n        }\r\n        this.positionRegistry.dispose();\r\n    }\r\n    _startExpendableListeners() {\r\n        if (this._componentRepositionedCallback) {\r\n            this.repositionListener = setInterval(() => {\r\n                this.positionRegistry\r\n                    .getRepositionedComponents()\r\n                    .forEach((component) => {\r\n                    this._componentRepositionedCallback(component);\r\n                });\r\n            }, DEFAULT_REPROCESS_TIMEOUT);\r\n        }\r\n    }\r\n    /*\r\n     * registers a unique callback to be executed every time a smarteditComponent node is added to the DOM\r\n     * it is executed only once per subtree of smarteditComponent nodes being added\r\n     * the callback is invoked with the root node of a subtree\r\n     */\r\n    onComponentsAdded(callback) {\r\n        this._componentsAddedCallback = callback;\r\n    }\r\n    /*\r\n     * registers a unique callback to be executed every time a smarteditComponent node is removed from the DOM\r\n     * it is executed only once per subtree of smarteditComponent nodes being removed\r\n     * the callback is invoked with the root node of a subtree and its parent\r\n     */\r\n    onComponentsRemoved(callback) {\r\n        this._componentsRemovedCallback = callback;\r\n    }\r\n    /*\r\n     * registers a unique callback to be executed every time at least one of the smartEdit contract attributes of a smarteditComponent node is changed\r\n     * the callback is invoked with the mutated node itself and the map of old attributes\r\n     */\r\n    onComponentChanged(callback) {\r\n        this._onComponentChangedCallback = callback;\r\n    }\r\n    /*\r\n     * registers a unique callback to be executed every time a smarteditComponent node is resized in the DOM\r\n     * the callback is invoked with the resized node itself\r\n     */\r\n    onComponentResized(callback) {\r\n        this._componentResizedCallback = callback;\r\n    }\r\n    /*\r\n     * registers a unique callback to be executed every time a smarteditComponent node is repositioned (as per Node.getBoundingClientRect()) in the DOM\r\n     * the callback is invoked with the resized node itself\r\n     */\r\n    onComponentRepositioned(callback) {\r\n        this._componentRepositionedCallback = callback;\r\n    }\r\n    /*\r\n     * registers a unique callback to be executed:\r\n     * - upon bootstrapping smartEdit IF the page identifier is available\r\n     * - every time the page identifier is changed in the DOM (see pageInfoService.getPageUUID())\r\n     * the callback is invoked with the new page identifier read from pageInfoService.getPageUUID()\r\n     */\r\n    onPageChanged(callback) {\r\n        this._pageChangedCallback = callback;\r\n    }\r\n    loopObservedQueue(observedQueue, response) {\r\n        const addedComponents = [];\r\n        const removedComponents = [];\r\n        const responseSet = new Set(response || []);\r\n        observedQueue.forEach((obj) => {\r\n            if (!responseSet.has(obj.component)) {\r\n                return;\r\n            }\r\n            const processStatus = obj.component.dataset[SMARTEDIT_COMPONENT_PROCESS_STATUS];\r\n            switch (processStatus) {\r\n                case CONTRACT_CHANGE_LISTENER_COMPONENT_PROCESS_STATUS.PROCESS:\r\n                    if (obj.processed !== COMPONENT_STATE.ADDED && this.isIntersecting(obj)) {\r\n                        addedComponents.push(obj);\r\n                    }\r\n                    else if (obj.processed === COMPONENT_STATE.ADDED &&\r\n                        !this.isIntersecting(obj)) {\r\n                        removedComponents.push(obj);\r\n                    }\r\n                    break;\r\n                case CONTRACT_CHANGE_LISTENER_COMPONENT_PROCESS_STATUS.REMOVE:\r\n                    if (obj.processed === COMPONENT_STATE.ADDED) {\r\n                        removedComponents.push(obj);\r\n                    }\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n            obj.oldProcessedValue = obj.processed;\r\n        });\r\n        addedComponents.forEach((queueObj) => {\r\n            queueObj.processed = COMPONENT_STATE.ADDED;\r\n        });\r\n        removedComponents.forEach((queueObj) => {\r\n            queueObj.processed = COMPONENT_STATE.DESTROYED;\r\n        });\r\n        return {\r\n            addedComponents,\r\n            removedComponents\r\n        };\r\n    }\r\n    publishSuccess(observedQueue, response) {\r\n        const { addedComponents, removedComponents } = this.loopObservedQueue(observedQueue, response);\r\n        // If the intersection observer returns multiple time the same components in the callback (happen when doing a drag and drop or sfBuilder.actions.rerenderComponent)\r\n        // we will have these same components in BOTH addedComponents and removedComponents, hence we must first call _removeComponents and then _addComponents (in this order).\r\n        if (removedComponents.length) {\r\n            this._removeComponents(removedComponents);\r\n        }\r\n        if (addedComponents.length) {\r\n            addedComponents.sort(nodeUtils.compareHTMLElementsPosition('component'));\r\n            this._addComponents(addedComponents);\r\n        }\r\n        if (!this.economyMode) {\r\n            lodash\r\n                .chain(addedComponents.concat(removedComponents))\r\n                .filter((obj) => obj.oldProcessedValue === null ||\r\n                !this.yjQueryUtilsService.isInDOM(obj.component))\r\n                .map('parent')\r\n                .compact()\r\n                .uniq()\r\n                .value()\r\n                .forEach((parent) => {\r\n                this.repairParentResizeListener(parent);\r\n            });\r\n        }\r\n    }\r\n    /*\r\n     * Method used in mutationObserverCallback that extracts from mutations the list of nodes added\r\n     * The nodes are returned within a pair along with their nullable closest smartEditComponent parent\r\n     */\r\n    aggregateAddedOrRemovedNodesAndTheirParents(mutations, type) {\r\n        const entries = mutations\r\n            .filter((mutation) => \r\n        // only keep mutations of type childList and [added/removed]Nodes\r\n        mutation.type === MUTATION_TYPES.CHILD_LIST.NAME &&\r\n            mutation[type] &&\r\n            mutation[type].length)\r\n            .map((mutation) => {\r\n            // the mutated child may not be smartEditComponent, in such case we return their first level smartEditComponent children\r\n            const children = lodash\r\n                .flatten(Array.from(mutation[type])\r\n                .filter((node) => node.nodeType === Node.ELEMENT_NODE)\r\n                .map((child) => {\r\n                if (this.componentHandlerService.isSmartEditComponent(child)) {\r\n                    return child;\r\n                }\r\n                else {\r\n                    return Array.from(this.componentHandlerService.getFirstSmartEditComponentChildren(child));\r\n                }\r\n            }))\r\n                .sort(nodeUtils.compareHTMLElementsPosition());\r\n            // nodes are returned in pairs with their nullable parent\r\n            const parent = this.componentHandlerService.getClosestSmartEditComponent(mutation.target);\r\n            return children.map((node) => ({\r\n                node,\r\n                parent: parent.length ? parent[0] : null\r\n            }));\r\n        });\r\n        /*\r\n         * Despite MutationObserver specifications it so happens that sometimes,\r\n         * depending on the very way a parent node is added with its children,\r\n         * parent AND children will appear in a same mutation. We then must only keep the parent\r\n         * Since the parent will appear first, the filtering lodash.uniqWith will always return the parent as opposed to the child which is what we need\r\n         */\r\n        return lodash.uniqWith(lodash.flatten(entries), (entry1, entry2) => entry1.node.contains(entry2.node) || entry2.node.contains(entry1.node));\r\n    }\r\n    /*\r\n     * Method used in mutationObserverCallback that extracts from mutations the list of nodes the attributes of which have changed\r\n     * The nodes are returned within a pair along with their map of changed attributes\r\n     */\r\n    aggregateMutationsOnChangedAttributes(mutations) {\r\n        const map = mutations.reduce((seed, mutation) => {\r\n            if (!(mutation.target &&\r\n                mutation.target.nodeType === Node.ELEMENT_NODE &&\r\n                mutation.type === MUTATION_TYPES.ATTRIBUTES.NAME)) {\r\n                return seed;\r\n            }\r\n            let targetEntry = seed.get(mutation.target);\r\n            if (!targetEntry) {\r\n                targetEntry = {\r\n                    node: mutation.target,\r\n                    oldAttributes: {}\r\n                };\r\n                seed.set(mutation.target, targetEntry);\r\n            }\r\n            targetEntry.oldAttributes[mutation.attributeName] = mutation.oldValue;\r\n            return seed;\r\n        }, new Map());\r\n        return Array.from(map.values());\r\n    }\r\n    /**\r\n     * Verifies whether the entry is a smartedit complient element.\r\n     */\r\n    isSmarteditNode(entry) {\r\n        return (this.componentHandlerService.isSmartEditComponent(entry.node) &&\r\n            this.smartEditAttributeNames.some((attributeName) => entry.node.hasAttribute(attributeName)));\r\n    }\r\n    /**\r\n     * Verifies whether at least one of the changed attributes is a smartedit attribute.\r\n     */\r\n    isSmarteditAttributeChanged(entry) {\r\n        return this.smartEditAttributeNames.some((attributeName) => entry.oldAttributes.hasOwnProperty(attributeName));\r\n    }\r\n    /**\r\n     * Verifies whether the entry is not a smartedit element anymore.\r\n     * It checks that all smartedit related attributes were removed and the\r\n     * entry.node is still in the componentsQueue.\r\n     */\r\n    wasSmarteditNode(entry) {\r\n        return (this.componentsQueue.has(entry.node) &&\r\n            this.smartEditAttributeNames.every((attributeName) => !entry.node.hasAttribute(attributeName)));\r\n    }\r\n    /*\r\n     * Methods used in mutationObserverCallback that determines whether the smartEdit contract page identifier MAY have changed in the DOM\r\n     */\r\n    mutationsHasPageChange(mutations) {\r\n        return mutations.find((mutation) => {\r\n            const element = mutation.target;\r\n            return (mutation.type === MUTATION_TYPES.ATTRIBUTES.NAME &&\r\n                element.tagName === 'BODY' &&\r\n                mutation.attributeName === 'class');\r\n        });\r\n    }\r\n    /*\r\n     * convenience method to invoke a callback on a node and recursively on all its smartEditComponent children\r\n     */\r\n    applyToSelfAndAllChildren(node, callback) {\r\n        callback(node);\r\n        Array.from(this.componentHandlerService.getFirstSmartEditComponentChildren(node)).forEach((component) => {\r\n            this.applyToSelfAndAllChildren(component, callback);\r\n        });\r\n    }\r\n    repairParentResizeListener(parent) {\r\n        if (parent) {\r\n            // the adding of a component is likely to destroy the DOM added by the resizeListener on the parent, it needs be restored\r\n            /*\r\n             * since the DOM hierarchy is processed in order, by the time we need repair the parent,\r\n             * it has already been processed so we can rely on its process status to know whether it is eligible\r\n             */\r\n            const parentObj = this.componentsQueue.get(parent);\r\n            if (parentObj &&\r\n                parentObj.processed === COMPONENT_STATE.ADDED &&\r\n                this.yjQueryUtilsService.isInDOM(parent)) {\r\n                this._componentResizedCallback(parent);\r\n            }\r\n        }\r\n    }\r\n    /*\r\n     * when a callback is executed we make sure that angular is synchronized since it is occurring outside the life cycle\r\n     */\r\n    executeCallback(callback) {\r\n        if (this.testModeService.isE2EMode() || functionsUtils.isUnitTestMode()) {\r\n            callback();\r\n        }\r\n        else {\r\n            setTimeout(() => callback(), 0);\r\n        }\r\n    }\r\n    handleSmartEditNode(entry) {\r\n        const component = this.componentsQueue.get(entry.node);\r\n        if (!component) {\r\n            // Newly created smartedit element should always be in the component queue. If the component was created from\r\n            // a simple div tag by adding smartedit attributes we need first to add the component to the queue even if the current\r\n            // operation is change. If the component is not added to the queue it won't be rendered cause during the change callback\r\n            // it sometimes won't be able to find a parent overlay (if it is outside of the viewport).\r\n            this.applyToSelfAndAllChildren(entry.node, this.intersectionObserver.observe.bind(this.intersectionObserver));\r\n        }\r\n        else {\r\n            // the onComponentChanged is called with the mutated smartEditComponent subtree and the map of old attributes\r\n            this.executeCallback(this._onComponentChangedCallback.bind(undefined, entry.node, entry.oldAttributes));\r\n        }\r\n    }\r\n    handleNoSmarteditNode(entry) {\r\n        this.applyToSelfAndAllChildren(entry.node, this.intersectionObserver.unobserve.bind(this.intersectionObserver));\r\n        const parents = this.componentHandlerService.getClosestSmartEditComponent(entry.node);\r\n        this._removeComponents([\r\n            {\r\n                isIntersecting: false,\r\n                component: entry.node,\r\n                parent: parents.length ? parents[0] : null,\r\n                oldAttributes: entry.oldAttributes\r\n            }\r\n        ], true);\r\n    }\r\n    loopAggregateNodes(aggregatedNodes) {\r\n        aggregatedNodes.forEach((childAndParent) => {\r\n            this.applyToSelfAndAllChildren(childAndParent.node, (node) => {\r\n                const component = this.componentsQueue.get(node);\r\n                if (!component) {\r\n                    return;\r\n                }\r\n                if (!this.economyMode) {\r\n                    this.repairParentResizeListener(childAndParent.parent);\r\n                }\r\n                this._removeComponents([\r\n                    {\r\n                        isIntersecting: false,\r\n                        component: node,\r\n                        parent: childAndParent.parent\r\n                    }\r\n                ]);\r\n            });\r\n        });\r\n    }\r\n    loopMutationsOnChangedAttributes(mutations) {\r\n        // TODO: are we missing tests here?\r\n        this.aggregateMutationsOnChangedAttributes(mutations).forEach((entry) => {\r\n            if (this.isSmarteditAttributeChanged(entry)) {\r\n                if (this.isSmarteditNode(entry)) {\r\n                    this.handleSmartEditNode(entry);\r\n                }\r\n                else if (this.wasSmarteditNode(entry)) {\r\n                    this.handleNoSmarteditNode(entry);\r\n                }\r\n            }\r\n        });\r\n    }\r\n    /*\r\n     * callback executed by the mutation observer every time mutations occur.\r\n     * repositioning and resizing are not part of this except that every time a smartEditComponent is added,\r\n     * it is registered within the positionRegistry and the resizeListener\r\n     */\r\n    mutationObserverCallback(mutations) {\r\n        this.logService.debug(mutations);\r\n        if (this._pageChangedCallback && this.mutationsHasPageChange(mutations)) {\r\n            this.pageInfoService.getPageUUID().then((newPageUUID) => {\r\n                if (this.currentPage !== newPageUUID) {\r\n                    this.executeCallback(this._pageChangedCallback.bind(undefined, newPageUUID));\r\n                }\r\n                this.currentPage = newPageUUID;\r\n            });\r\n        }\r\n        const addNodes = this.aggregateAddedOrRemovedNodesAndTheirParents(mutations, MUTATION_TYPES.CHILD_LIST.ADD_OPERATION);\r\n        this.pageTreeNodeService.updateSlotNodes(addNodes);\r\n        if (this._componentsAddedCallback) {\r\n            addNodes.forEach((childAndParent) => {\r\n                this.applyToSelfAndAllChildren(childAndParent.node, this.intersectionObserver.observe.bind(this.intersectionObserver));\r\n            });\r\n        }\r\n        const removeNodes = this.aggregateAddedOrRemovedNodesAndTheirParents(mutations, MUTATION_TYPES.CHILD_LIST.REMOVE_OPERATION);\r\n        this.pageTreeNodeService.updateSlotNodes(removeNodes);\r\n        this.loopAggregateNodes(removeNodes);\r\n        if (this._onComponentChangedCallback) {\r\n            this.loopMutationsOnChangedAttributes(mutations);\r\n        }\r\n    }\r\n};\r\n/* @ngInject */ SmartEditContractChangeListener = __decorate([\r\n    SeDowngradeService(ISmartEditContractChangeListener),\r\n    __param(6, Inject(YJQUERY_TOKEN)),\r\n    __metadata(\"design:paramtypes\", [JQueryUtilsService,\r\n        ComponentHandlerService,\r\n        IPageInfoService,\r\n        IResizeListener,\r\n        IPositionRegistry,\r\n        LogService, Function, SystemEventService,\r\n        PolyfillService,\r\n        TestModeService,\r\n        IPageTreeNodeService])\r\n], /* @ngInject */ SmartEditContractChangeListener);\r\nexport { /* @ngInject */ SmartEditContractChangeListener };\r\n//# sourceMappingURL=SmartEditContractChangeListener.js.map","references":["/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular+core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@types+lodash@4.14.159/node_modules/@types/lodash/ts3.1/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts"],"map":"{\"version\":3,\"file\":\"SmartEditContractChangeListener.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/services/SmartEditContractChangeListener.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit/node_modules/.cache/rollup-plugin-typescript2/placeholder/services/SmartEditContractChangeListener.d.ts","writeByteOrderMark":false,"text":"/// <reference types=\"angular\" />\r\n/// <reference types=\"jquery\" />\r\nimport { ComponentEntry, IPageInfoService, IPositionRegistry, IResizeListener, ISmartEditContractChangeListener, JQueryUtilsService, LogService, PolyfillService, RemoveComponentObject, SystemEventService, TestModeService, TypedMap, ComponentHandlerService, IPageTreeNodeService } from 'smarteditcommons';\r\nexport declare const DEFAULT_REPROCESS_TIMEOUT = 100;\r\nexport declare const DEFAULT_PROCESS_QUEUE_POLYFILL_INTERVAL = 250;\r\nexport declare const DEFAULT_CONTRACT_CHANGE_LISTENER_INTERSECTION_OBSERVER_OPTIONS: {\r\n    root: HTMLElement;\r\n    rootMargin: string;\r\n    threshold: number;\r\n};\r\nexport declare const DEFAULT_CONTRACT_CHANGE_LISTENER_PROCESS_QUEUE_THROTTLE = 500;\r\nexport declare class SmartEditContractChangeListener implements ISmartEditContractChangeListener {\r\n    private readonly yjQueryUtilsService;\r\n    private readonly componentHandlerService;\r\n    private readonly pageInfoService;\r\n    private readonly resizeListener;\r\n    private readonly positionRegistry;\r\n    private readonly logService;\r\n    private readonly yjQuery;\r\n    private readonly systemEventService;\r\n    private readonly polyfillService;\r\n    private readonly testModeService;\r\n    private readonly pageTreeNodeService;\r\n    private readonly smartEditAttributeNames;\r\n    private readonly MUTATION_OBSERVER_OPTIONS;\r\n    private mutationObserver;\r\n    private intersectionObserver;\r\n    private repositionListener;\r\n    private currentPage;\r\n    private enableExtendedView;\r\n    private _componentsAddedCallback;\r\n    private _componentsRemovedCallback;\r\n    private _componentResizedCallback;\r\n    private _componentRepositionedCallback;\r\n    private _onComponentChangedCallback;\r\n    private _pageChangedCallback;\r\n    private readonly _throttledProcessQueue;\r\n    private readonly componentsQueue;\r\n    private economyMode;\r\n    constructor(yjQueryUtilsService: JQueryUtilsService, componentHandlerService: ComponentHandlerService, pageInfoService: IPageInfoService, resizeListener: IResizeListener, positionRegistry: IPositionRegistry, logService: LogService, yjQuery: JQueryStatic, systemEventService: SystemEventService, polyfillService: PolyfillService, testModeService: TestModeService, pageTreeNodeService: IPageTreeNodeService);\r\n    _newMutationObserver(callback: MutationCallback): MutationObserver;\r\n    _newIntersectionObserver(callback: IntersectionObserverCallback): IntersectionObserver;\r\n    _addToComponentQueue(entry: IntersectionObserverEntry): void;\r\n    _componentsQueueLength(): number;\r\n    isExtendedViewEnabled(): boolean;\r\n    /**\r\n     * Set the 'economyMode' to true for better performance.\r\n     * In economyMode, resize/position listeners are not present, and the current economyMode value is passed to the add /remove callbacks.\r\n     */\r\n    setEconomyMode(_mode: boolean): void;\r\n    initListener(): void;\r\n    _processQueue(): void;\r\n    isIntersecting(obj: ComponentEntry): boolean;\r\n    _rawProcessQueue(): void;\r\n    _addComponents(componentsObj: ComponentEntry[]): void;\r\n    _removeComponents(componentsObj: RemoveComponentObject[], forceRemoval?: boolean): void;\r\n    _registerSizeAndPositionListeners(component: HTMLElement): void;\r\n    _unregisterSizeAndPositionListeners(component: HTMLElement): void;\r\n    stopListener(): void;\r\n    _stopExpendableListeners(): void;\r\n    _startExpendableListeners(): void;\r\n    onComponentsAdded(callback: (components: HTMLElement[], isEconomyMode: boolean) => void): void;\r\n    onComponentsRemoved(callback: (components: {\r\n        component: HTMLElement;\r\n        parent: HTMLElement;\r\n    }[], isEconomyMode: boolean) => void): void;\r\n    onComponentChanged(callback: (component: HTMLElement, oldAttributes: TypedMap<string>) => void): void;\r\n    onComponentResized(callback: (component: HTMLElement) => void): void;\r\n    onComponentRepositioned(callback: (component: HTMLElement) => void): void;\r\n    onPageChanged(callback: (pageUUID: string) => void): void;\r\n    private loopObservedQueue;\r\n    private publishSuccess;\r\n    private aggregateAddedOrRemovedNodesAndTheirParents;\r\n    private aggregateMutationsOnChangedAttributes;\r\n    /**\r\n     * Verifies whether the entry is a smartedit complient element.\r\n     */\r\n    private isSmarteditNode;\r\n    /**\r\n     * Verifies whether at least one of the changed attributes is a smartedit attribute.\r\n     */\r\n    private isSmarteditAttributeChanged;\r\n    /**\r\n     * Verifies whether the entry is not a smartedit element anymore.\r\n     * It checks that all smartedit related attributes were removed and the\r\n     * entry.node is still in the componentsQueue.\r\n     */\r\n    private wasSmarteditNode;\r\n    private mutationsHasPageChange;\r\n    private applyToSelfAndAllChildren;\r\n    private repairParentResizeListener;\r\n    private executeCallback;\r\n    private handleSmartEditNode;\r\n    private handleNoSmarteditNode;\r\n    private loopAggregateNodes;\r\n    private loopMutationsOnChangedAttributes;\r\n    private mutationObserverCallback;\r\n}\r\n"}}
