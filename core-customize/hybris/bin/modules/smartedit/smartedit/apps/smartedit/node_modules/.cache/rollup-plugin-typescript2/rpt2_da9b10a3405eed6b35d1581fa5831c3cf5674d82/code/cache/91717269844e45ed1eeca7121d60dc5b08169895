{"code":"import { __decorate, __metadata } from \"tslib\";\r\n/*\r\n * Copyright (c) 2022 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { Injectable } from '@angular/core';\r\nimport * as lodash from 'lodash';\r\nimport { IDecoratorService, ILegacyDecoratorToCustomElementConverter, PromiseUtils, SeDowngradeService, StringUtils } from 'smarteditcommons';\r\n/**\r\n * This service enables and disables decorators. It also maps decorators to SmartEdit component typesâ€“regardless if they are enabled or disabled.\r\n *\r\n */\r\nlet /* @ngInject */ DecoratorService = class /* @ngInject */ DecoratorService {\r\n    constructor(promiseUtils, stringUtils, legacyDecoratorToCustomElementConverter) {\r\n        this.promiseUtils = promiseUtils;\r\n        this.stringUtils = stringUtils;\r\n        this.legacyDecoratorToCustomElementConverter = legacyDecoratorToCustomElementConverter;\r\n        this._activeDecorators = {};\r\n        this.componentDecoratorsMap = {};\r\n    }\r\n    /**\r\n     * This method enables a list of decorators for a group of component types.\r\n     * The list to be [enable]{@link DecoratorService#enable} is identified by a matching pattern.\r\n     * The list is enabled when a perspective or referenced perspective that it is bound to is activated/enabled.\r\n     *\r\n     *\r\n     *\r\n     *      decoratorService.addMappings({\r\n     *          '*Suffix': ['decorator1', 'decorator2'],\r\n     *          '.*Suffix': ['decorator2', 'decorator3'],\r\n     *          'MyExactType': ['decorator3', 'decorator4'],\r\n     *          '^((?!Middle).)*$': ['decorator4', 'decorator5']\r\n     *      });\r\n     *\r\n     *\r\n     * @param  map A key-map value; the key is the matching pattern and the value is an array of decorator keys. The key can be an exact type, an ant-like wild card, or a full regular expression:\r\n     */\r\n    addMappings(map) {\r\n        for (const regexpKey in map) {\r\n            if (map.hasOwnProperty(regexpKey)) {\r\n                const decoratorsArray = map[regexpKey];\r\n                this.legacyDecoratorToCustomElementConverter.convertIfNeeded(decoratorsArray);\r\n                this.componentDecoratorsMap[regexpKey] = lodash.union(this.componentDecoratorsMap[regexpKey] || [], decoratorsArray);\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * Enables a decorator\r\n     *\r\n     * @param decoratorKey The key that uniquely identifies the decorator.\r\n     * @param displayCondition Returns a promise that will resolve to a boolean that determines whether the decorator will be displayed.\r\n     */\r\n    enable(decoratorKey, displayCondition) {\r\n        if (!(decoratorKey in this._activeDecorators)) {\r\n            this._activeDecorators[decoratorKey] = {\r\n                displayCondition\r\n            };\r\n        }\r\n    }\r\n    /**\r\n     * Disables a decorator\r\n     *\r\n     * @param decoratorKey the decorator key\r\n     */\r\n    disable(decoratorKey) {\r\n        if (this._activeDecorators[decoratorKey]) {\r\n            delete this._activeDecorators[decoratorKey];\r\n        }\r\n    }\r\n    /**\r\n     * This method retrieves a list of decorator keys that is eligible for the specified component type.\r\n     * The list retrieved depends on which perspective is active.\r\n     *\r\n     * This method uses the list of decorators enabled by the [addMappings]{@link DecoratorService#addMappings} method.\r\n     *\r\n     * @param componentType The type of the component to be decorated.\r\n     * @param componentId The id of the component to be decorated.\r\n     * @returns A promise that resolves to a list of decorator keys.\r\n     *\r\n     */\r\n    getDecoratorsForComponent(componentType, componentId) {\r\n        let decoratorArray = [];\r\n        if (this.componentDecoratorsMap) {\r\n            for (const regexpKey in this.componentDecoratorsMap) {\r\n                if (this.stringUtils.regExpFactory(regexpKey).test(componentType)) {\r\n                    decoratorArray = lodash.union(decoratorArray, this.componentDecoratorsMap[regexpKey]);\r\n                }\r\n            }\r\n        }\r\n        return this.getDecoratorPromise(decoratorArray, componentType, componentId);\r\n    }\r\n    getDecoratorPromise(decoratorArray, componentType, componentId) {\r\n        const promisesToResolve = [];\r\n        const displayedDecorators = [];\r\n        decoratorArray.forEach((dec) => {\r\n            const activeDecorator = this._activeDecorators[dec];\r\n            if (activeDecorator && activeDecorator.displayCondition) {\r\n                if (typeof activeDecorator.displayCondition !== 'function') {\r\n                    throw new Error(\"The active decorator's displayCondition property must be a function and must return a boolean\");\r\n                }\r\n                const deferred = this.promiseUtils.defer();\r\n                activeDecorator\r\n                    .displayCondition(componentType, componentId)\r\n                    .then((display) => {\r\n                    if (display) {\r\n                        deferred.resolve(dec);\r\n                    }\r\n                    else {\r\n                        deferred.resolve(null);\r\n                    }\r\n                });\r\n                promisesToResolve.push(deferred.promise);\r\n            }\r\n            else if (activeDecorator) {\r\n                displayedDecorators.push(dec);\r\n            }\r\n        });\r\n        return Promise.all(promisesToResolve).then((decoratorsEnabled) => displayedDecorators.concat(decoratorsEnabled.filter((dec) => dec)));\r\n    }\r\n};\r\n/* @ngInject */ DecoratorService = __decorate([\r\n    SeDowngradeService(IDecoratorService),\r\n    Injectable(),\r\n    __metadata(\"design:paramtypes\", [PromiseUtils,\r\n        StringUtils,\r\n        ILegacyDecoratorToCustomElementConverter])\r\n], /* @ngInject */ DecoratorService);\r\nexport { /* @ngInject */ DecoratorService };\r\n//# sourceMappingURL=DecoratorService.js.map","references":["/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular+core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@types+lodash@4.14.159/node_modules/@types/lodash/ts3.1/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts"],"map":"{\"version\":3,\"file\":\"DecoratorService.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/services/DecoratorService.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit/node_modules/.cache/rollup-plugin-typescript2/placeholder/services/DecoratorService.d.ts","writeByteOrderMark":false,"text":"import { IDecoratorDisplayCondition, IDecoratorService, ILegacyDecoratorToCustomElementConverter, PromiseUtils, StringUtils } from 'smarteditcommons';\r\nexport interface DecoratorMapping {\r\n    [index: string]: string[];\r\n}\r\n/**\r\n * This service enables and disables decorators. It also maps decorators to SmartEdit component typesâ€“regardless if they are enabled or disabled.\r\n *\r\n */\r\nexport declare class DecoratorService implements IDecoratorService {\r\n    private promiseUtils;\r\n    private stringUtils;\r\n    private legacyDecoratorToCustomElementConverter;\r\n    private _activeDecorators;\r\n    private componentDecoratorsMap;\r\n    constructor(promiseUtils: PromiseUtils, stringUtils: StringUtils, legacyDecoratorToCustomElementConverter: ILegacyDecoratorToCustomElementConverter);\r\n    /**\r\n     * This method enables a list of decorators for a group of component types.\r\n     * The list to be [enable]{@link DecoratorService#enable} is identified by a matching pattern.\r\n     * The list is enabled when a perspective or referenced perspective that it is bound to is activated/enabled.\r\n     *\r\n     *\r\n     *\r\n     *      decoratorService.addMappings({\r\n     *          '*Suffix': ['decorator1', 'decorator2'],\r\n     *          '.*Suffix': ['decorator2', 'decorator3'],\r\n     *          'MyExactType': ['decorator3', 'decorator4'],\r\n     *          '^((?!Middle).)*$': ['decorator4', 'decorator5']\r\n     *      });\r\n     *\r\n     *\r\n     * @param  map A key-map value; the key is the matching pattern and the value is an array of decorator keys. The key can be an exact type, an ant-like wild card, or a full regular expression:\r\n     */\r\n    addMappings(map: DecoratorMapping): void;\r\n    /**\r\n     * Enables a decorator\r\n     *\r\n     * @param decoratorKey The key that uniquely identifies the decorator.\r\n     * @param displayCondition Returns a promise that will resolve to a boolean that determines whether the decorator will be displayed.\r\n     */\r\n    enable(decoratorKey: string, displayCondition?: IDecoratorDisplayCondition): void;\r\n    /**\r\n     * Disables a decorator\r\n     *\r\n     * @param decoratorKey the decorator key\r\n     */\r\n    disable(decoratorKey: string): void;\r\n    /**\r\n     * This method retrieves a list of decorator keys that is eligible for the specified component type.\r\n     * The list retrieved depends on which perspective is active.\r\n     *\r\n     * This method uses the list of decorators enabled by the [addMappings]{@link DecoratorService#addMappings} method.\r\n     *\r\n     * @param componentType The type of the component to be decorated.\r\n     * @param componentId The id of the component to be decorated.\r\n     * @returns A promise that resolves to a list of decorator keys.\r\n     *\r\n     */\r\n    getDecoratorsForComponent(componentType: string, componentId?: string): Promise<string[]>;\r\n    private getDecoratorPromise;\r\n}\r\n"}}
