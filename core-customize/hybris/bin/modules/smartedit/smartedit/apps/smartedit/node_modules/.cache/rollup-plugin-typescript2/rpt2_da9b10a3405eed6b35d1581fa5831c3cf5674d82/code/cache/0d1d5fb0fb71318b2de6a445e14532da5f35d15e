{"code":"import { __decorate, __metadata, __param } from \"tslib\";\r\n/*\r\n * Copyright (c) 2022 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { Inject } from '@angular/core';\r\nimport { IPageTreeNodeService, YJQUERY_TOKEN, ID_ATTRIBUTE, TYPE_ATTRIBUTE, CONTAINER_ID_ATTRIBUTE, CATALOG_VERSION_UUID_ATTRIBUTE, UUID_ATTRIBUTE, CONTAINER_TYPE_ATTRIBUTE, SeDowngradeService, GatewayProxied, ComponentHandlerService, stringUtils, ELEMENT_UUID_ATTRIBUTE, LogService, EVENT_PART_REFRESH_TREE_NODE, CrossFrameEventService, EVENT_OVERALL_REFRESH_TREE_NODE, WindowUtils } from 'smarteditcommons';\r\nlet /* @ngInject */ PageTreeNodeService = class /* @ngInject */ PageTreeNodeService extends IPageTreeNodeService {\r\n    constructor(componentHandlerService, yjQuery, crossFrameEventService, windowUtils, logService) {\r\n        super();\r\n        this.componentHandlerService = componentHandlerService;\r\n        this.yjQuery = yjQuery;\r\n        this.crossFrameEventService = crossFrameEventService;\r\n        this.windowUtils = windowUtils;\r\n        this.logService = logService;\r\n    }\r\n    buildSlotNodes() {\r\n        this.slotNodes = this.buildSlotNodesByElement(this.yjQuery('body'));\r\n        this.crossFrameEventService.publish(EVENT_OVERALL_REFRESH_TREE_NODE);\r\n    }\r\n    updateSlotNodes(nodes) {\r\n        if (this.slotNodes && nodes.length > 0) {\r\n            const parentSet = new Set();\r\n            const updatedSlotNodes = {};\r\n            nodes.forEach((node) => {\r\n                if (parentSet.has(node.parent)) {\r\n                    return;\r\n                }\r\n                parentSet.add(node.parent);\r\n                const element = this.yjQuery(node.parent);\r\n                const parentUUid = element.attr(ELEMENT_UUID_ATTRIBUTE);\r\n                if (!parentUUid) {\r\n                    return;\r\n                }\r\n                const childrenNode = this.buildSlotNodesByElement(element);\r\n                updatedSlotNodes[parentUUid] = childrenNode;\r\n                this.slotNodes.forEach((item) => {\r\n                    if (item.elementUuid === parentUUid) {\r\n                        item.childrenNode = childrenNode;\r\n                    }\r\n                });\r\n            });\r\n            this.crossFrameEventService.publish(EVENT_PART_REFRESH_TREE_NODE, updatedSlotNodes);\r\n        }\r\n    }\r\n    getSlotNodes() {\r\n        return Promise.resolve(this.slotNodes);\r\n    }\r\n    /*\r\n     * If element is not in viewport or element bottom is in viewport scroll element into view\r\n     */\r\n    scrollToElement(elementUuid) {\r\n        const element = this.yjQuery(`[data-smartedit-element-uuid=\"${elementUuid}\"]`)\r\n            .get()\r\n            .shift();\r\n        if (element) {\r\n            if (this.elementTopInViewport(element) || this.elementCenterInViewport(element)) {\r\n                return;\r\n            }\r\n            element.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n        }\r\n        else {\r\n            this.logService.error(`data-smartedit-element-uuid=\"${elementUuid}\" is not existed!`);\r\n        }\r\n    }\r\n    existedSmartEditElement(elementUuid) {\r\n        const element = this.yjQuery(`smartedit-element[data-smartedit-element-uuid=\"${elementUuid}\"]`)\r\n            .get()\r\n            .shift();\r\n        return Promise.resolve(!!element);\r\n    }\r\n    _buildSlotNode(node) {\r\n        const element = this.yjQuery(node);\r\n        const childrenNode = Array.from(this.componentHandlerService.getFirstSmartEditComponentChildren(element))\r\n            .filter((child) => this._isValidElement(child))\r\n            .map((firstLevelComponent) => this._buildSlotNode(firstLevelComponent));\r\n        if (!element.attr(ELEMENT_UUID_ATTRIBUTE)) {\r\n            element.attr(ELEMENT_UUID_ATTRIBUTE, stringUtils.generateIdentifier());\r\n        }\r\n        return {\r\n            componentId: element.attr(ID_ATTRIBUTE),\r\n            componentUuid: element.attr(UUID_ATTRIBUTE),\r\n            componentTypeFromPage: element.attr(TYPE_ATTRIBUTE),\r\n            catalogVersionUuid: element.attr(CATALOG_VERSION_UUID_ATTRIBUTE),\r\n            containerId: element.attr(CONTAINER_ID_ATTRIBUTE),\r\n            containerType: element.attr(CONTAINER_TYPE_ATTRIBUTE),\r\n            elementUuid: element.attr(ELEMENT_UUID_ATTRIBUTE),\r\n            isExpanded: false,\r\n            childrenNode\r\n        };\r\n    }\r\n    _isValidElement(ele) {\r\n        const element = this.yjQuery(ele);\r\n        if (!element || !element.is(':visible')) {\r\n            return false;\r\n        }\r\n        return !(!element.attr(ID_ATTRIBUTE) ||\r\n            !element.attr(UUID_ATTRIBUTE) ||\r\n            !element.attr(TYPE_ATTRIBUTE) ||\r\n            !element.attr(CATALOG_VERSION_UUID_ATTRIBUTE));\r\n    }\r\n    elementTopInViewport(element) {\r\n        const rect = element.getBoundingClientRect();\r\n        return (rect.top >= 0 &&\r\n            rect.left >= 0 &&\r\n            rect.top <\r\n                (this.windowUtils.getWindow().innerHeight ||\r\n                    document.documentElement.clientHeight) &&\r\n            rect.left <\r\n                (this.windowUtils.getWindow().innerWidth || document.documentElement.clientWidth));\r\n    }\r\n    elementCenterInViewport(element) {\r\n        const rect = element.getBoundingClientRect();\r\n        return (rect.top < 0 &&\r\n            rect.left < 0 &&\r\n            rect.bottom >\r\n                (this.windowUtils.getWindow().innerHeight ||\r\n                    document.documentElement.clientHeight) &&\r\n            rect.right >\r\n                (this.windowUtils.getWindow().innerWidth || document.documentElement.clientWidth));\r\n    }\r\n    buildSlotNodesByElement(element) {\r\n        return Array.from(this.componentHandlerService.getFirstSmartEditComponentChildren(element))\r\n            .filter((child) => this._isValidElement(child))\r\n            .map((firstLevelComponent) => this._buildSlotNode(firstLevelComponent));\r\n    }\r\n};\r\n/* @ngInject */ PageTreeNodeService = __decorate([\r\n    SeDowngradeService(IPageTreeNodeService),\r\n    GatewayProxied('getSlotNodes', 'scrollToElement', 'existedSmartEditElement'),\r\n    __param(1, Inject(YJQUERY_TOKEN)),\r\n    __metadata(\"design:paramtypes\", [ComponentHandlerService, Function, CrossFrameEventService,\r\n        WindowUtils,\r\n        LogService])\r\n], /* @ngInject */ PageTreeNodeService);\r\nexport { /* @ngInject */ PageTreeNodeService };\r\n//# sourceMappingURL=PageTreeNodeServiceInner.js.map","references":["/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedittools/common/temp/node_modules/.pnpm/@angular+core@8.2.14_rxjs@6.5.4+zone.js@0.9.1/node_modules/@angular/core/core.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/dist/index.d.ts"],"map":"{\"version\":3,\"file\":\"PageTreeNodeServiceInner.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/services/PageTreeNodeServiceInner.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit/node_modules/.cache/rollup-plugin-typescript2/placeholder/services/PageTreeNodeServiceInner.d.ts","writeByteOrderMark":false,"text":"/// <reference types=\"angular\" />\r\n/// <reference types=\"jquery\" />\r\nimport { PageTreeNode, IPageTreeNodeService, ComponentHandlerService, LogService, CrossFrameEventService, AggregatedNode, WindowUtils } from 'smarteditcommons';\r\nexport declare class PageTreeNodeService extends IPageTreeNodeService {\r\n    private readonly componentHandlerService;\r\n    private readonly yjQuery;\r\n    private readonly crossFrameEventService;\r\n    private readonly windowUtils;\r\n    private readonly logService;\r\n    constructor(componentHandlerService: ComponentHandlerService, yjQuery: JQueryStatic, crossFrameEventService: CrossFrameEventService, windowUtils: WindowUtils, logService: LogService);\r\n    buildSlotNodes(): void;\r\n    updateSlotNodes(nodes: AggregatedNode[]): void;\r\n    getSlotNodes(): Promise<PageTreeNode[]>;\r\n    scrollToElement(elementUuid: string): Promise<void>;\r\n    existedSmartEditElement(elementUuid: string): Promise<boolean>;\r\n    protected _buildSlotNode(node: HTMLElement): PageTreeNode;\r\n    protected _isValidElement(ele: HTMLElement): boolean;\r\n    private elementTopInViewport;\r\n    private elementCenterInViewport;\r\n    private buildSlotNodesByElement;\r\n}\r\n"}}
