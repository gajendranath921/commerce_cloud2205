{"code":"import { __decorate, __metadata } from \"tslib\";\r\n/*\r\n * Copyright (c) 2022 SAP SE or an SAP affiliate company. All rights reserved.\r\n */\r\nimport { ISessionService, LogService } from '@smart/utils';\r\nimport { SeDowngradeService } from 'smarteditcommons/di';\r\nimport { PermissionsRestService } from './rest';\r\n/**\r\n * This service makes calls to the Global Permissions REST API to check if the current user was\r\n * granted certain permissions.\r\n */\r\nlet /* @ngInject */ AuthorizationService = class /* @ngInject */ AuthorizationService {\r\n    constructor(logService, sessionService, permissionsRestService) {\r\n        this.logService = logService;\r\n        this.sessionService = sessionService;\r\n        this.permissionsRestService = permissionsRestService;\r\n    }\r\n    /**\r\n     * This method checks if the current user is granted the given global permissions.\r\n     *\r\n     * @param permissionNames The list of global permissions to check.\r\n     *\r\n     * @returns True if the user is granted all of the given permissions, false otherwise\r\n     *\r\n     * ### Throws\r\n     *\r\n     * - Will throw an error if the permissionNames array is empty.\r\n     */\r\n    hasGlobalPermissions(permissionNames) {\r\n        if (!permissionNames.length || permissionNames.length < 1) {\r\n            throw new Error('permissionNames must be a non-empty array');\r\n        }\r\n        const onSuccess = (permissions) => this.mergePermissionResults(permissions, permissionNames);\r\n        const onError = () => {\r\n            this.logService.error('AuthorizationService - Failed to determine authorization for the following permissions: ' +\r\n                permissionNames.toString());\r\n            return false;\r\n        };\r\n        return this.getPermissions(permissionNames).then(onSuccess, onError);\r\n    }\r\n    /*\r\n     * This method will look for the result for the given permission name. If found, it is\r\n     * verified that it has been granted. Otherwise, the method will return false.\r\n     */\r\n    getPermissionResult(permissionResults, permissionName) {\r\n        const permission = permissionResults.permissions.find((result) => result.key.toLowerCase() === permissionName.toLowerCase());\r\n        return !!permission && permission.value === 'true';\r\n    }\r\n    /*\r\n     * This method merges permission results. It iterates through the list of permission names that\r\n     * were checked and evaluates if the permission is granted. It immediately returns false when\r\n     * it encounters a permission that is denied.\r\n     */\r\n    mergePermissionResults(permissionResults, permissionNames) {\r\n        let hasPermission = !!permissionNames && permissionNames.length > 0;\r\n        let index = 0;\r\n        while (hasPermission && index < permissionNames.length) {\r\n            hasPermission =\r\n                hasPermission &&\r\n                    this.getPermissionResult(permissionResults, permissionNames[index++]);\r\n        }\r\n        return hasPermission;\r\n    }\r\n    /*\r\n     * This method makes a call to the Global Permissions API with the given permission names\r\n     * and returns the list of results.\r\n     */\r\n    getPermissions(permissionNames) {\r\n        return this.sessionService.getCurrentUsername().then((user) => {\r\n            if (!user) {\r\n                return { permissions: [] };\r\n            }\r\n            return this.permissionsRestService.get({\r\n                user,\r\n                permissionNames: permissionNames.join(',')\r\n            });\r\n        });\r\n    }\r\n};\r\n/* @ngInject */ AuthorizationService = __decorate([\r\n    SeDowngradeService(),\r\n    __metadata(\"design:paramtypes\", [LogService,\r\n        ISessionService,\r\n        PermissionsRestService])\r\n], /* @ngInject */ AuthorizationService);\r\nexport { /* @ngInject */ AuthorizationService };\r\n//# sourceMappingURL=AuthorizationService.js.map","references":["/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smart-utils/dist/index.d.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/di/index.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/dtos/index.ts","/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/src/services/rest/index.ts"],"map":"{\"version\":3,\"file\":\"AuthorizationService.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/services/AuthorizationService.ts\"],\"names\":[],\"mappings\":\";AAAA;;GAEG;AACH,OAAO,EAAE,eAAe,EAAE,UAAU,EAAE,MAAM,cAAc,CAAC;AAE3D,OAAO,EAAE,kBAAkB,EAAE,MAAM,qBAAqB,CAAC;AAEzD,OAAO,EAAE,sBAAsB,EAAE,MAAM,QAAQ,CAAC;AAEhD;;;GAGG;AAEH,2CAAA;IACI,YACqB,UAAsB,EACtB,cAA+B,EAC/B,sBAA8C;QAF9C,eAAU,GAAV,UAAU,CAAY;QACtB,mBAAc,GAAd,cAAc,CAAiB;QAC/B,2BAAsB,GAAtB,sBAAsB,CAAwB;IAChE,CAAC;IAEJ;;;;;;;;;;OAUG;IACI,oBAAoB,CAAC,eAAyB;QACjD,IAAI,CAAC,eAAe,CAAC,MAAM,IAAI,eAAe,CAAC,MAAM,GAAG,CAAC,EAAE;YACvD,MAAM,IAAI,KAAK,CAAC,2CAA2C,CAAC,CAAC;SAChE;QAED,MAAM,SAAS,GAAG,CAAC,WAA0C,EAAW,EAAE,CACtE,IAAI,CAAC,sBAAsB,CAAC,WAAW,EAAE,eAAe,CAAC,CAAC;QAE9D,MAAM,OAAO,GAAG,GAAY,EAAE;YAC1B,IAAI,CAAC,UAAU,CAAC,KAAK,CACjB,0FAA0F;gBACtF,eAAe,CAAC,QAAQ,EAAE,CACjC,CAAC;YACF,OAAO,KAAK,CAAC;QACjB,CAAC,CAAC;QAEF,OAAO,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;IACzE,CAAC;IAED;;;OAGG;IACK,mBAAmB,CACvB,iBAAgD,EAChD,cAAsB;QAEtB,MAAM,UAAU,GAAgC,iBAAiB,CAAC,WAAW,CAAC,IAAI,CAC9E,CAAC,MAAmC,EAAE,EAAE,CACpC,MAAM,CAAC,GAAG,CAAC,WAAW,EAAE,KAAK,cAAc,CAAC,WAAW,EAAE,CAChE,CAAC;QAEF,OAAO,CAAC,CAAC,UAAU,IAAI,UAAU,CAAC,KAAK,KAAK,MAAM,CAAC;IACvD,CAAC;IAED;;;;OAIG;IACK,sBAAsB,CAC1B,iBAAgD,EAChD,eAAyB;QAEzB,IAAI,aAAa,GAAG,CAAC,CAAC,eAAe,IAAI,eAAe,CAAC,MAAM,GAAG,CAAC,CAAC;QACpE,IAAI,KAAK,GAAG,CAAC,CAAC;QAEd,OAAO,aAAa,IAAI,KAAK,GAAG,eAAe,CAAC,MAAM,EAAE;YACpD,aAAa;gBACT,aAAa;oBACb,IAAI,CAAC,mBAAmB,CAAC,iBAAiB,EAAE,eAAe,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;SAC7E;QAED,OAAO,aAAa,CAAC;IACzB,CAAC;IAED;;;OAGG;IACK,cAAc,CAAC,eAAyB;QAC5C,OAAO,IAAI,CAAC,cAAc,CAAC,kBAAkB,EAAE,CAAC,IAAI,CAAC,CAAC,IAAY,EAAE,EAAE;YAClE,IAAI,CAAC,IAAI,EAAE;gBACP,OAAO,EAAE,WAAW,EAAE,EAAE,EAAE,CAAC;aAC9B;YACD,OAAO,IAAI,CAAC,sBAAsB,CAAC,GAAG,CAAC;gBACnC,IAAI;gBACJ,eAAe,EAAE,eAAe,CAAC,IAAI,CAAC,GAAG,CAAC;aAC7C,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;IACP,CAAC;CACJ,CAAA;AAzFD;IADC,kBAAkB,EAAE;qCAGgB,UAAU;QACN,eAAe;QACP,sBAAsB;wCAqFtE\"}","dts":{"name":"/home/wadmin/Documents/cloud-commerce-sample-setup-update-2211/core-customize/hybris/bin/modules/smartedit/smartedit/apps/smartedit-commons/node_modules/.cache/rollup-plugin-typescript2/placeholder/services/AuthorizationService.d.ts","writeByteOrderMark":false,"text":"import { ISessionService, LogService } from '@smart/utils';\r\nimport { PermissionsRestService } from './rest';\r\n/**\r\n * This service makes calls to the Global Permissions REST API to check if the current user was\r\n * granted certain permissions.\r\n */\r\nexport declare class AuthorizationService {\r\n    private readonly logService;\r\n    private readonly sessionService;\r\n    private readonly permissionsRestService;\r\n    constructor(logService: LogService, sessionService: ISessionService, permissionsRestService: PermissionsRestService);\r\n    /**\r\n     * This method checks if the current user is granted the given global permissions.\r\n     *\r\n     * @param permissionNames The list of global permissions to check.\r\n     *\r\n     * @returns True if the user is granted all of the given permissions, false otherwise\r\n     *\r\n     * ### Throws\r\n     *\r\n     * - Will throw an error if the permissionNames array is empty.\r\n     */\r\n    hasGlobalPermissions(permissionNames: string[]): Promise<boolean>;\r\n    private getPermissionResult;\r\n    private mergePermissionResults;\r\n    private getPermissions;\r\n}\r\n"}}
